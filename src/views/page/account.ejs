<!DOCTYPE html>
<html lang="en">

<head> 
        
    <meta property="og:type" content="website" >
    <meta property="og:title" content="<%= storeProfile.username %>" >
    <meta property="og:description" content="Visita mi tienda en Blissenet.com" >
    <meta property="og:image" content="<%= searchBanner[0].url %>" >
    <meta property="og:url" content="https://blissenet.com/account/<%= storeProfile.username %>" >

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= storeProfile.username %>">
    <meta name="twitter:description" content="Visita mi tienda en Blissenet.com">
    <meta name="twitter:image" content="<%= searchBanner[0].url %>">
    <meta name="twitter:url" content="https://blissenet.com/account/<%= storeProfile.username %>">

    <%- include('../partials/head.ejs') %>
    <link rel="stylesheet" href="/toastr/toastr.min.css"> <!-- tiene que despues del CDN de bootstrap -->
    <script src="/toastr/toastr.min.js"></script>
    <title>Blissenet Account</title>

</head>
<style>

  *{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body{
    scroll-behavior: smooth;
    max-width: 100vw;
    height: auto;
  }

  main{
    width: 100%;
    height: auto;
  }

  .popover {
    position: relative; /* o relative, según tu diseño */
    z-index: 110; /* valor que necesites */
    /*para que z-index funcione debe ir acompañado de un valor en la propiedad position*/
  }

  .toast-success {
        /* Esta clase es unicamente para dar color al alert toastr de tipo success que debe ser violeta */
        background-color: #6f42c1; /* Azul tirando a morado */
        color: white; /* Color del texto */
  } 


  .boderBtn{
    cursor: pointer;
  }
  
  .btnMaskSeguir{
    opacity: 0;
  }

  .btnMaskSiguiendo{
    opacity: 0;
  }

  .iconoLupa {
        transition: transform 0.5s ease;
        display: inline-block; /* Asegúrate de que el icono pueda rotar */
    }

    .btn:hover .iconoLupa {
        transform: rotate(-22deg); /* Gira la lupa */
    }

  .containerBanner:hover{
  
     .starData{
      opacity: 1;
     }
     .containerStar{
      opacity: 1;
     }

  }

  .delItemCart{
    cursor: pointer;
    transition: .5s ease color;
  }

  .delItemCart:hover{
    color: red;
  }

  .starData{
    opacity: 0;
    transition: 1s all ease;
  }

  .containerStar{
    opacity: 0;
    cursor: pointer;
    background-color: rgb(255, 255, 255);
    transition: 1s all ease;
  }

  .imgPerfil {
    width: 70px;
    border-radius: 4px;
  }

  .horizontal-list { 
    display: flex;
  }


  .containerShare  { 
    background-color: rgba(255, 255, 255, 0.8); position: absolute; top: 5px; left:250px; z-index: 220;
  }

  .nailUpp{
    /* background-color: rgb(240, 240, 240, 0.3); */
    transition: 1.5s ease all;
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }
 
  .nailUpp:hover{
   /*  background-color: rgb(240, 240, 240, 0.5); */
    cursor: pointer;
  }
 
  .departGroup {
    background-color: rgb(197, 103, 103);
    border: 1px ridge #a52a2a;
    list-style: none;
    margin: 0;
  }

  .departList {
    background-color: rgb(243, 205, 205);
    padding: 0px 8px;
    color: rgb(54, 52, 49);
    border-radius: 12px;
  }

  .textDecorativeNo {
    text-decoration: none;
  }

  .contentAdmin {
    display: flex;
    justify-content: center;
  }

  .contentAnalisys {
    display: flex;
    flex-direction: row;
    justify-content: space-evenly;
  }

  .open {
    display: block;
  }

  .closed {
    display: none;
  }

  .close {
    display: none;
  }

  .containerIconSetting{
    background-color: rgb(255, 255, 255, 0);
    transition: 1s ease background-color;
  }

  .containerIconSetting:hover{
    background-color: rgb(255, 255, 255, 0.4);
  }


    .carousel .carousel-control-prev {
      position: absolute;
      left: 20px;
      left: 1%;
      z-index: 1;
      width: 20px;
    }

    .carousel .carousel-control-next {
      position: absolute;
      width: 20px;
      right: 1%;
      z-index: 1;
      width: 20px;
      
    }

    .cardPublished{
      width: 240px;

      .setting{
      opacity: 0;
      transition: 0.5s ease all;
      }
    }

    .imgFront{
      width: 240px; height: auto;
      transition: .5s ease width;
    }

    .CartMenos, .CartMas {
      transition: outline 0.5s ease;
    }

    .CartMenos:hover, .CartMas:hover {
      outline: 2px solid lightskyblue;
    }

    .cardPublished:hover{
      outline: 2px solid lightskyblue;

      .setting{
      cursor: pointer;
      background-color: white;
      opacity: 1;
      }

      .imgFront{
        width: 250px;
      }
    }

    .contentClean{
      transition: 0.5s ease background-color;
    }

    .contentClean:hover{
      background-color: rgba(165, 42, 42, 0.8);
    }

    .textLight{
      /* trabaja en conjunto con themaTextLight */
      color: white;
    }

    .lupaSinRespuesta{
      /* Esto es una nimacion que esta en las tiendas no es una lupa real */
      animation: moverLupa 8s infinite;
      transform-origin: center; /* Establecer el eje central para rotar */
    }

    .contentInfoBliss{
      display: flex;
      justify-content: start;
      flex-wrap: wrap;
    }

    .containerInfo{
      position: relative;
    }

    .btnInfo{
      position: absolute;
      top: 0;
      right: -110px;
      transition: 1.5s all;
    }

    .btnInfo:hover{
      right: 0px;

    }

    .cursor-pointer{
      cursor: pointer;
    }

    .lightCartShopping {
      animation: alarmaVisual 1.5s ease-in-out infinite;
    }

    @keyframes alarmaVisual {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
        box-shadow: 0 0 5px 2px rgba(255, 0, 0, 0.8);
      }
      50% {
        transform: scale(1.3);
        opacity: 0.6;
        box-shadow: 0 0 10px 4px rgba(255, 0, 0, 0.4);
      }
    }

    .listShoppingCart{
      width: 390px;
    }

    @keyframes moverLupa {
          0% {
              transform: rotate(0deg);
          }
          20% {
              transform: rotate(25deg); /* Rota hacia arriba */
          }
          40% {
              transform: rotate(0deg); /* Regresa a la posición original */
          }
          60% {
              transform: rotate(-25deg); /* Rota hacia abajo */
          }
          100% {
              transform: rotate(0deg); /* Regresa a la posición original */
          }
      }

    
    .containerRRSS{
      display: flex;
      justify-content: end;
    }

    .boxLikert{
        width: 40px;
        height: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 5px;
    }

    .marked{
        background-color: #9200ff;
        background-color: #0d6efd;
        color: #ffde00;
        color: #ffffff;
    }


   /*  Media queries */
   @media screen and (min-width: 500px) and (max-width: 700px ){

    .TopbarMain{
      flex-direction: column;
    }

    .containerAvatarUser{
      width: auto !important;
    }

   
    .MessagerStore{
      text-align: justify;
    }

    .container{
      width: 100% !important;
      padding: 0;
    }

    footer{
      display: flex;
      flex-direction: column;
      padding: 15px 0 15px 0;
    }

    .contentUser{
      width: 100% !important;
      margin-bottom: 20px !important;
    }

    .contentPlatform{
      width: 100% !important;
    }

    .containerRRSS{
      display: flex;
      justify-content: end;
    }

    .contentInfoBliss{
      display: flex;
      justify-content: start;
      flex-wrap: wrap;
    }


   }
    

   @media screen and (min-width: 290px) and (max-width: 499px ){

    .TopbarMain{
      flex-direction: column;
    }

    .containerAvatarUser{
      width: auto !important;
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .containerAvatar{
      margin: 0 !important;
    }

   
    .MessagerStore{
      text-align: left !important;
    }

    .container{
      width: 100% !important;
      padding: 0;
    }

    .containerShare{
      /* esto pertenece al modulo de compartir */
      background-color: rgba(255, 255, 255, 0.8); position: absolute; top: 65px; left: 10px; z-index: 220;
      /* right: 3px;
      background-color: rgba(255, 255, 255, 0.9); position: absolute; top: 30px; left:-200px; z-index: 220; */
    }


    footer{
      display: flex;
      flex-direction: column;
      padding: 15px 0 15px 0;
    }

    .contentUser{
      width: 100% !important;
      margin-bottom: 20px !important;
    }

    .contentPlatform{
      width: 100% !important;
      border: none !important;
    }

    .containerRRSS{
      margin: 10px 0;
      display: flex;
      justify-content: center;
    }

    .contentInfoBliss{
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }

    .listShoppingCart{
      width: 96%;
    }

  }

</style>

<body>

  <main class="mainTheme" >
    
    <% if (user) { %>
      <% const seeMarket = user.seeMarket %>
      <input type="hidden" value="<%= seeMarket.countryMarketCode %>" id="seeMarket">
      <input type="hidden" id="UserId" value="<%= user._id %>"> 

        <!-- este bloque me permite validad si el usuario que se logea tiene un meercado definido. sino lo tiene debe obligatoriamente hacerlo. --> 
    <% }; %>

    <%- include('../partials/navi-simple.ejs') %>
   
<!--     <span class="text-light" >Prueba username : <%= storeProfile.username %> </span> <br>
    <span class="text-light" >Prueba banner : <%= searchBanner[0].url %> </span> <br>
    <span class="text-light" >Prueba url : https://blissenet.com/account/<%= storeProfile.username %> </span>  -->
    


    <audio src="/sound/Icon-efect.mp3" id="efectSoundExpan"></audio> 

      <% if (storeProfile) { %>

        <% const store_username = storeProfile.username %>
        <% const store_id = storeProfile.indexed %>

        <% const bGColorTopbar = storeProfile.bGColorTopbar %>
        <% const bGColorText = storeProfile.bGColorText %>
        <% const bGColorGallery = storeProfile.bGColorGallery  %>
        <% const bGColorWorkspace = storeProfile.bGColorWorkspace %>

        <% const gallery = storeProfile.gallery %>
        <% const carouselOffert = gallery.carouselOffert  %>
        <% const sectionMedia = gallery.sectionMedia  %>
        <% const carouselImages = gallery.carouselImages %>
        <% const carouselBanner = gallery.carouselBanner  %> 
        
        <% const infobliss = storeProfile.infobliss %>  
        <% const policy = infobliss.policy %>
        <% const faq = infobliss.faq %>
        <% const survey = infobliss.survey %>
        <% const map = infobliss.map %>
        <% const geolocation = storeProfile.geolocation %>
        <% const shoppingCart = storeProfile.buyCar %>
        <% const deliveryOptions = storeProfile.deliveryOptions %>

        <input type="hidden" id="StorenameValue" value="<%= store_username %>">
        <input type="hidden" id="StoreId" value="<%= store_id %>">
        <input type="hidden" id="shoppingCart" value="<%= shoppingCart %>">
        
        <div class="container-fluid p-0 m-0">

          <div class="row rowWidth mx-0 p-0">

              <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 px-0">

                <div class="containAlert" style="position: sticky; top: 0px; z-index: 200;"> <!-- bloque dinamico --> </div>
                <div class="containerBanner" style="position: relative; z-index: 220">
                    <% if (user) { %>
                        <% if (searchBanner) { %>

                          <img src="<%= searchBanner[0].url %>" style="width: 100%; max-height: 100vh; object-fit: cover;">
                        
                        <% } %>
                    <% } else { %> 
                        <% if (searchBanner) { %>

                          <img src="<%= searchBanner[0].url %>" style="width: 100%; max-height: 100vh; object-fit: cover;">
              
                        <% }; %>

                    <% }; %> <!-- fin del user --> 
                </div>

              </div>
           
              <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 px-0">

                <!-- bloque Topbar -->
                <div class="TopbarMain p-1 d-flex justify-content-between px-4" id="topBar"
                  style="position: relative; background-color: <%= bGColorTopbar %> ; color: <%= bGColorText %>; position: relative; z-index: 200;">
                  
                    <div class="containerAvatarUser d-flex" style="width: 30%;">
                        <div class="containerAvatar me-2 d-flex align-items-center" style="margin-left: 20px;">

                          <% if (storeProfile.avatarPerfil[0].url.length === 0 ) { %>
                              <td> <img src="https://www.gravatar.com/avatar/<%= storeProfile.mailhash %>?d=identicon" style="width: 70px; height: 70px; object-fit: cover;"></td>    
                            <% } else { %>
                              <td><img src="<%= storeProfile.avatarPerfil[0].url %>" alt="" class="rounded-pill" style="width: 70px; height: 70px; object-fit: cover;"></td> 
                          <% }; %>

               <!-- este es el fin del foreach de colores -->
                        </div>
                        <div class="containerDetails d-flex flex-column">
                          <% if (Account) { %> 
                              <% Account.forEach((ele)=>{ %>
                                    <h1 class="mx-1 store" style="font-size: 20px;">
                                        <%= ele.blissName %> <input type="hidden" value="<%= ele.username %>">
                                    </h1>
                                    <!-- <span class="mx-1" style="font-size: 16px;">@<%= ele.username %> </span> -->

                                    <div class="d-flex justify-content-start">

                                      <button class="mx-1 shareToggle" style="user-select: none; background: none; border: none; padding: 0; margin: 0; color: inherit"> <i class="bi bi-share me-1"></i>  Compartir </button> 
                                      
                                      <div class="containerShare d-flex invisible border border-secondary py-3 px-2 rounded-3" style="height: 80px;">
                                            <a href="https://api.whatsapp.com/send?text=https://blissenet.com/account/<%= ele.username %>" target="_blank" class="mx-2"> <img src="/img/helpWhatsapp.png" alt="" style="width: 42px; height: 42px;">   </a> 
                                            <a href="https://t.me/share/url?url=https://blissenet.com/account/<%= ele.username %>" target="_blank" class="mx-2"> <img src="/img/helpTelegram.png" alt="" style="width: 42px; height: 42px"> </a> 
                                            <a href="https://www.facebook.com/sharer/sharer.php?u=https://blissenet.com/account/<%= ele.username %>" target="_blank" class="mx-2"> <img src="/img/helpFacebook.png" alt="" style="width: 42px; height: 42px">  </a>
                                            <div class="containerBTN p-0 mx-2" style="position: relative; width: 43px !important">   
                                              <button class="btn btn-sm btn-primary" style="border-radius: 8px; position: absolute; right: - 200px; width: 42px; height: 42px" id="btnClicBoard"> <i class="bi bi-clipboard px-1" style="font-size: large;"></i> </button>
                                              <button class="btn btn-sm btn-dark invisible" style="border-radius: 8px; position: absolute; right: - 200px; width: 42px; height: 42px" id="btnClicBoardCheck"> <i class="bi bi-clipboard-check px-1" style="font-size: large;"></i>  </button>
                                            </div>
                                            <button class="btn btn-dark mx-2" id="btnQR" style="width: 42px; height: 42px ; border-radius: 8px;"  data-bs-toggle="modal" data-bs-target="#staticQR"> <i class="bi bi-qr-code px-0" style="font-size: large;"></i> </button>
                                      </div>
                                      <input type="hidden" id="linkToShare" value="https://blissenet.com/account/<%= ele.username %>">
                                      
                                    </div>

                                  <% if (boxPublisher) { %>

                                      <span class="mx-1" style="font-size: 16px; user-select: none"><i class="bi bi-bag-plus me-1"></i> Anuncios: <%= boxPublisher.length %> </span>
                                  
                                  <% }; %>
                                  
                              <% }) %>
                          <% }; %>
                        </div>
                    </div>


                    <% if (user) { %>
                      <input type="hidden" id="iDLogeado" value="<%= user._id %>">
                      <% if (storeProfile) { %>
                        <input type="hidden" id="iDStore" value="<%= storeProfile.indexed %>">
                        
                        <!-- estos datos ocultos se usan para jugar con los estilos el boton buttonFollow abajo presente -->
                        <input type="hidden" id="bGColorText" value="<%= storeProfile.bGColorText %>">
                        <input type="hidden" id="bGColorTopbar" value="<%= storeProfile.bGColorTopbar %>">


                        
                        <% if (statusFollow !== null) { %>
                            <div class="content-btn mt-3 cursor-pointer me-5" id="btnFollow" style = "width: max-content; height: max-content; position: relative;">
                              
                                <button class="btn rounded-pill shadow-sm px-4 buttonFollow" style="background-color: #131313; color: #ffffff; border: 1px solid #ffffff"> <span id= "spanBtnFollow"> Siguiendo </span>  </button>
                                <div class = "contentConfetyFollow" style="position: absolute; top: -20px; left: -35px; width: 180px; height: 90px;">  </div>  
                            </div>
                        <% } else { %>
                            <div class="content-btn mt-3 cursor-pointer me-5" id="btnFollow" style = "width: max-content; height: max-content; position: relative;">
                                
                                <button class="btn rounded-pill shadow-sm px-4 buttonFollow"  style="border: 1px solid <%= storeProfile.bGColorText %>; color: <%= bGColorText %>; background-color:<%= bGColorTopbar %>;"> <span id= "spanBtnFollow"> Seguir </span>  </button>
                                <div class = "contentConfetyFollow" style="position: absolute; top: -20px; left: -35px; width: 180px; height: 90px;">  </div>  
                            </div>
                        <% }; %>
                      

                      <% } %>  
                    <% } else { %>

            
                      
                          <div class="content-btn-follow mt-3 me-5" style= "width: fit-content; position: relative;" data-bs-toggle="modal" data-bs-target="#staticnoLogin">    
                              <a class="btn rounded-pill shadow-sm px-4"  style="border: 1px solid <%= bGColorText %>; color: <%= bGColorText %>; background-color:<%= bGColorTopbar%>;"> Seguir </a>
                          </div>
                      
              


                    <% }; %>  
                    
        
                </div> <!-- aqui cierra el bloque Topbar--> 
        
                <div class="containerSegment"> 

                    <form  method="get" id="formSegment"> <!-- acti0n se forma abajo en un script -->
                        <input type="hidden" value="<%= store_username %>" id="store_username">
                        <input type="hidden" value="<%= store_id %>" name="store" id="store_indexed">  

                        <div class="form-floating shadow-sm" style="position: relative; z-index: 200;">
                            <select class="form-select" id="floatingSelect" name="segment" aria-label="label select example"
                            style="border: none; outline: none; border-radius: 0; background-color: <%= bGColorTopbar%> ; color: <%= bGColorText %>; ">
                            
                              
                            <% if (segment) { %> <!-- esto es un objeto que viebe del backend -->
                              <option value= "<%= segment %>" selected> <%= segment %>  </option>
                            <% }; %>  

                            <% storeProfile.segment.forEach((Segment)=>{ %>
                              <option value= "<%= Segment %>"> <%= Segment %>  </option>
                            <% }) %>

                            </select>
                            <label for="floatingSelect" style="color: <%= bGColorText %>; "><i>Selecciona un Segmento</i> </label>
                        </div>
                    </form>

                </div>
                    

                  <!-- importante que estos modales esten aqui afuera del contenedor containerWorkSpace -->
                      
                      <!-- Modal codigo QR -->
                      <div class="modal fade" id="staticQR" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticQRLabel" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">Codigo QR</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                
                                <div class="modal-body d-flex justify-content-center align-items-center py-5" style="background: linear-gradient(90deg, rgba(146,0,255,1) 0%, rgba(102,0,255,1) 100%);">
                                    <div class="contentQR d-flex flex-column my-2" style="position: relative; max-width: 320px;">
                                      <canvas id="qr-canvas" class="rounded-3 mt-2">  
                                        <!-- Aqui va el codigo QR dinamico -->
                                      </canvas>
                                      <img src="/img/logoSuperiorQR.png" class="shadow" alt="" style="position: absolute; top: -35px; right: 70px; width: 60px;"> 
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>

                      <!-- Option noLogeado -->
                      <div class="modal fade" id="staticnoLogin" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticnoLogin" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">¿Quieres seguir a esta tienda?</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center my-1">

                                  <div class="containerMake d-flex flex-column justify-content-center align-items-center cursor-pointer"> 
                                    
                                    <span class="mt-2">
                                      ¡Hola! Para seguir esta tienda y recibir ofertas exclusivas, necesitas una cuenta en Blissenet. Iniciar sesión te permite seguir tus tiendas favoritas y tener un historial de interacciones. ¿Te gustaría crear una cuenta ahora? Es rápido y fácil.
                                    </span>
                                    <hr>
                                    <p class="py-0"> 
                                        Puedes logearte aqui <a href="/myaccount/signin"> Login </a> en caso que no tengas un registro puedes hacerlo en el siguiente enlace <a href="/myaccount/signup"> Registro </a>. 
                                    </p>

                                  </div> 

                                </div>
                                <div class="modal-footer" style="background-image: url('/img/sinUser.jpg'); background-size: cover; background-position: center;">
                                  <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                      </div>

                      <!-- Modal status de nivel  data-bs-toggle="modal" data-bs-target="#staticLevelSell" -->
                      <div class="modal fade" id="staticLevelSell" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticLevelSell" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">Récor como vendedor </h5>
                                  <button type="button" class="btn-close" id="closeModalStaticLevelSell" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center mb-0">
                                  <p class="my-1"> Esta métrica indica que tan habilidoso es la administración de esta tienda, su capacidad de vender. Este nivel inicia en Carbón (pocas ventas realizadas) y termina en Diamante (Muchas ventas logradas +200). <span class="bg-dark rounded-pill text-info py-0 px-2 cursor-pointer seeLevel" data-bs-toggle="modal" data-bs-target="#staticScalafon">  Ver Niveles </span> </p> 
                                </div>
                                <div class="containerMessage">
                                  <hr>
                                  <p class="mx-3">"Recuerde que esta información no refleja la confiabilidad de la tienda. Considere el nivel de confianza  (<i class="bi bi-shield-check mx-1" style="font-size: 1rem;"></i>)  y los comentarios de sus clientes (<i class="bi bi-star-fill mx-1" style="font-size: 1rem;"></i>). Tómese su tiempo para revisar todos los indicadores y calificaciones antes de comprar."</p>
                                </div>
                            </div>
                        </div>
                      </div>

                      <!-- Modal status de nivel  data-bs-toggle="modal" data-bs-target="#staticScalafon" -->
                      <div class="modal fade" id="staticScalafon" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticScalafon" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">Niveles </h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center">
                                  <img src="/img/scalafon.png" alt="niveles" style="max-width: 90%;">
                                </div>
                                <div class="details d-flex justify-content-start">
                                  <span class="mx-3"> <small> <i>Las cantidades expresadas en los niveles representan las ventas realizadas.</i> </small> </span>
                                </div>
                                
                                <div class="containerMessage">
                                  <hr>
                                  <p class="mx-3">Puedes ver tu nivel en Publicaciones opción Record. </p>
                                </div>
                            </div>
                        </div>
                      </div>                       
                      
                      <!-- Modal status de nivel  data-bs-toggle="modal" data-bs-target="#staticTrustSell" -->
                      <div class="modal fade" id="staticTrustSell" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticTrustSell" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">Nivel de confianza</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center my-2">
                                  "La confiabilidad se expresa en porcentajes del 100% (máxima confianza) al 0% (mínima confianza). Si no hay información, es porque no ha habido intercambios comerciales calificados".
                                </div>
                                <div class="containerMessage">
                                  <hr>
                                  <p class="mx-3">Esta información es valiosa, ya que muestra la confiabilidad de la tienda. ¡No olvides revisar los comentarios de sus clientes en la sección de <b>Calificación de Tienda <span class="bg-dark rounded-pill text-info px-2 py-1"> (Estrella <i class="bi bi-star-fill" style="font-size: 1rem; color: #fcda57;"></i>). </span>  </b> </p>
                                </div>
                            </div>
                        </div>
                      </div>                           

                      <!-- Modal invitación para hacer encuesta rapida-->
                      <div class="modal fade" id="staticSurveyinvitation" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticSurveyinvitation" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticSurvey"> ¡Atención! Esta tienda tiene una encuesta activa y tu opinión es valiosa. </h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center my-1">

                                  <div class="containerMake d-flex flex-column justify-content-center align-items-center cursor-pointer" id="btnTakeSurvey"> 
                                    
                                    <img src="/img/take-survey.png" alt=""  style="width: 80px;">
                                    <span class="mt-2">Hacer Encuesta</span>
                                    
                                  </div> 

                                </div>
                                <div class="modal-footer">

                                  <span class="mx-3 my-2">
                                    ¡Solo te tomará un minuto! Al participar, contribuirás a mejorar la atención y los servicios. Las preguntas se enfocan en el mercado y tu experiencia como cliente.
                                  </span>
                                  
                                </div>

                            </div>
                        </div>
                      </div>
                      
                      <!-- Modal encuesta fallida cuando faltan preguntas por respodner-->
                      <div class="modal fade" id="staticSurveyFail" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticSurveyFail" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">¡Faltan preguntas por respoder!</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center my-1">

                                  <div class="containerMake d-flex flex-column justify-content-center align-items-center cursor-pointer" > 
                                    
                                    <span class="my-2">
                                      Es fundamental que todas las preguntas de la encuesta sean respondidas para poder avanzar. Agradecemos su comprensión y colaboración.
                                    </span>

                                  </div> 

                                </div>

                            </div>
                        </div>
                      </div>

                      <!-- Modal de encuesta para usuarios NO Logeados -->
                      <div class="modal fade" id="staticSurveyNoLogin" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticSurveyNoLogin" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">¡No estas Logeado!</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-around align-items-center my-1">

                                  <div class="containerMake d-flex flex-column justify-content-start" > 
                                    <p>Para hacer encuestas en las tiendas debes estar logeado</p>
                                    <span class="my-2">
                                      Puedes logearte aqui <a href="/myaccount/signin"> Login </a> en caso que no tengas un registro puedes hacerlo en el siguiente enlace <a href="/myaccount/signup"> Registro </a>. 
                                    </span>

                                  </div> 

                                </div>
                                <div class="modal-footer" style="background-image: url('/img/sinUser.jpg'); background-size: cover; background-position: center;">
                                  <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                      </div>



                  <div class="containerWorkSpace"> 
                    <!-- bloque Workspace -->
                    <div class="WorkspaceMain closed d-flex flex-column justify-content-center align-items-center" style="height: auto; background-color:<%= bGColorWorkspace %>; position: relative;">

                          <a name="workSpace"></a>

                          <!-- Este bloque es para acceder a un buscador dentro de la misma tienda, será una opcion del profile -->
                          <% if (storeProfile.searchFilter === 'on' ){%>
                          <div class="containerSearch d-flex justify-content-center align-items-center p-1" style="height: 60px; width: 100%; background-color:<%= bGColorTopbar%>;color:<%= bGColorText %>; z-index : 100">

                              <div class="container-fluid">
                                  <div class="container" style="width: 50%;">

                                    <% const store = storeProfile.username %>
                                    <% let Segment %>
                                    <% if (segment) { %> <!-- esto es un objeto que viene del backend -->
                                      <%  Segment = segment %>   
                                    <% } else { %>
                                      <%  Segment = "null" %> 
                                    <% } %>  
                                                                          
                                  
                                      <form  method="get" class="d-flex" id="formSearch">
                                        <input type="hidden" value="<%= store %>" id="storeSearch">
                                        <input type="hidden" value="<%= Segment %>" id="segmentSearch">
                                        <input class="form-control me-2" type="search" id="elementSearch" placeholder="Puedes buscar cualquier articulo de esta Tienda." aria-label="Search" style="border : 1px solid <%= bGColorText %>" >
                                        <button class="btn" id="submitSearch" style="color:<%= bGColorText %>; border : 1px solid <%= bGColorText %>"> <i class="bi bi-search iconoLupa"></i> </button>
                                      </form>
                                     

                                  </div>
                              </div>
                          
                          </div>
                          <% }; %>

                          <a href="#workSpace" class="anclaWorspace text-dark">
                            <div class="nailUpp px-3 mb-2" style="background-color:<%= bGColorTopbar %>;color:<%= bGColorText %>;">
                              <i class="bi bi-chevron-down Heading"></i>
                            </div>  
                          </a>


                        <div class="containerScoreTrustMain" style="position: fixed; right: 0; top: 120px; z-index : 1">                          


                            <div class="containerAdminMain d-flex flex-column justify-content-center align-items-center" style="margin-right: 13px; z-index : 1">

                              <% if (shoppingCart === true ) { %>  
                                  <div class="containerCartList cursor-pointer" style="position: relative;">
                                    <div class="lightCartShopping close" style="position: absolute; top: -3px; right: 7px; background-color: #d30404; width: 12px; height: 12px; border-radius: 50%;"></div>
                                    <div class="contentCardBuy border border-dark rounded-pill my-2" style="width: 40px; height: 40px;">
                                      <img src="/img/iconCardBuy.png" alt="" class="rounded-pill" style="width: 40px; height: 40px;">
                                    </div>
                                  </div> 
                              <% }; %>    
                           

                              <button class="popoverChatDeBliss" type="button" style="background-color: transparent; border: none ;" data-bs-toggle="popover"  data-bs-placement="left" data-bs-content="ChatdeBliss en desarrollo.">
                                <div class="contentChatMessage border border-dark rounded-pill my-2" style="width: 40px; height: 40px;">
                                  <img src="/img/iconChatMessage.png" alt="" class="rounded-pill" style="width: 40px; height: 40px;">
                                </div>
                              </button>  

                              <% if (user) { %>
                                    <!-- si existe un usuario -->
                                <% if (user.username == Account[0].username) { %>
                                    <!-- y es el propietario de la tienda podra ver esta opcion -->
                                  <div class="contentAdmin border border-dark rounded-pill my-2" style="width: 40px; height: 40px;">
                                    <a href="/admin-store"><img src="/img/iconAdmin.png" alt="" class="rounded-pill" style="width: 40px; height: 40px;">
                                    </a> 
                                  </div>

                                <% } %>

                              <% } %>  

                            </div> 


                        </div>

                        
            
                        <div class="Workspace" style="width: 96%;">

                              <% if (newBox.length !==0) {%>

                                <div class="containerCard d-flex flex-wrap justify-content-start p-3" style="width: 100%;" >


                                    <% newBox.forEach( (ele, i)=>{ %>

                                        <% if (shoppingCart === false ) { %> 
                                        
                                          <div class="card m-3 p-0 shadow cardPublished">

                                            <div class="card-body d-flex flex-column p-0">

                                                <div class="containerBackground m-0" style="position: relative; background-image : url('<%= ele.images[0].url%>'); background-size: cover;">
                                                  <div class="containerFilter" style="width: 100%; height: 100%;  backdrop-filter: blur(10px) ; position: absolute; top: 0;"></div>

                                                    <div id="carouselExampleControls<%= i %>" class="carousel slide" data-bs-ride="carousel"
                                                      data-bs-interval="false" data-bs-touch="true" style="position: relative; z-index: 1;" >

                                                      <!-- esto es el icono para acceder a las herramientas de offer, bestProduct, onlyOneAvailable, Delivery, soldOut -->
                                                      <% if (user) { %>

                                                          <% if (user.username === storeProfile.username) { %>
                                                                
                                                            <% if (ele.department !== 'raffle' ){ %>

                                                                  <div class="dropdown d-flex justify-content-start" style="position: absolute; top: 10px; z-index: 100; width: 100%;">
                                                                    <i class="bi bi-three-dots-vertical mx-2 p-1 rounded-pill d-flex justify-content-center setting" data-bs-toggle="dropdown"></i>
                                                                                                          
                                                                    <ul class="dropdown-menu float-sm-start" aria-labelledby="dropdownMenu2" style="background-color: rgba(255, 255, 255, 0.9)">
                                                                      <li> <button class="offer dropdown-item">Oferta <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"> </button> </li>
                                                                      <li> <button class="bestProduct dropdown-item">Mejor Producto <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                      <li> <button class="onlyOneAvailable dropdown-item" type="button">Unico Disponible <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"> </button></li>
                                                                      <% if (ele.department === 'arts' || ele.department === 'items' ){ %>
                                                                        <li> <button class="delivery dropdown-item">Delivery <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                        <li> <button class="soldOut dropdown-item">Agotado <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                      <%  } else { %>
                                                                        <li class="invisible"> <button class="delivery dropdown-item">Delivery <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                        <li class="invisible"> <button class="soldOut dropdown-item">Agotado <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                      <% } %>  
                                                                    </ul>
                                                                  </div>

                                                                <% if (ele.offer === true) { %>    
                                                                  <span class="border border-warning tagOfferUser" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                                                <% } else { %>
                                                                  <span class="border border-warning tagOfferUser invisible" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                                                <% }; %>  

                                                                <% if (ele.soldOut === true) { %>    
                                                                  <span class="tagSoldOutUser" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 80px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span> 
                                                                <% } else { %>
                                                                  <span class="tagSoldOutUser invisible" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 90px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span>
                                                                <% }; %>

                                                            <% }; %>
                                                                
                                                          <% } else { %> <!-- en el caso de que haya un usuario logeado pero no es el dueño de la tienda --> 

                                                                <% if (ele.department !== 'raffle' ){ %>
                                                                
                                                                  <% if (ele.soldOut === true) { %>
                                                                      <div class="dropdown d-flex justify-content-start" style="position: absolute; top: 10px; z-index: 200; width: 100%;">
                                                                        <i class="bi bi-three-dots-vertical mx-2 p-1 rounded-pill d-flex justify-content-center setting" data-bs-toggle="dropdown"></i>
                                                                                                              
                                                                          <ul class="dropdown-menu" aria-labelledby="dropdownMenu2" style="background-color: rgba(255, 255, 255, 0.9)">
                                                                        
                                                                              <li class="no-select"> <button class="purchaseTime dropdown-item"> <small> Avisarme cuando este disponible </small>  <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>                                                                                                                      
                                                                          
                                                                          </ul>
                                                                

                                                                      </div>
                                                                      <div class="alert alert-light boxDetailPT border border-secondary mx-1 close" style="position: absolute; top: 40px; z-index: 200; width: 96%;">
                                                                        
                                                                      </div>
                                                                  <%  }; %>

                                                                <% }; %>     

                                                          <% }; %>  
                                        
                                              

                                                      <% }; %>  
                                                    
                                                      
                                                      <div class="carousel-inner" style="position: relative; width: 100%; height: 220px;  z-index: 1;">
                                                        
                                                        <% if (ele.offer === true) { %>    
                                                          <span class="border border-warning tagOffer" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span> 
                                                        <% } else { %>
                                                          <span class="border border-warning tagOffer invisible" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                                        <% }; %> 

                                                        <% if (ele.soldOut === true) { %>    
                                                          <span class="tagSoldOut" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 80px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span> 
                                                        <% } else { %>
                                                          <span class="tagSoldOut invisible" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 90px; height: 20px; position: absolute; top: 0; right: -3px; border-bottom-left-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span> 
                                                        <% }; %> 

                                                        <div class="carousel-item active">
                                                          <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>"> 
                                                            <img src="<%= ele.images[0].url%>" class="imgFront" alt="...">
                                                          </a>
                                                        </div>
                                                        <% for (let x=1; x < ele.images.length; x++) { %>
                                                          <% const element=ele.images[x] %>
                                                            <div class="carousel-item">
                                                              <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>"> <img src="<%= element.url %>" class="d-block w-100"
                                                                style="  width: 100%; height: 100%; object-fit: cover;">
                                                              </a>
                                                            </div>

                                                        <% }; %>
                                                      </div>

                                                      <button class="carousel-control-prev" type="button"
                                                        data-bs-target="#carouselExampleControls<%= i %>" data-bs-slide="prev">
                                                        <span class="carousel-control-prev-icon"></span>
                                                        <span class="visually-hidden">Previous</span>
                                                      </button>
                                                      <button class="carousel-control-next" type="button"
                                                        data-bs-target="#carouselExampleControls<%= i %>" data-bs-slide="next">
                                                        <span class="carousel-control-next-icon"></span>
                                                        <span class="visually-hidden">Next</span>
                                                      </button>
                                                    </div>
                                        
                                                </div>

                                                <hr class="m-0">
                                                <!-- parte baja de la tarjeta descripcion precio y favoritos -->
                                                <!-- esta parte va a cambiar cuando sea oferta -->
                                                <% if (ele.department !== 'raffle') { %>
                                                  <% if (ele.offer === false) { %>
                                                  <div class="boxDetail" style="height: 140px; position: relative; background-color: #ffffff;">
                                                          <div class="containerDetails mx-2 " style="margin-bottom: 10px; margin-top: 10px;">
                        
                                                              <div class="title d-flex align-items-start">

                                                                <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>" class="text-dark lh-sm"
                                                                  style="text-decoration: none;">
                                                                  <%= ele.title %>
                                                                </a>                                            
                                                              
                                                              </div>
                          
                                                              <div class="storeFavorite d-flex justify-content-end" style="width: 100%; position: absolute; bottom: 52px; left: 0px; padding-left: 8px; padding-right: 8px;">
                            
                                                                  <!-- <p class="m-0 badge bg-secondary text-light"><a href="/account/<%= ele.username %>" class="text-light text-decoration-none"><%= ele.username %></a> </p> -->
                                                                
                                                                  <!-- <a href="/account/<%= ele.username %>" class="ui grey ribbon label text-decoration-none" style="left: -22px;"> <%= ele.username %> </a> -->

                                                                <% if (user) { %> <!-- control de corazones fascinometro -->
                                                                  <i class="bi bi-heart ps-2 linkHeart" style="cursor: pointer; font-size: 17px;"><input type="hidden" value="<%= ele.department %>"><input type="hidden" value="<%= ele._id %>"></i>                                         
                                                                <% } %>
                            
                                                              </div>
                                                              
                                                              <div class="containerPriceIcon" style="width: 100%; position: absolute; bottom: 10px; left: 0px;">
                        
                                                                <div class="containerPrice d-flex justify-content-between px-2">

                                                                  <a class="ui yellow circular label px-1 text-decoration-none"> 
                                                                    <span style="font-size: 16px; color: black;"> <i class="bi bi-currency-dollar"></i> <%= ele.price %> </span> 
                                                                  </a>

                                                                  <div class="containerTresIconos d-flex">
                                                                    
                                                                    <div class="containerDelivery">
                                                                      <% if (ele.delivery === true) {%>
                                                                        <i class="bi bi-truck me-1"></i>
                                                                      <% }; %>  
                                                                    </div>     
                                                                    <div class="containerOnlyOneAvailable">
                                                                      <% if (ele.onlyOneAvailable === true) {%>
                                                                        <i class="bi bi-1-square-fill me-1"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                    <div class="containBestProduct">
                                                                      <% if (ele.bestProduct === true) {%>
                                                                        <i class="bi bi-award"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                  </div>
                                                                </div>
                        
                                                              </div>
                                                              
                          
                                                          </div>
                                                  </div>
                                                  <% } else { %>
                                                  <div class="boxDetail" style="height: 140px; position: relative; background-color: #fcda57;">
                                                          <div class="containerDetails mx-2 " style="margin-bottom: 10px; margin-top: 10px;">
                      
                                                            <div class="title d-flex justify-content-start"> 
                                                                <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>" class="text-dark lh-sm"
                                                                  style="text-decoration: none;">
                                                                  <%= ele.title %>
                                                                </a>                                            
                                                            </div>
                    
                                                            <div class="storeFavorite d-flex justify-content-end" style="width: 100%; position: absolute; bottom: 52px; left: 0px; padding-left: 8px; padding-right: 8px;">
                          
                                                                <!-- <p class="m-0 badge bg-secondary text-light"><a href="/account/<%= ele.username %>" class="text-light text-decoration-none"><%= ele.username %></a> </p> -->
                                                              
                                                                <!-- <a href="/account/<%= ele.username %>" class="ui grey ribbon label text-decoration-none" style="left: -22px;"> <%= ele.username %> </a> -->

                                                              <% if (user) { %> <!-- control de corazones fascinometro -->
                                                                <i class="bi bi-heart ps-2 linkHeart" style="cursor: pointer; font-size: 17px;"><input type="hidden" value="<%= ele.department %>"><input type="hidden" value="<%= ele._id %>"></i>                                         
                                                              <% } %>
                          
                                                            </div>
                                                                                                                              
                                                            <div class="containerPriceIcon" style="width: 100%; position: absolute; bottom: 10px; left: 0px;">
                      
                                                              <div class="containerPrice d-flex justify-content-between px-2">

                                                                <a class="ui yellow circular label px-1 text-decoration-none"> 
                                                                  <span style="font-size: 16px; color: black;"> <i class="bi bi-currency-dollar"></i> <%= ele.price %> </span> 
                                                                </a>

                                                                <div class="containerTresIconos d-flex">

                                                                  <div class="containerDelivery">
                                                                    <% if (ele.delivery === true) {%>
                                                                      <i class="bi bi-truck me-1"></i>
                                                                    <% }; %>  
                                                                  </div>
                                                                  <div class="containerOnlyOneAvailable">
                                                                    <% if (ele.onlyOneAvailable === true) {%>
                                                                      <i class="bi bi-1-square-fill me-1"></i>
                                                                    <% }; %>  
                                                                  </div>
                                                                  <div class="containBestProduct">
                                                                    <% if (ele.bestProduct === true) {%>
                                                                      <i class="bi bi-award"></i>
                                                                    <% }; %>  
                                                                  </div>
                                                                </div>
                                                              </div>
                      
                                                            </div>
                                                            
                                                          </div>
                                                  </div>  
                                                  <% }; %>
                                                <% } else { %>
                                                  <div class="boxDetailRaffle" style="height: 140px; position: relative; background-color: #ffffff;">
                                                    <div class="containerDetails mx-2 " style="margin-bottom: 10px; margin-top: 10px;">
                                                      
                                                        <div class="title d-flex justify-content-start">
                                                            <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>" class="text-dark lh-sm"
                                                              style="text-decoration: none;">
                                                              <%= ele.title %>
                                                            </a>                                            
                                                        </div>                
                                                                                                                    
                                                        <div class="storeFavorite d-flex justify-content-end" style="width: 100%; position: absolute; bottom: 52px; left: 0px; padding-left: 8px; padding-right: 8px;">
                      
                                                            <!-- <p class="m-0 badge bg-secondary text-light"><a href="/account/<%= ele.username %>" class="text-light text-decoration-none"><%= ele.username %></a> </p> -->
                                                          
                                                            <!-- <a href="/account/<%= ele.username %>" class="ui grey ribbon label text-decoration-none" style="left: -22px;"> <%= ele.username %> </a> -->

                                                          <% if (user) { %> <!-- control de corazones fascinometro -->
                                                            <i class="bi bi-heart ps-2 linkHeart" style="cursor: pointer; font-size: 17px;"><input type="hidden" value="<%= ele.department %>"><input type="hidden" value="<%= ele._id %>"></i>                                         
                                                          <% } %>
                      
                                                        </div>

                                                        <div class="containerPriceIcon" style="width: 100%; position: absolute; bottom: 10px; left: 0px;">
                          
                                                          <div class="containerPrice d-flex justify-content-between px-2">
                                                            
                                                            <a class="ui yellow circular label px-1 text-decoration-none"> 
                                                              <span style="font-size: 16px; color: black;"> <i class="bi bi-currency-dollar"></i> <%= ele.price %> </span> 
                                                            </a>

                                                            <div class="containerTickets">
                                                              <div class="containerIconCategory">
                                                                <% if (ele.category == 'Gratis' ) {%>
                                                                <span class="rounded-1 p-0 d-flex justify-content-center align-items-center me-1" style="width: 25px; background-color: #131313;">
                                                                  <i class="bi bi-ticket-fill" style="color: rgb(17, 235, 235);"></i>
                                                                </span>
                                                                <% } else { %>
                                                                <span class="rounded-1 p-0 d-flex justify-content-center align-items-center me-1" style="width: 25px; background-color: #131313;">
                                                                  <i class="bi bi-ticket-fill" style="color: brown;"></i>
                                                                </span>
                                                                <% }; %>  
                                                              </div>
                                                            </div>
                                                          </div>
                  
                                                        </div>
                                                      
                                                    </div>
                                                  </div>
                                                <% }; %>  

                                            </div>

                                          </div>

                                        <% } else { %>
                                    
                                          <div class="card m-3 p-0 shadow cardPublished">

                                            <div class="card-body d-flex flex-column p-0">

                                                <div class="containerBackground m-0" style="position: relative; background-image : url('<%= ele.images[0].url%>'); background-size: cover;">
                                                  <div class="containerFilter" style="width: 100%; height: 100%;  backdrop-filter: blur(10px) ; position: absolute; top: 0;"></div>

                                                    <div id="carouselExampleControls<%= i %>" class="carousel slide" data-bs-ride="carousel"
                                                      data-bs-interval="false" data-bs-touch="true" style="position: relative; z-index: 1;" >

                                                      <!-- esto es el icono para acceder a las herramientas de offer, bestProduct, onlyOneAvailable, Delivery, soldOut -->
                                                      <% if (user) { %>

                                                          <% if (ele.soldOut === false) { %>
                                                            <div class="containerCart rounded-pill shadow-sm" style="background-color: #fcda57; z-index: 100; width: auto; position: absolute; top: 10px; right: 10px;"> 

                                                              <div class="tagShippingCart contentButton d-flex" style="height: 35px;">

                                                                  <input type="hidden" value="<%= ele._id %>"> <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele.title %>"> <input type="hidden" value="<%= ele.price %>"> <input type="hidden" value="<%= ele.count %>"> <input type="hidden" value="<%= ele.presentation %>">
                                                                  <button class="btn CartMenos d-flex justify-content-center align-items-center" style="background-color: #fcda57; width: 30px; height: 30px; height: 100%; border-radius: 50%; font-size: 18px;"> 
                                                                    <span > <b>-</b> </span> 
                                                                  </button> 
                                                                  <span class="countTag d-flex align-items-center mx-1 py-0" style="font-size: 18px;"> 0 </span>
                                                                  <button class="btn CartMas d-flex justify-content-center align-items-center" style="background-color: #fcda57; width: 30px; height: 30px; height: 100%; border-radius: 50%; font-size: 18px;"> 
                                                                    <span > <b>+</b> </span> 
                                                                  </button> 

                                                              </div>


                                                            </div>
                                                          <% }; %>  

                                                          <% if (user.username === storeProfile.username) { %>
                                                                
                                                            <% if (ele.department !== 'raffle' ){ %>

                                                                  <div class="dropdown d-flex justify-content-start" style="position: absolute; top: 30px; z-index: 100; width: auto">
                                                                    <i class="bi bi-three-dots-vertical mx-2 p-1 rounded-pill d-flex justify-content-center setting" data-bs-toggle="dropdown"></i>
                                                                                                          
                                                                    <ul class="dropdown-menu float-sm-start" aria-labelledby="dropdownMenu2" style="background-color: rgba(255, 255, 255, 0.9)">
                                                                      <li> <button class="offer dropdown-item">Oferta <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"> </button> </li>
                                                                      <li> <button class="bestProduct dropdown-item">Mejor Producto <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                      <li> <button class="onlyOneAvailable dropdown-item" type="button">Unico Disponible <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"> </button></li>
                                                                      <% if (ele.department === 'arts' || ele.department === 'items' ){ %>
                                                                        <li> <button class="delivery dropdown-item">Delivery <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                        <li> <button class="soldOut dropdown-item">Agotado <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                      <%  } else { %>
                                                                        <li class="invisible"> <button class="delivery dropdown-item">Delivery <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                        <li class="invisible"> <button class="soldOut dropdown-item">Agotado <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>
                                                                      <% } %>  
                                                                    </ul>

                                                                  </div>

                                                                <% if (ele.offer === true) { %>    
                                                                  <span class="border border-warning tagOfferUser" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                                                <% } else { %>
                                                                  <span class="border border-warning tagOfferUser invisible" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                                                <% }; %>  

                                                                <% if (ele.soldOut === true) { %>    
                                                                  <span class="tagSoldOutUser" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 80px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span> 
                                                                <% } else { %>
                                                                  <span class="tagSoldOutUser invisible" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 90px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span>
                                                                <% }; %>

                                                            <% }; %>
                                                                
                                                          <% } else { %> <!-- en el caso de que haya un usuario logeado pero no es el dueño de la tienda --> 

                                                                <% if (ele.department !== 'raffle' ){ %>
                                                                
                                                                  <% if (ele.soldOut === true) { %>
                                                                      <div class="dropdown d-flex justify-content-start" style="position: absolute; top: 30px; z-index: 200; width: 100%;">
                                                                        <i class="bi bi-three-dots-vertical mx-2 p-1 rounded-pill d-flex justify-content-center setting" data-bs-toggle="dropdown"></i>
                                                                                                              
                                                                          <ul class="dropdown-menu" aria-labelledby="dropdownMenu2" style="background-color: rgba(255, 255, 255, 0.9)">
                                                                        
                                                                              <li class="no-select"> <button class="purchaseTime dropdown-item"> <small> Avisarme cuando este disponible </small>  <input type="hidden" value="<%= ele.department %>"> <input type="hidden" value="<%= ele._id %>"></button></li>                                                                                                                      
                                                                          
                                                                          </ul>
                                                                

                                                                      </div>
                                                                      <div class="alert alert-light boxDetailPT border border-secondary mx-1 close" style="position: absolute; top: 40px; z-index: 200; width: 96%;">
                                                                        
                                                                      </div>
                                                                  <%  }; %>

                                                                <% }; %>     

                                                          <% }; %>  
                                        
                                              

                                                      <% }; %>  
                                                    

                                                      <div class="carousel-inner" style="position: relative; width: 100%; height: 220px;  z-index: 1;">
                                                        
                                                        <% if (ele.offer === true) { %>    
                                                          <span class="border border-warning tagOffer" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span> 
                                                        <% } else { %>
                                                          <span class="border border-warning tagOffer invisible" style="z-index: 100; background-color: #fcda57; width: 80px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                                        <% }; %> 

                                                        <% if (ele.soldOut === true) { %>    
                                                          <span class="tagSoldOut" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 80px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span> 
                                                        <% } else { %>
                                                          <span class="tagSoldOut invisible" style="z-index: 100; border: 1px solid #520101; background-color: #d30404; width: 90px; height: 20px; position: absolute; top: 0; left: -3px; border-bottom-right-radius: 14px;"> <span style="position: absolute; top: -4px; right: 11px; color: #ffffff;"> <small> Agotado </small> </span> </span> 
                                                        <% }; %> 

                                                        <div class="carousel-item active">
                                                          <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>"> 
                                                            <img src="<%= ele.images[0].url%>" class="imgFront" alt="...">
                                                          </a>
                                                        </div>
                                                        <% for (let x=1; x < ele.images.length; x++) { %>
                                                          <% const element=ele.images[x] %>
                                                            <div class="carousel-item">
                                                              <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>"> <img src="<%= element.url %>" class="d-block w-100"
                                                                style="  width: 100%; height: 100%; object-fit: cover;">
                                                              </a>
                                                            </div>

                                                        <% }; %>
                                                      </div>

                                                      <button class="carousel-control-prev" type="button"
                                                        data-bs-target="#carouselExampleControls<%= i %>" data-bs-slide="prev">
                                                        <span class="carousel-control-prev-icon"></span>
                                                        <span class="visually-hidden">Previous</span>
                                                      </button>
                                                      <button class="carousel-control-next" type="button"
                                                        data-bs-target="#carouselExampleControls<%= i %>" data-bs-slide="next">
                                                        <span class="carousel-control-next-icon"></span>
                                                        <span class="visually-hidden">Next</span>
                                                      </button>
                                                    </div>
                                        
                                                </div>

                                                <hr class="m-0">

                                                <!-- parte baja de la tarjeta donde esta la descripcion y el favorito -->
                                                <!-- esta parte va a cambiar cuando sea oferta -->
                                                <% if (ele.department !== 'raffle') { %>
                                                  <% if (ele.offer === false) { %>
                                                  <div class="boxDetail" style="height: 140px; position: relative; background-color: #ffffff;">
                                                          <div class="containerDetails mx-2 " style="margin-bottom: 10px; margin-top: 10px;">
                        
                                                              <div class="title d-flex align-items-start">

                                                                <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>" class="text-dark lh-sm"
                                                                  style="text-decoration: none;">
                                                                  <%= ele.title %>
                                                                </a>                                            
                                                              
                                                              </div>
                          
                                                              <div class="storeFavorite d-flex justify-content-end" style="width: 100%; position: absolute; bottom: 52px; left: 0px; padding-left: 8px; padding-right: 8px;">
                                                                                            
                                                                 <!--  <a href="/account/<%= ele.username %>" class="ui grey ribbon label text-decoration-none" style="left: -22px;"> <%= ele.username %> </a> -->

                                                                <% if (user) { %> <!-- control de corazones fascinometro -->
                                                                  <i class="bi bi-heart ps-2 linkHeart" style="cursor: pointer; font-size: 17px;"><input type="hidden" value="<%= ele.department %>"><input type="hidden" value="<%= ele._id %>"></i>                                         
                                                                <% } %>
                            
                                                              </div>
                                                              
                                                              <div class="containerPriceIcon" style="width: 100%; position: absolute; bottom: 10px; left: 0px;">
                        
                                                                <div class="containerPrice d-flex justify-content-between px-2">

                                                                  <a class="ui yellow circular label px-1 text-decoration-none"> 
                                                                    <span style="font-size: 16px; color: black;"> <i class="bi bi-currency-dollar"></i> <%= ele.price %> </span> 
                                                                  </a>

                                                                  <div class="containerTresIconos d-flex">
                                                                    
                                                                    <div class="containerDelivery">
                                                                      <% if (ele.delivery === true) {%>
                                                                        <i class="bi bi-truck me-1"></i>
                                                                      <% }; %>  
                                                                    </div>     
                                                                    <div class="containerOnlyOneAvailable">
                                                                      <% if (ele.onlyOneAvailable === true) {%>
                                                                        <i class="bi bi-1-square-fill me-1"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                    <div class="containBestProduct">
                                                                      <% if (ele.bestProduct === true) {%>
                                                                        <i class="bi bi-award"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                  </div>
                                                                </div>
                        
                                                              </div>
                                                              
                          
                                                          </div>
                                                  </div>
                                                  <% } else { %>
                                                  <div class="boxDetail" style="height: 140px; position: relative; background-color: #fcda57;">
                                                            <div class="containerDetails mx-2 " style="margin-bottom: 10px; margin-top: 10px;">
                        
                                                              <div class="title d-flex justify-content-start"> 
                                                                  <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>" class="text-dark lh-sm"
                                                                    style="text-decoration: none;">
                                                                    <%= ele.title %>
                                                                  </a>                                            
                                                              </div>
                      
                                                              <div class="storeFavorite d-flex justify-content-end" style="width: 100%; position: absolute; bottom: 52px; left: 0px; padding-left: 8px; padding-right: 8px;">
                            
                                                                  <!-- <p class="m-0 badge bg-secondary text-light"><a href="/account/<%= ele.username %>" class="text-light text-decoration-none"><%= ele.username %></a> </p> -->
                                                                
                                                                  <!-- <a href="/account/<%= ele.username %>" class="ui grey ribbon label text-decoration-none" style="left: -22px;"> <%= ele.username %> </a> -->

                                                                <% if (user) { %> <!-- control de corazones fascinometro -->
                                                                  <i class="bi bi-heart ps-2 linkHeart" style="cursor: pointer; font-size: 17px;"><input type="hidden" value="<%= ele.department %>"><input type="hidden" value="<%= ele._id %>"></i>                                         
                                                                <% } %>
                            
                                                              </div>
                                                                                                                                
                                                              <div class="containerPriceIcon" style="width: 100%; position: absolute; bottom: 10px; left: 0px;">
                        
                                                                <div class="containerPrice d-flex justify-content-between px-2">

                                                                  <a class="ui yellow circular label px-1 text-decoration-none"> 
                                                                    <span style="font-size: 16px; color: black;"> <i class="bi bi-currency-dollar"></i> <%= ele.price %> </span> 
                                                                  </a>

                                                                  <div class="containerTresIconos d-flex">

                                                                    <div class="containerDelivery">
                                                                      <% if (ele.delivery === true) {%>
                                                                        <i class="bi bi-truck me-1"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                    <div class="containerOnlyOneAvailable">
                                                                      <% if (ele.onlyOneAvailable === true) {%>
                                                                        <i class="bi bi-1-square-fill me-1"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                    <div class="containBestProduct">
                                                                      <% if (ele.bestProduct === true) {%>
                                                                        <i class="bi bi-award"></i>
                                                                      <% }; %>  
                                                                    </div>
                                                                  </div>
                                                                </div>
                        
                                                              </div>
                                                              
                                                            </div>
                                                  </div>  
                                                  <% }; %>
                                                <% } else { %>
                                                  <div class="boxDetailRaffle" style="height: 140px; position: relative; background-color: #ffffff;">
                                                    <div class="containerDetails mx-2 " style="margin-bottom: 10px; margin-top: 10px;">
                                                      
                                                        <div class="title d-flex justify-content-start">
                                                            <a href="/product/<%= ele.department %>/<%= ele._id %>/<%= ele.titleURL %>" class="text-dark lh-sm"
                                                              style="text-decoration: none;">
                                                              <%= ele.title %>
                                                            </a>                                            
                                                        </div>                
                                                                                                                    
                                                        <div class="storeFavorite d-flex justify-content-end" style="width: 100%; position: absolute; bottom: 52px; left: 0px; padding-left: 8px; padding-right: 8px;">
                      
                                                            <!-- <p class="m-0 badge bg-secondary text-light"><a href="/account/<%= ele.username %>" class="text-light text-decoration-none"><%= ele.username %></a> </p> -->
                                                          
                                                            <!-- <a href="/account/<%= ele.username %>" class="ui grey ribbon label text-decoration-none" style="left: -22px;"> <%= ele.username %> </a> -->

                                                          <% if (user) { %> <!-- control de corazones fascinometro -->
                                                            <i class="bi bi-heart ps-2 linkHeart" style="cursor: pointer; font-size: 17px;"><input type="hidden" value="<%= ele.department %>"><input type="hidden" value="<%= ele._id %>"></i>                                         
                                                          <% } %>
                      
                                                        </div>

                                                        <div class="containerPriceIcon" style="width: 100%; position: absolute; bottom: 10px; left: 0px;">
                          
                                                          <div class="containerPrice d-flex justify-content-between px-2">
                                                            
                                                            <a class="ui yellow circular label px-1 text-decoration-none"> 
                                                              <span style="font-size: 16px; color: black;"> <i class="bi bi-currency-dollar"></i> <%= ele.price %> </span> 
                                                            </a>

                                                            <div class="containerTickets">
                                                              <div class="containerIconCategory">
                                                                <% if (ele.category == 'Gratis' ) {%>
                                                                <span class="rounded-1 p-0 d-flex justify-content-center align-items-center me-1" style="width: 25px; background-color: #131313;">
                                                                  <i class="bi bi-ticket-fill" style="color: rgb(17, 235, 235);"></i>
                                                                </span>
                                                                <% } else { %>
                                                                <span class="rounded-1 p-0 d-flex justify-content-center align-items-center me-1" style="width: 25px; background-color: #131313;">
                                                                  <i class="bi bi-ticket-fill" style="color: brown;"></i>
                                                                </span>
                                                                <% }; %>  
                                                              </div>
                                                            </div>
                                                          </div>
                  
                                                        </div>
                                                      
                                                    </div>
                                                  </div>
                                                <% }; %>  

                                            </div>

                                          </div>

                                        <% }; %>   

                                    <% }); %>

   

                                </div>

                                <div class="paginate d-flex justify-content-center align-items-center mt-4 mb-5" style="position: relative; z-index : 120 !important">
                                  <nav aria-label="...">
                                    <ul class="pagination  m-0">
                                      <% if (paginate) { %>
          
                                        <% if ( paginate.pagina == 1 ) { %>
                                        <li class="page-item disabled">
                                          <a class="page-link" href="?paginate=first"> <i class="bi bi-arrow-bar-left"></i> 1</a>
                                        </li>
                                        <% } else { %>
                                          <li class="page-item">
                                            <a class="page-link" href="?paginate=first"> <i class="bi bi-arrow-bar-left"></i> 1</a>
                                          </li>  
                                        <% }; %>  
          
                                        <% if ( paginate.pagina == 1 ) { %>
                                        <li class="page-item prev disabled">
                                          <a class="page-link" href="?paginate=prev"> Prev</a>
                                        </li>
                                        <% } else { %>
                                        <li class="page-item prev">
                                          <a class="page-link" href="?paginate=prev"> Prev </a>
                                        </li>  
                                        <% }; %>
                                        <li class="page-item active">
                                          <span class="page-link pagina"><%= paginate.pagina %></span>
                                        </li>
                                        <% if ( paginate.pagina == paginate.totalPagina ) { %>
                                        <li class="page-item next disabled">
                                          <a class="page-link" href="?paginate=next"> Next</i></a>
                                        </li>
                                        <% } else { %>
                                        <li class="page-item next">
                                          <a class="page-link" href="?paginate=next"> Next</i> </a>
                                        </li>  
                                        <% }; %>
          
                                        <% if ( paginate.pagina == paginate.totalPagina ) { %>
                                        <li class="page-item disabled">
                                          <a class="page-link" href="?paginate=last"> <%= paginate.totalPagina %> <i class="bi bi-arrow-bar-right"></i></a>
                                        </li>
                                        <% } else { %>
                                        <li class="page-item">
                                          <a class="page-link" href="?paginate=last"> <%= paginate.totalPagina %> <i class="bi bi-arrow-bar-right"></i></a>
                                        </li>  
                                        <% }; %>  
          
                                      <% }; %>
                                    </ul>
                                  </nav>
                                </div>


                              <% } else { %>

                                <div class="ContainerMessage d-flex justify-content-center p-2" style="background-color: rgba(219, 223, 228, 0); width: 100%; margin-top: 80px; margin-bottom: 80px;">
                              
                                        <div class="containerImg border border-warning rounded-pill p-3" style="background-color:<%= storeProfile.bGColorTopbar%>; width: 140px; height: 140px;">
                                          <img src="/img/Lupa_sinResultados.png" alt="lupa" class="lupaSinRespuesta"  style="width: 140px; height: 140px;">
                                        </div>  
                              
                                </div>

                              <% }; %>
                              
                        </div>



                    </div>
                  </div> 

                           
                  <!-- este es el popup lista de compras -->
                  <div class="listShoppingCart close" id="popupCart" 
                  style="position: fixed; top: 50px; right: 10px; max-height: 510px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); padding: 15px; overflow-y: auto; z-index: 500;">
                    
                      <div class="title d-flex justify-content-between">
                        <h3>Lista de compra </h3>   <span class="closePopupCartList cursor-pointer"> <i class="bi bi-x-lg"></i> </span> 
                      </div>
                      

                      <table class="table">
                          <thead>
                            <tr style="font-size: 16px"> <!-- deleteALLElements este será un boton que permite eliminar todos los elementos del carrito y dejarlo en cero --->
                              <th style="text-align: left; font-size: 17px;" class="cursor-pointer deleteALLElements"> <i class="bi bi-x-square-fill"></i> </th>
                              <th style="text-align: left;">Descrip.</th>
                              <th style="text-align: center;">Cant.</th>
                              <th style="text-align: right;">P.&nbsp;Unit.</th>
                              <th style="text-align: right;">Total</th>
                            </tr>
                          </thead>
                          <tbody id="cartItems">
                            <!-- Aquí agregas las filas con JS -->

                          </tbody>
                          <tfoot>
                            <tr>
                              <td colspan="4" style="font-size: 16px; text-align: right; font-weight: bold; border-top: 1px solid #ccc;">Total a pagar:</td>
                              <td id="totalPagar" style="font-size: 16px; text-align: right; font-weight: bold; border-top: 1px solid #ccc;">$0.00</td>
                            </tr>
                          </tfoot>
                      </table>



                      <% if (searchProfile.length !==0 ) { %>
                          <!-- este usuario tiene perfil -->
                          <!-- este es el perfil del usuario visitante o cliente -->
                          <% clientName = searchProfile[0].names %>
                          <% clientIndentification = searchProfile[0].identification %>
                          <% clientPhone = searchProfile[0].phone %>
                          <% clientAddress = searchProfile[0].address %>
                         
<!-- 
                          <div class="alert alert-info">
                            <b> Obligatorio * </b> 
                          </div>  
 -->
                          <div class="form-group my-2">
                            <input type="text" class="form-control" id="clientName" value="<%= clientName %>" placeholder="Nombre de quien recibirá la compra">
                          </div>

                          <div class="d-flex justify-content-between form-group my-2">
                            <input type="text" class="form-control" id="clientIndentification" style="width: 49%;" value="<%= clientIndentification %>" placeholder="Documento">
                            <input type="text" class="form-control" id="clientPhone" style="width: 49%;" value="<%= clientPhone %>" placeholder="Telefono">
                          </div>

                          <div class="form-group my-2">
                            <textarea class="form-control"  id="clientAddress" rows="2" placeholder="Dirección a donde va esta compra"><%= clientAddress %></textarea>
                          </div>

                          <div class="form-group my-2">
                            <select id="selectDeliveryOptions" class="form-control">

                              <option value="" style="font-style: italic;"> -- Elija una opción. -- </option>

                              <% if (deliveryOptions.pickupInStore === "true"){ %>
                                <option value="D01">Retiro en Tienda.</option>
                              <% } %>  
                              
                              <% if (deliveryOptions.pickupAtAgreedPlace === "true"){ %>
                                <option value="D02">Entrega en lugar acordado.</option>
                              <% }; %>  

                              <% if (deliveryOptions.shippingToCustomer === "true"){ %>
                                <option value="D03">Delivery en la puerta del cliente.</option>
                              <% }; %>  
                              
                            </select>
                          </div>

                          <div class="form-group my-2">
                            <textarea class="form-control" id="orderDetail" rows="2" placeholder="Si desea agregar algún detalle, hágamelo saber."></textarea>
                          </div>
                          

                          <div class="dataMissing">
                          <!--  alert dinamico -->
                          </div>                          

                          <div class="form-group my-3">
                            <button class="form-control btn btn-primary rounded-2" id="consolidate">
                              Consolidar Pedido
                            </button>
                          </div>

                      <% } else { %> 
                      <!-- este usuario tiene perfil -->
                      <div class="alert alert-info">
                        <b> ¡Importante! </b> Para gestionar compras, requiere perfil. <b> <i> <a href="/myaccount/profile">Ingrese aquí</a> </i>  </b>
                      </div>  

                      <div class="dataMissing">
                      <!--  alert dinamico -->
                      </div>

                      <div class="form-group my-3">
                        <button class="form-control btn btn-primary rounded-2" id="noConsolidate">
                          Consolidar Pedido
                        </button>
                      </div>

                      <% } %>

                    

                  </div>

                  <div class="containerViewRatesStore border close" style="background-color: white;">
                    <div class="containert">
                      <div class="modal-header" style="background-color: white;">
                        <h6 class="modal-title">Ver Calificaciones y Opiniones</h6>
                        <i class="bi bi-x-lg cursor-pointer" id= "btnXCloseViewRate"></i>
                      </div>
                      
                      <div class="row m-0 bodyAnalisi d-flex justify-content-between">

                        <div class="col-xl-3 col-lg-3 col-md-5 col-sm-6 p-0 containerPoint d-flex flex-column justify-content-center align-items-center px-2">
                            
                            <p class="pountrateView p-0 mb-1" style="font-size: 40px;"> <!-- 4.8 --> </p>
                            <div class="boxstarView"> <!-- ***** --> </div>
                            <p class="countrateView"> <!-- 56 --> </p>

                        </div>

                        <div class="col-xl-9 col-lg-9 col-md-6 col-sm-6 p-0 containerRatePercentBar px-3">
                                                                  
                              <div class="contentBar d-flex my-1" style="height: 25px;">

                                <span class="p-0 ms-2" style="width: 10%;"> <small class="m-0"> 5 <i class="bi bi-star-fill p-0 m-0"></i> </small>  </span>
                                <div class="progress py-1 mt-1" id="barStar5" style="width: 90%;">
                                  <!-- dinamico -->
                                </div>

                              </div>

                              <div class="contentBar d-flex my-1" style="height: 25px;">

                                <span class="p-0 ms-2" style="width: 10%; height: 100%;"> <small class="m-0"> 4 <i class="bi bi-star-fill p-0 m-0"></i> </small>  </span>
                                <div class="progress py-1 mt-1" id="barStar4" style="width: 90%;">
                                  <!-- dinamico -->
                                </div>

                              </div>

                              <div class="contentBar d-flex my-1" style="height: 25px;">

                                <span class="p-0 ms-2" style="width: 10%; height: 100%;"> <small class="m-0"> 3 <i class="bi bi-star-fill p-0 m-0"></i> </small>  </span>
                                <div class="progress py-1 mt-1" id="barStar3" style="width: 90%;">
                                  <!-- dinamico -->
                                </div>

                              </div>

                              <div class="contentBar d-flex my-1" style="height: 25px;">

                                <span class="p-0 ms-2" style="width: 10%; height: 100%;"> <small class="m-0"> 2 <i class="bi bi-star-fill p-0 m-0"></i> </small>  </span>
                                <div class="progress py-1 mt-1" id="barStar2" style="width: 90%;">
                                  <!-- dinamico -->
                                </div>

                              </div>

                              <div class="contentBar d-flex my-1" style="height: 25px;">

                                <span class="p-0 ms-2" style="width: 10%; height: 100%;"> <small class="m-0"> 1 <i class="bi bi-star-fill p-0 m-0"></i> </small>  </span>
                                <div class="progress py-1 mt-1" id="barStar1" style="width: 90%;">
                                  <!-- dinamico -->
                                </div>

                              </div>
                            
                        </div>
                        
                      </div>
                      <div class="row m-0 my-3">
                        <div class="col-12 d-flex py-2" style="overflow-x: auto;">
                            <button class="btn btn-secondary rounded-pill px-2 py-1 mx-2 d-flex justify-content-center align-items-center btnRateAll" style="width: 90px; height: 40px;"> <span class="d-flex mx-1">Todos <i class="bi bi-star ms-1"></i> </span> </button>
                            <button class="btn btn-secondary rounded-pill px-2 py-1 mx-2 d-flex justify-content-center align-items-center btnRate5" style="width: 90px; height: 40px;"> <span class="d-flex mx-1">5 <i class="bi bi-star ms-1"></i> </span> </button>
                            <button class="btn btn-secondary rounded-pill px-2 py-1 mx-2 d-flex justify-content-center align-items-center btnRate4" style="width: 90px; height: 40px;"> <span class="d-flex mx-1">4 <i class="bi bi-star ms-1"></i> </span> </button>
                            <button class="btn btn-secondary rounded-pill px-2 py-1 mx-2 d-flex justify-content-center align-items-center btnRate3" style="width: 90px; height: 40px;"> <span class="d-flex mx-1">3 <i class="bi bi-star ms-1"></i> </span> </button>
                            <button class="btn btn-secondary rounded-pill px-2 py-1 mx-2 d-flex justify-content-center align-items-center btnRate2" style="width: 90px; height: 40px;"> <span class="d-flex mx-1">2 <i class="bi bi-star ms-1"></i> </span> </button>
                            <button class="btn btn-secondary rounded-pill px-2 py-1 mx-2 d-flex justify-content-center align-items-center btnRate1" style="width: 90px; height: 40px;"> <span class="d-flex mx-1">1 <i class="bi bi-star ms-1"></i> </span> </button>
                        </div>
                      </div>

                      <div class="bodyRates p-3" id="bodyRates" style="min-height: max-content; max-height: 80vh; overflow-y: auto;">
                        <!-- dinamico -->
                      </div>
                      

                      <div class="bodyFooter d-flex justify-content-end my-3">
                          <button type="button" class="btn btn-dark rounded-pill btnCloseViewRate px-4 me-3">Cerrar Calificaciones</button>
                      </div>
                    </div>
                  </div>
                  
                  <div class="containerInfoBliss close"  id="infoblis" style="height: auto; background-color: rgba(255, 255, 255, 0.9); color: #131313;">
                    <!-- este contenedor es donde vamos a mostrar todo lo referente a infoblis para esta tienda -->
                     
                      <div class="containerPolity close px-5 py-5">
                        <div class="mainSurvey d-flex flex-column align-items-center justify-content-center">
                              <div class="title my-3"> <h5> Politicas de la Tienda </h5> </div>
                              <input type="hidden" id="dataPolicy" value="<%= policy.data %>">
                              <div class="mt-2" id="quillPolicy" style="border: none;"></div>
                          </div>
                      </div>

                      <div class="containerFaqs close px-5 py-5"> 
                        <div class="mainSurvey d-flex flex-column align-items-center justify-content-center">
                            <div class="title my-3"> <h5> Preguntas  y Respuestas mas Frecuentes (FAQs)  </h5> </div>
                            <input type="hidden" id="dataFaq" value="<%= faq.data %>">
                            <div class="mt-2" id="quillFaq" style="border: none;"></div>
                        </div>
                      </div>

                     <div class="containerSurvey close">
                      
                      <% if (user) { %> 
                  
                            <% if (survey.scheme.length !==0 ) { %>
                                <% const surveyId = survey.scheme.surveyId %> <% const surveyTime = survey.scheme.surveyTime %> 
                                <% const surveyTitle = survey.scheme.surveyTitle %>
                              
                                <input type="hidden" value="<%= surveyId %>" id="surveyId">  
                                <input type="hidden" value="<%= surveyTitle %>" id="surveyTitle">
                                <input type="hidden" value="<%= surveyTime %>" id="surveyTime">
                               

                                <div class="containerSurveyCustomer">
                                  <p class="ps-3 pt-2"> ID : <span class="alert-secondary rounded-2 px-2 mx-2"> <%= surveyId %> </span> <i class="bi bi-calendar2-week"></i> : <span class="alert-secondary rounded-2 px-2 mx-2"> <%= surveyTime %> </span> </p>
                                      <% const surveyData = survey.scheme.surveyData %> <!-- esto es un array -->
                                      <input type="hidden" id="surveyDataInput" value="<%= JSON.stringify(surveyData) %>">

                                  <div class="carousel-images p-2"> <!-- carousel-images es la clase de slick-carousel -->

                                      <% const totalElements = surveyData.length %>
                                      <input type="hidden" id="totalQuestions" value="<%= totalElements %>">     
                                      <% surveyData.forEach((ele, card)=>{ %>
                                        
                                        <div class="contentSurvey px-3">   
                                            
                                            <div class="card shadow" style="width: 320px; height: 260px; overflow-y: auto;">
                                                <div class="card-header">
                                                    <p class="my-2"> <%= ele.question %> </p>
                                                </div>
                                                <div class="card-body" style="position: relative;">
                                                                                                    
                                                    <% const responses = ele.boxResponses %>

                                                    <% responses.forEach((resp, i)=>{ %>

                                                        <% if (resp !== "likert" ) { %> 
                                                            <div class="form-check form-check-inline mt-2">
                                                                <input class="form-check-input radioQuestion" type="radio" name="inlineRadio<%= card %>" id="inlineRadio<%= card %><%= i %>" value="<%= resp %>">
                                                                <label class="form-check-label" for="inlineRadio<%= card %><%= i %>"><%= resp %></label>
                                                            </div>
                                                        <% } else { %>
                                                            <div class="contentLikert mt-2">
                                                                <div class="alert alert-dark d-flex justify-content-between">
                                                                
                                                                    <div class="boxLikert card<%= card %> border border-dark shadow" data-value="Muy Malo"> <i class="bi bi-emoji-frown" style="font-size: 20px;"></i> </div>
                                                                    <div class="boxLikert card<%= card %> border border-dark shadow" data-value="Malo"> <i class="bi bi-emoji-expressionless" style="font-size: 20px;"></i> </div>
                                                                    <div class="boxLikert card<%= card %> border border-dark shadow" data-value="Regular"> <i class="bi bi-emoji-astonished" style="font-size: 20px;"></i> </div>
                                                                    <div class="boxLikert card<%= card %> border border-dark shadow" data-value="Bueno"> <i class="bi bi-emoji-smile" style="font-size: 20px;"></i> </div>
                                                                    <div class="boxLikert card<%= card %> border border-dark shadow" data-value="Muy Bueno"> <i class="bi bi-emoji-heart-eyes" style="font-size: 20px;"></i> </div>
                                                                </div>
                                                            </div>
                                                        <% } %>    

                                                    <%  }) %>
                                                    <div style="position: absolute; bottom: 10px; right: 10px;"> <span class="alert-secondary rounded-pill px-2 mx-2"> <%= card + 1 %> / <%= surveyData.length + 1 %> </span> </div>   
                                                </div>
                                            </div>

                                        </div>

                                      <% }); %>

                                        <div class="contentSurvey px-3">   
                                            
                                          <div class="card shadow" style="width: 320px; height: 260px; overflow-y: auto;">
                                              <div class="card-header">
                                                  <p class="my-2"> Enviar Encuesta </p>
                                              </div>
                                              <div class="card-body" style="position: relative;">      
                                                  <p class="mt-1">¡Fin de la encuesta! Agradecemos tu participación, tus respuestas son importantes para mejorar. ¡Gracias!"</p> 
                                                  <div class="form-group mt-4">
                                                    <button class="btn btn-primary form-control" id="btnSendSurvey">
                                                      Enviar  
                                                    </button>
                                                    
                                                    <button class="btn btn-primary form-control close" id="btnSendSurveyLock" disabled>
                                                      <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                                      Enviando ...
                                                    </button>

                                                  </div>  
                                              </div>
                                              <div style="position: absolute; bottom: 10px; right: 10px;"> <span class="alert-secondary rounded-pill px-2 mx-2"> <%= surveyData.length + 1 %> / <%= surveyData.length + 1 %> </span> </div> 
                                          </div>
                                            

                                        </div>    


                                  </div>
                                  <div class="containerSwipe d-flex justify-content-center mx-4 rounded-3" style="background-color: #ffffff;">
                                         <img src="/img/swipeAnimationLeft.gif" alt="" style="width: 80px;">
                                  </div> 
                                </div>

                                <div class="containerSurveyDone close" style="background-color: #ffffff;">
                                    <div class="containerFlex d-flex flex-column justify-content-center align-items-center py-4">  
                                      <h4 class="mb-4 mx-3">Felicidades encuesta realizada satisfactoriamente.</h4>
                                      <img src="/img/checkAnimation.gif" alt="" style="width: 300px;">
                                    </div>  
                                </div>

                                <div class="containerError close">
                                    <div class="containerFlex d-flex flex-column justify-content-center align-items-center py-4">
                                      <h4 class="mb-4 mx-3"> Ha habido un error, intente en unos minutos. </h4>
                                      <img src="/img/error28_2_2025.png" alt="" style="width: 150px;">
                                    </div>    
                                </div>   


                            <% } %>

                      <% } %>

                                           
                     </div>

                     <div class="containerLocation close"> 
                        
                           
                            <% if (geolocation.lat !== "") { %>
                               
                              <input type="hidden" id="mapDataLon" value="<%= geolocation.lon %>">
                              <input type="hidden" id="mapDataLat" value="<%= geolocation.lat %>">

                              <div id="mapStore" style="height: 500px;"></div>
                        

                            <% } else { %>
                              
                              <div class="contentLocation d-flex flex-column  justify-content-center align-items-center ">

                                <div class="d-flex justify-content-center my-2"> <span> <b> <h4> Geolocalización </h4> </b> </span> </div>
                                <img src="/img/geolocationIcon.png" alt="" style="width: 200px;">
                                
                                <div class="alert alert-primary py-2 px-5">
                                    <span> <i class="bi bi-geo-alt me-2"></i> Esta Tienda no posee una ubicación geografica. </span>
                                </div>
                                
                              </div>

                            <% }; %>
                            
 
                     </div>


                     <div class="form-group px-3 py-5">
                        <button class="form-control btn rounded-pill" id="btnBackToAds" style="background-color: <%= bGColorTopbar %>; color: <%= bGColorText %>; border: 1px solid <%= bGColorText %>"> Volver a los anuncios </button>
                     </div>


                  </div> 


                  <!-- cierre de storeProfile -->   
                  
              </div>

              <div class="mainGallery  p-0 ">
                  <% if (carouselOffert.show === true ) { %> <!-- true o false -->
                    <div class="contentGallery1 p-0" style="position: relative; z-index: 100; background-color:<%= bGColorGallery %>; height: auto">  

                          <% if (boxOffert) { %>
                          
                          <div class="carousel-offer p-4">    
                              <% boxOffert.forEach((ele)=>{ %>

                                  <div class="contentCard px-3 d-flex flex-column" style="position: relative;">
                                      <img src="<%= ele.images[0].url %>" alt="" style="width: 200px; height: 200px; object-fit: cover;">
                                      <span class="border border-warning" style="background-color: #fcda57; width: 70px; height: 20px; position: absolute; top: 0; right: 14px; border-bottom-left-radius: 10px;"> <span style="position: absolute; top: -4px; right: 11px;"> <small> <b>Oferta</b> </small> </span> </span>
                                      <span class="bg-warning px-2 py-0" style="border-radius: 50%; position: absolute; top: 30px; right: 30px;">  <small> <b>$<%= ele.price %></b>  </small>  </span>

                                      <div style="width: 200px; background-color: #fcda57; height: 40px; overflow: hidden">
                                          <span class="p-2" style="display: block; width: 100%; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;"> <%= ele.title %> </span>
                                      </div>
                                  </div>
                                  
                              <% }) %>
                          </div>
                          
                          <% } %>

                    </div>      
                  <% } %>

                  <% if (sectionMedia.show === true ) { %> <!-- true o false -->
                    <% const countMedia = sectionMedia.data.length  %>
                    <% const medias = sectionMedia.data %>

                    <% if (countMedia >= 1) { %>
                        <div class="container-fluid p-4" style="position: relative; z-index: 100; background-color:<%= bGColorGallery %>; height: auto">
                            <div class="row m-0 d-flex justify-content-between"> <!-- carousel-images es la clase de slick-carousel -->
                                <% medias.forEach((ele)=>{ %>
                                    
                                    <% if (ele.type === 'image'){ %>
                                        <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12 p-1">
                                          
                                            <img class="rounded-2" src="<%= ele.url %>"  style="width: 100%; height: 280px; object-fit: cover;">
                                          
                                        </div>
                                    <% } else { %>
                                        <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12 p-1">
                                            
                                            <video class="rounded-2" src="<%= ele.url %>" controls autoplay muted style="width: 100%; height: 280px; object-fit: cover;"></video>
                                          
                                        </div>
                                    <% }; %>


                                <% }); %>    
                            </div>    
                        </div>    
                    <% } %>    

                  <% } %> 


                  <% if (carouselImages.show === true ) { %> <!-- true o false -->

                    <div class="contentGallery2 p-0" style="position: relative; z-index: 100; background-color:<%= bGColorGallery %>; height: auto">

                          <% const countImages = carouselImages.data.length  %>
                          <% const carouselImg = carouselImages.data %> <!-- esto es un array -->

                          <% if (countImages >= 1) { %>
                            <div class="carousel-images p-4">
                                <% carouselImg.forEach((ele)=>{ %>
                                <div class="conteImg px-3 shadow-sm">   
                                    <img class="rounded-3" src="<%= ele.url %>" alt="" style="height: 280px; object-fit: cover;">
                                </div>
                                <% }); %>    
                            </div>    
                          <% } %>

                    </div>

                  <% } %>    


                  <% if (carouselBanner.show === true ) { %> <!-- true o false -->

                    <div class="containerGallery3 p-0"  style="position: relative; z-index: 100">
                      <% const countbanner = carouselBanner.data.length  %>
                      <% const carousel = carouselBanner.data %> <!-- esto es un array -->

                      <% if (countbanner >= 1) { %>
                          <div class="carousel-banner p-0" style="width: 100%;">
                          
                              <% carousel.forEach((ele)=>{ %>
                              
                                  <img src="<%= ele.url %>" alt="" style="height: 300px; object-fit: cover;" >                                                   
                              
                              <% }) %>

                          </div>
                      <% }; %>
                    </div>

                  <% } %>

              </div>

              <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 px-0" style="position: relative; z-index: 100;">

                <div class="containerDetailsMessajesRRSS pt-3 pb-1" style="height: auto; background-color:<%= bGColorTopbar%>;">
                    <% if (storeProfile) { %>
                    
                        <div class="containerMessager d-flex justify-content-start">

                          <p class="MessagerStore mb-0 mx-5" style="font-size: 18px; color: <%= storeProfile.bGColorText %>">
                            <i>
                              <%= storeProfile.profileMessage %>
                            </i>
                          </p>
                    
                        </div>
                        <div class="containerMainRRSS d-flex justify-content-end px-5">
                         
                          <div class="containerRRSS mx-5" style="height: 30px; width: 100%">
                                                         
                        
                            <div class="facebook mx-2">
                                <% if (storeProfile.facebook) { %>
                                  <a href="https://www.facebook.com/<%= storeProfile.facebook %>" target="_blank" style="color:<%= storeProfile.bGColorText %>"><i class="bi bi-facebook"></i></a>
                                <% } %>
                            </div>
                            <div class="instagram mx-2">
                              <% if (storeProfile.instagram) { %>
                                <a href="https://www.instagram.com/<%= storeProfile.instagram %>" target="_blank" style="color:<%= storeProfile.bGColorText %>"><i class="bi bi-instagram"></i></a>
                              <% } %>
                            </div>
                            <div class="youtube mx-2">
                              <% if (storeProfile.youtube) { %>
                                <a href="https://www.youtube.com/<%= storeProfile.youtube %>" target="_blank" style="color:<%= storeProfile.bGColorText %>"><i class="bi bi-youtube"></i></a>
                              <% } %>
                            </div>
                            <div class="tiktok mx-2">
                              <% if (storeProfile.tiktok) { %>
                                <a href="https://www.tiktok.com/<%= storeProfile.tiktok %>" target="_blank" style="color:<%= storeProfile.bGColorText %>"><i class="bi bi-tiktok"></i></a>
                              <% } %>
                            </div>

                                                    

                          </div>

                        </div>
                      
                    <% }; %>
                </div> 
                
                <footer class="" style="border: 1px solid transparent; height: auto; background-color:<%= bGColorTopbar%>;color:<%= bGColorText %>;">
                  
                  <div class="row mx-0 mt-4 contentClient d-flex justify-content-around align-items-center">
                    <div class="col-sm-6 col-md-6 col-lg-3 px-0 contentUserImg d-flex justify-content-center align-items-center my-2">
                        <div class="containerImg mx-2">
                          <% if (storeProfile.avatarPerfil[0].url.length === 0 ) {%>
                            <td> <img src="https://www.gravatar.com/avatar/<%= storeProfile.mailhash %>?d=identicon" class="rounded-3" style="width: 50px; height: 50px; object-fit: cover;"></td>   
                            <% } else {%>
                            <td><img src="<%= storeProfile.avatarPerfil[0].url %>" alt="" class="rounded-3" style="width: 50px; height: 50px; object-fit: cover;"></td>
                          <% }; %>
                        </div>
                        <div class="containerDetail my-2">
                          <p class="mb-0" style="color:<%= storeProfile.bGColorText %>"> <%= storeProfile.blissName %></p>
                          <% const dateStore = new Date( storeProfile.createdAt) %>
                          <% const dia = dateStore.getDate() %>
                          <% const mes = dateStore.getMonth() +1 %>
                          <% const anio = dateStore.getFullYear() %>

                          <% const currentAnio = new Date().getFullYear() %>

                          <span> <%= dia %>-<%= mes %>-<%= anio %> </span>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-6 col-lg-3 px-0 contentUserDetails d-flex justify-content-around align-items-center">
                      <div class="containerRate d-flex flex-column justify-content-end align-items-center mx-2 cursor-pointer" id="viewRateStore">
                        <span id="showRates"> <!-- Dinamic --> </span>
                        <span id="pountCalif"> <!-- Dinamic --> </span> 
                        <span id="pountCount"> <!-- Dinamico --> </span>
                      </div>

                    </div> 

                    <div class="col-sm-6 col-md-6 col-lg-3 px-0 contentUserImgDetails d-flex justify-content-around align-items-center">
                        <div class="containerYears my-2 d-flex flex-column align-items-center">
                          <p class="m-0" style="color:<%= storeProfile.bGColorText %>"><small><%= storeProfile.company %></small></p>
                          <p class="m-0" style="color:<%= storeProfile.bGColorText %>"><small><%= storeProfile.companyRif %></small></p>
                          <p class="m-0" style="color:<%= storeProfile.bGColorText %>"> <%= anio %> - <%= currentAnio %></p>
                        </div>
                    </div> 

                    <div class="col-sm-6 col-md-6 col-lg-3 px-0 contentUserImgDetails d-flex justify-content-around align-items-center">
                        <div class="containerYears my-2 rounded-3 d-flex flex-column align-items-center">
                          <p class="m-0" style="color:<%= storeProfile.bGColorText %>"><i class="bi bi-geo-alt me-1"></i> <small><%= storeProfile.country %></small></p>
                          <p class="m-0" style="color:<%= storeProfile.bGColorText %>"> <small><%= storeProfile.state %></small></p>
                          <p class="m-0" style="color:<%= storeProfile.bGColorText %>"> <small><%= storeProfile.quarter %></small></p>
                        </div>
                    </div>   
                  </div>

                  <!-- Este bloque es donde debo trabajar. Crear en administración infoBliss -->
                  <!-- es un modulo que permite crear FAQ, Terminos y condiciones, y encuestas. -->


                  <div class="container-fluid my-3 py-1 px-0 mx-0 containerInfo">
                      <div class="contentInfoBliss mx-5">

                      <% if (policy.show === true) {  %>                      
                        <a class="boderBtn btn-polity my-1 ps-1 pt-1 mx-4 rounded-pill shadow-sm text-decoration-none" style="color: <%= storeProfile.bGColorText %>; border: 1px solid <%= storeProfile.bGColorText %> ; width: 150px;">
                          
                          <div class="d-flex px-4 py-2 rounded-pill" style="background-color: rgba(19, 19, 19, 0.1); width: 150px;" >
                              <i class="bi bi-card-heading me-2"></i>
                              <div class="contenText d-flex flex-column ms-2 no-select">
                                  <span> <small> Politicas </small></span>
                              </div>
                          </div>

                        </a>  
                      <% } %>

                      <% if (faq.show === true) {  %>
                        <a class="boderBtn btn-faqs my-1 ps-1 pt-1 mx-4 rounded-pill shadow-sm text-decoration-none" style="color: <%= storeProfile.bGColorText %>; border: 1px solid <%= storeProfile.bGColorText %> ; width: 150px;">
                          
                          <div class="d-flex px-4 py-2 rounded-pill" style="background-color: rgba(19, 19, 19, 0.1); width: 150px;" >
                            <i class="bi bi-question-diamond me-2"></i>
                            <div class="contenText d-flex flex-column ms-2 no-select">
                              <span> <small> FAQs</small></span>    
                            </div>
                          </div>

                        </a> 
                      <% } %>

                      <% if (survey.show === true) {  %>
                        <input type="hidden" value="true" id="surveyShow">
                        <a class="boderBtn btn-survey my-1 ps-1 pt-1 mx-4 rounded-pill shadow-sm text-decoration-none" style="color: <%= storeProfile.bGColorText %>; border: 1px solid <%= storeProfile.bGColorText %> ; width: 150px;">
                          
                          <div class="d-flex px-4 py-2 rounded-pill" style="background-color: rgba(19, 19, 19, 0.1) ; width: 150px;" >
                            <i class="bi bi-card-checklist me-2"></i>
                            <div class="contenText d-flex flex-column ms-2 no-select">
                              <span> <small> Encuesta </small></span>
                            </div>
                          </div>

                        </a>
                      <% } %>     

                      <% if (map.show === true) {  %>
                        <a class="boderBtn btn-location my-1 ps-1 pt-1 mx-4 rounded-pill shadow-sm text-decoration-none" style="color: <%= storeProfile.bGColorText %>; border: 1px solid <%= storeProfile.bGColorText %> ; width: 150px;">
                          
                          <div class="d-flex px-4 py-2 rounded-pill" style="background-color: rgba(19, 19, 19, 0.1); width: 150px;" >
                            <i class="bi bi-geo-alt me-2"></i>
                            <div class="contenText d-flex flex-column ms-2 no-select">
                              <span> <small> Ubicación </small></span>
                            </div>
                          </div>

                        </a> 
                      <% } %>

                      </div> 
                  </div>

 

                  <div class="row m-0 p-4  contentBlissnet d-flex justify-content-center align-items-center" style="background-color: rgba(19, 19, 19, 0.1);">
                    <div class="col-sm-12 col-md-12 col-lg-12 px-0 contentPlatform  d-flex justify-content-center align-items-center">
                      <div class="containerBlisnetRedes my-2 rounded-3 d-flex flex-column align-items-center">
  
                        <p class="m-0" id="logoBlissenet_com" style="color:<%= storeProfile.bGColorText %>;"> </p>
                        <div class="contentRedes d-flex my-2">
                          <span class="itemOption"><a href="https://www.instagram.com/blissenetcom/"  style="color :<%= storeProfile.bGColorText %>"><i class="bi bi-instagram  me-3"></i></a></span>
                          <span class="itemOption"><a href="https://www.facebook.com/search/top?q=blissenetcom"  style="color :<%= storeProfile.bGColorText %>"><i class="bi bi-facebook me-3"></i></a></span>
                          <span class="itemOption"><a href="https://x.com/blissenetcom/" style="color :<%= storeProfile.bGColorText %>"><i class="bi bi-twitter-x  me-3"></i></a></span>
                        </div>
                       
                      </div>
                    </div>
                  </div>
                 
                </footer>

              </div>

              <% if (!user) { %>

                <div class="containerFixedSinUser">
                    <div class="d-flex flex-column"  style="position: fixed; right: 10px; bottom: 100px; z-index : 100">
                        <div class="d-flex justify-content-end px-4">

                            <span class="rounded-pill d-flex justify-content-center align-items-center cursor-pointer shadow-sm" id="btnXSinUser"  style="width: 40px; height: 40px; background-color: rgba(238, 238, 238, 0.9); color: black;">
                                <i class="bi bi-x-lg" id="bi-x-move" style="font-size: 16px;"></i>
                            </span> 
                          
                        </div>    
                        <div class="body fixedSinUser mx-2 mt-5">
                            
                            <div class="d-flex flex-column align-items-center justify-content-center">

                            <div style="position: relative;">

                                <div class="px-4 py-2 lightbulbAnimation shadow d-flex" style="background-color: #ffe372; font-size: 16px; color: #7a6202; border-top-left-radius: 12px; border-top-right-radius: 12px;"> 
                                    <span> No estas logeado </span>   
                                </div>
                                <div class="rounded-pill d-flex justify-content-center align-items-center" style="background-color: #ffe372; position: absolute; top: -40px; right:60px; width: 42px; height: 42px;">
                                <i class="bi bi-lightbulb-fill lightbulbAnimation" style="font-size: 28px;"></i>
                                </div>
                                
                            </div>
                            
                            </div>

                            <div class="form-group my-1 py-2" style="width: 100%; font-size: 24px;">

                            <a href="/myaccount/signin-change" class="form-control rounded-pill btn btn-dark border-secondary shadow" style="font-size: 20px;"> Entrar </a>

                            </div>
                        </div>
                    </div>
                </div> 

              <% }; %>
              
          </div>
      <% }; %>

  </main>

  <!-- CDN js Slick-carousel --> <!-- Es importante manejar los script del carrousel en el mismo archivo que se van a usar -->
  <!-- para no interferir en otros script cdn de jquey --> 
  <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
  <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" integrity="sha512-pUhApVQtLbnpLtJn6DuzDD5o2xtmLJnJ7oBoMsBnzOkVkpqofGLGPaBJ6ayD2zQe3lCgCibhJBi4cj5wAxwVKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <%- include('../partials/scripts.ejs') %>
  <%- include('../partials/carrousel.ejs') %>
  <%- include('../partials/scriptsOnlyNavi-simpleNoIcons.ejs') %>



  <script>
    const bGColorText = document.getElementById('bGColorText');
    const bGColorTopbar = document.getElementById('bGColorTopbar');
    const btnFollow = document.getElementById('btnFollow');
    const spanBtnFollow = document.getElementById('spanBtnFollow');

    const contentConfetyFollow = document.querySelector('.contentConfetyFollow');
    const buttonFollow = document.querySelector('.buttonFollow');
    const user = document.getElementById('iDLogeado'); 
    const userTienda = document.getElementById('iDStore'); 

    const shoppingCart = document.getElementById('shoppingCart').value; 
    //importante saber si tiene o no carrito activado

    btnFollow.addEventListener("click", ()=>{
      const BGColorTopbar = bGColorTopbar.value; const BGColorText = bGColorText.value;
      console.log(`BGColorTopbar ${BGColorTopbar} | BGColorText ${BGColorText}`) //colores cutomizados por el usuario de la tienda esto va solo en seguir
      const User = user.value; const UserTienda = userTienda.value;
      efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
      efectSoundExpan.play().catch(error => {
                console.error("Error al reproducir el sonido:", error);
            });
      
      
      
        const datos = {
            user : User, //este es el id del user
            userOfStore : UserTienda //este es el id de la tienda
        };
          
        //console.log("datos :", datos);

        fetch('/account/followStore', {

          method: "post",
          body: JSON.stringify(datos),
          headers: {"content-type" : "application/json"}

          })
          .then(response =>response.json() )
          .then( jsonx =>{
            

            console.log("ver aqui lo que llega despues de seguir a alguien ---->", jsonx)
            const type = jsonx.type;
            const note = jsonx.note; 
            // { "type" : "Following", "note" : "Tienda guardada y siguiendo" });
            // type puede ser Following, Error o stopFollowing 
            if (type === "Following"){
              //Seguir
              setTimeout(() => {
                contentConfetyFollow.innerHTML = "";
              }, 1900);
              
              console.log("empiezo a seguirla, cambiar el boton a Siguiendo");
              console.log("note ->", note);
              contentConfetyFollow.innerHTML = `<img src="/img/gif-1.gif" alt="" style = "width: 180px; height: 90px;">`;
              spanBtnFollow.innerText = "";
              spanBtnFollow.innerText = "Siguiendo";
              buttonFollow.style.cssText = "background-color : #131313; color : #ffffff; border: 1px solid #ffffff";

       

            } else if (type === "stopFollowing") {
              //Siguiendo
              console.log("deje de seguirla, cambiar al boton Seguir. ")
              console.log("note ->", note);
              spanBtnFollow.innerText = "";
              spanBtnFollow.innerText = "Seguir";
              buttonFollow.style.cssText = `background-color : ${BGColorTopbar}; color : ${BGColorText}; border : 1px solid ${BGColorText}`;
  
         
            } else {
              console.log("Ha ocurrido un error");
              console.log("note ->", note);
            }

            
          })
          .catch( err => console.log(err));




    });

    
  </script>



<script>
  
  // popover chat de bliss 
  // Selecciona el botón con la clase 'popoverChatDeBliss'
  const popoverButtonChat = document.querySelector('.popoverChatDeBliss');

  // Inicializa el popover de Bootstrap
  const popoverInstance = new bootstrap.Popover(popoverButtonChat);

  // Función para mostrar/ocultar el popover
  function togglePopover() {
      const isVisible = popoverInstance._isShown;
      if (isVisible) {
          popoverInstance.hide();
      } else {
          popoverInstance.show();
      }
  }

  // Añade evento al botón
  popoverButtonChat.addEventListener('click', (event) => {
      event.stopPropagation(); // Evita que el clic en el botón cierre el popover inmediatamente
      togglePopover();
  });

  // Cierra el popover si se hace clic en cualquier parte de la página
  document.addEventListener('click', () => {
      popoverInstance.hide();
  });


</script>



<script>
  const formSegment = document.getElementById('formSegment');
  const floatingSelect = document.getElementById('floatingSelect');
  const store_indexed = document.getElementById('store_indexed');
  const store_username = document.getElementById('store_username');

  floatingSelect.addEventListener('change', ()=>{
    
    const segment = floatingSelect.value;
    const storeIndexed = store_indexed.value;
    const storeUsername = store_username.value;
    console.log("segment -->", segment);
    console.log("storeIndexed -->", storeIndexed);
    //aqui se forma el url donde se va a mandar
    formSegment.action=`/account/${storeUsername}/${segment}`;
    console.log("formSegment -->", formSegment);
    formSegment.submit();
      
  })

</script>

<script>
  const formSearch = document.getElementById('formSearch');
  const storeSearch = document.getElementById('storeSearch');
  const segmentSearch = document.getElementById('segmentSearch');
  const elementSearch = document.getElementById('elementSearch');
  const submitSearch = document.getElementById('submitSearch');
  let element; //se usa abajo puede tener dos valores vacio o con alguna informacion
  //si es vacio ira con un string "null", esto es porque en el url debe viajar algo siempre sino
  //no conocera la direccion donde va.

  if (formSearch){
    formSearch.addEventListener('submit', function(event) {
      event.preventDefault(); // Evita que el formulario se envíe automáticamente
      // Aquí puedes ejecutar tu lógica o enviar el formulario manualmente
      console.log('Formulario enviado manualmente');
      // Si deseas enviar el formulario, puedes hacerlo aquí
    });
  }

  if (submitSearch){
    submitSearch.addEventListener('click', function() {
      // Aquí puedes decidir cuándo enviar el formulario
      console.log("Datos obtenidos del buscador para enviar al backend");
      
      const store = storeSearch.value;
      const segment = segmentSearch.value;
      element = elementSearch.value;

      if (element === "" ){
        element = "null";
      } 
      
      console.log("store --->", store);
      console.log("segment --->", segment);
      console.log("element --->", element);
      
      formSearch
      //aqui se forma el url donde se va a mandar
      //action="/account/search/store/Segment/search"
      formSearch.action=`/account/search/${store}/${segment}/${element}`;
      console.log("formSegment -->", formSegment);
      formSearch.submit();

    });

  }

    
  
</script>


<script>

  const store = document.querySelector('.store');
  
  const Store = store.childNodes[1].value;
  //console.log("Esto es Store ----------->",Store);
  

</script>



<!-- script para extraer calificacion de una tienda -->
<script>
  const showRates = document.getElementById('showRates');
  const pountCalif = document.getElementById('pountCalif');
  const pountCount = document.getElementById('pountCount');
  let ratesLength;
 //console.log("Esto es Store ----------->",Store);

  const rate = {
    storeName : Store
  };

  //console.log("Aqui estamos enviando el username de la tienda", rate);

  fetch('/account/pountRate', {

    method: "post",
    body: JSON.stringify(rate),
    headers: {"content-type" : "application/json"}

  })
    .then(response =>response.json() )
    .then( jsonx =>  {
      
        console.log("recibiendo del backend '/account/pountRate'->", jsonx);
        const boxRates = []; //aqui meto todas las calificaciones parseadas a numeros
        jsonx.forEach((ele)=>{
          const markStar = ele.markStar;
          console.log("markStar ......:", markStar);
          const markstar = parseInt(markStar);
          boxRates.push(markstar)
        })
        console.log("boxRates", boxRates);
        ratesLength = boxRates.length;
        //console.log("ratesLength ......:", ratesLength); // indica la cantidad de elementos o puntuaciones realizadas a esta tienda.
        //ahora hacemos el calculo para saber cual es la media de las calificaciones aportadas por los usuarios 
        let sumRate = 0;
        boxRates.forEach((ele)=>{
          const stars = ele
          //console.log("stars >", stars)
          sumRate = sumRate + stars; 
        })

        console.log("sumRate", sumRate);
        console.log("ratesLength", ratesLength);
        const pount = (sumRate / ratesLength);
        const pountRate = pount.toFixed(1); 
        console.log("pountRate ......:", pountRate)

        //ratesLength = 2458965; para probar
        if ( isNaN(pountRate)){
          showRates.innerText = "Sin Calificaciones" ;
          pountCalif.innerHTML = `0 <i class="bi bi-star-fill"></i>`;
          pountCount.innerHTML = `(0)`
        } else {
          showRates.innerText = "Ver Calificaciones" ;
          pountCalif.innerHTML = `${pountRate} <i class="bi bi-star-fill"></i>`;
          
          //pountCount.innerHTML = `(${ratesLength})`
          if (ratesLength <= 999){
              pountCount.innerHTML = `<spam style="font-size:13px">(${ratesLength})</spam>`;
            } else if (ratesLength >= 1000 && ratesLength <= 999999 ){
              const reduccion = (ratesLength / 1000)
              const result = reduccion.toFixed(2);
              pountCount.innerHTML = `<spam style="font-size:13px">(${result}K)</spam>`; 
            } else if (ratesLength >= 1000000 && ratesLength <= 999999999 ){
              const reduccion = (ratesLength / 1000000)
              const result = reduccion.toFixed(2);
              pountCount.innerHTML = `<spam style="font-size:13px">(${result}M)</spam>`; 
            }
        }



      
      })
    .catch( err => console.log(err));

</script>

<script>
  const viewRateStore = document.getElementById('viewRateStore'); //esto es el boton para ver las calificaciones
  const containerWorkSpace = document.querySelector('.containerWorkSpace');
  const containerViewRatesStore = document.querySelector('.containerViewRatesStore'); //contenedor que porta toda la vista de las calificaciones.
  const btnXCloseViewRate = document.getElementById('btnXCloseViewRate'); //icono x para cerrar
  const btnCloseViewRate = document.querySelector('.btnCloseViewRate'); //boton verde para cerrar


  viewRateStore.addEventListener('click', ()=>{

    //ratesLength = 0; para probar cuando ete en cero.
    console.log("ratesLength ....:", ratesLength);
    

    if (ratesLength !== 0){

      containerSegment.classList.add('close');
      containerWorkSpace.classList.add('close');
      mainGallery.classList.add('close');
      containerInfoBliss.classList.add('close');
      //popupCart.classList.add('close'); //cerramos la lista del carrito si lo tiene. REVISAR
      
      containerViewRatesStore.classList.remove('close');
      
      efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
      efectSoundExpan.play().catch(error => {
          console.error("Error al reproducir el sonido:", error);
      });    

      irATopBar() //nos llevan al lugar que se debe en el DOM

    }     

  })

  btnXCloseViewRate.addEventListener('click', ()=>{

    containerSegment.classList.remove('close');
    containerWorkSpace.classList.remove('close');
    mainGallery.classList.remove('close');

    containerInfoBliss.classList.add('close');
    containerViewRatesStore.classList.add('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    }); 

  })

  btnCloseViewRate.addEventListener('click', ()=>{

    containerSegment.classList.remove('close');
    containerWorkSpace.classList.remove('close');
    mainGallery.classList.remove('close');

    containerInfoBliss.classList.add('close');
    containerViewRatesStore.classList.add('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    }); 

  })
  


</script>

<script>
  const contentAdmin = document.querySelector('.contentAdmin');
  
  contentAdmin.addEventListener('click', ()=>{
    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    });
  })
</script>

<!-- script para controlar todo el modulo de compartir -->
<script>
  const shareToggle = document.querySelector('.shareToggle');
  const containerShare = document.querySelector('.containerShare');
  const btnClicBoard = document.getElementById('btnClicBoard');
  const btnClicBoardCheck = document.getElementById('btnClicBoardCheck');
  const linkToShare = document.getElementById('linkToShare'); //374 linea
  const btnQR = document.getElementById('btnQR');
  const canvas = document.getElementById('qr-canvas');

   

  shareToggle.addEventListener('click', ()=>{
    containerShare.classList.toggle('invisible')

  })

 
  //copiar link de tienda en el portapapeles
  btnClicBoard.addEventListener('click', ()=>{
    const storeToShare = linkToShare.value;
    navigator.clipboard.writeText(storeToShare)
      .then(function(){
       
        btnClicBoard.classList.add('invisible');
        btnClicBoardCheck.classList.remove('invisible');
        setTimeout(clipboardDone, 1000)
        
        function clipboardDone(){
          btnClicBoardCheck.classList.add('invisible');
          btnClicBoard.classList.remove('invisible');
        }

      })
      .catch(function(error){
        alert("error al copiar" + e);
      })
    
  })

  //fabricar Codigo QR
  btnQR.addEventListener('click', ()=>{

    const store = linkToShare.value;
    const url = `${store}`;
    console.log("url", url);

    const qr = new QRious({
        element: canvas, //en el contenedor donde ira.
        value: url, // informacion que codificara.
        size: 200, // calidad del codigo
        foreground: '#9200ff' // Establece el color violeta
    });

  })

</script>


  <!-- script que crea la media de las calificaciones -->
  <script>

    console.log("Store >", Store);

    const pountrate = document.getElementById('pountrate');
    const boxStar = document.querySelector('.boxStar'); 
    const messagevalue = document.querySelector('.containerMessagevalue'); 

    const barStar5 = document.getElementById('barStar5'); //elementos donde incertara la barra de progreso
    const barStar4 = document.getElementById('barStar4'); //elementos donde incertara la barra de progreso
    const barStar3 = document.getElementById('barStar3'); //elementos donde incertara la barra de progreso
    const barStar2 = document.getElementById('barStar2'); //elementos donde incertara la barra de progreso
    const barStar1 = document.getElementById('barStar1'); //elementos donde incertara la barra de progreso

    const pountrateView = document.querySelector('.pountrateView');
    const boxstarView = document.querySelector('.boxstarView'); //boxstarView, puntrateView, countrateView
    const countrateView = document.querySelector('.countrateView');
    let sumStar1= 0; sumStar2= 0; sumStar3= 0; sumStar4= 0; sumStar5= 0; //variables que recojeran los datos para luego sacar el porcentaje.
    let percent1, percent2, percent3, percent4, percent5; //pocentajes por estrellas.
    let boxPercent = [];

    // script para conocer la calificacion de esta tienda
    
      const data = {
        storeName : Store
      };

      fetch('/account/pountRate', {

      method: "post",
      body: JSON.stringify(data),
      headers: {"content-type" : "application/json"}

      })
      .then(response =>response.json() )
      .then( jsonx =>  { 

          //console.log("recibiendo del backend pountrate ->", jsonx)
          const boxRates = []; //aqui meto todas las calificaciones parseadas a numeros
          jsonx.forEach((ele)=>{
            const markStar = ele.markStar;
            const markstar = parseInt(markStar);
            boxRates.push(markstar)
          })
          //console.log("boxRates", boxRates);
          let ratesLength = boxRates.length;
          //ahora hacemos el calculo para saber cual es la media de las calificaciones aportadas por los usuarios 
          let sumRate = 0;
          boxRates.forEach((ele)=>{
            const stars = ele
            //console.log("stars >", stars)
            sumRate = sumRate + stars; 

            if (ele == 1){
              sumStar1 ++;
            } else if (ele ==2){
              sumStar2 ++;
            } else if (ele ==3){
              sumStar3 ++;
            } else if (ele ==4){
              sumStar4 ++;
            } else if (ele ==5){
              sumStar5 ++;
            } 
          })

          //console.log("Con estos datos armo las barras de progrso de las estrellas.")
          //console.log( `sumStar1 :${sumStar1} sumStar2 :${sumStar2} sumStar3 :${sumStar3} sumStar4 :${sumStar4} sumStar5 :${sumStar5}` );
          //console.log("ratesLength: ", ratesLength);
          //console.log("------------------------------------------------------")
          const boxCountStart = [sumStar1, sumStar2, sumStar3, sumStar4, sumStar5];
          boxCountStart.forEach((ele)=>{
            let resultPercent = ((ele * 100) / ratesLength).toFixed(1);
            boxPercent.push(resultPercent);
          })
          //console.log("boxPercent --->", boxPercent);
          //   1* ,   2* ,    3* ,    4* ,    5*
          //['0.0', '40.0', '20.0', '20.0', '20.0']

          for (let i = 0; i < boxPercent.length; i++) {
            const ele = boxPercent[i];
            //console.log("verrrrrrr aqui", i);
            //console.log(`barStar${i + 1} valor : ${ele} `);
            const x = i + 1;
            if (x == 1){
              barStar1.innerHTML = `<div class="progress-bar rounded-2" role="progressbar" style="width: ${ele}%" aria-valuenow="${ele}" aria-valuemin="0" aria-valuemax="100">  </div>` 
            } else if (x == 2) {
              barStar2.innerHTML = `<div class="progress-bar rounded-2" role="progressbar" style="width: ${ele}%" aria-valuenow="${ele}" aria-valuemin="0" aria-valuemax="100">  </div>` 
            } else if (x == 3) {
              barStar3.innerHTML = `<div class="progress-bar rounded-2" role="progressbar" style="width: ${ele}%" aria-valuenow="${ele}" aria-valuemin="0" aria-valuemax="100">  </div>` 
            } else if (x == 4) {
              barStar4.innerHTML = `<div class="progress-bar rounded-2" role="progressbar" style="width: ${ele}%" aria-valuenow="${ele}" aria-valuemin="0" aria-valuemax="100">  </div>` 
            } else if (x == 5) {
              barStar5.innerHTML = `<div class="progress-bar rounded-2" role="progressbar" style="width: ${ele}%" aria-valuenow="${ele}" aria-valuemin="0" aria-valuemax="100">  </div>` 
            }
                      
            /* `barStar${i}`.innerHTML = `<div class="progress-bar rounded-2" role="progressbar" style="width: ${ele}%" aria-valuenow="${ele}" aria-valuemin="0" aria-valuemax="100">  </div>` */
          }
          

          //console.log("sumRate", sumRate);
          //console.log("ratesLength", ratesLength);
          const pount = (sumRate / ratesLength);
          let pountRate; 
          pountRate = parseFloat( pount.toFixed(1)); 
          //console.log("pountRate", pountRate);
          //console.log("ratesLength", ratesLength);
          //console.log("pountRate", typeof pountRate)
          //boxstarView, puntrateView, countrateView
          pountrateView.innerText = pountRate; //esto muestra la calificacion en la vista dodne estan todas las calificaciones
          countrateView.innerText = ratesLength; //esto muestra la cantidad de calificaciones y opiniones.   

          if (isNaN (pountRate)){

            boxstarView.innerHTML = ` <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                    `                    

          } else if (pountRate == 0 ){

            boxstarView.innerHTML  = `<i class="bi bi-star-half mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                    `                            

          } else if (pountRate > 0 && pountRate < 1){

            boxstarView.innerHTML = ` <i class="bi bi-star-half mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                    `                      
                 
          } else if (pountRate == 1 ){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                    `                                            
                            
          } else if (pountRate > 1 && pountRate < 2){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-half mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                    `                      
                     
          } else if (pountRate == 2){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                     <i class="bi bi-star mx-1"></i>
                                    `                                  

          } else if (pountRate > 2 && pountRate < 3){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-half mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      `                                  
          } else if (pountRate == 3 ){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                     `                                   

          } else if (pountRate > 3 && pountRate < 4){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill"></i>
                                      <i class="bi bi-star-fill"></i>
                                      <i class="bi bi-star-fill"></i>
                                      <i class="bi bi-star-half"></i>
                                      <i class="bi bi-star"></i>
                                      `                                  

          } else if (pountRate == 4 ){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star mx-1"></i>
                                      `                                    

          } else if (pountRate > 4 && pountRate < 5){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-half mx-1"></i>
                                      `                                  

          } else if (pountRate == 5){
            boxstarView.innerHTML = ` <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      <i class="bi bi-star-fill mx-1"></i>
                                      `                                  
          } 


        
        })
      .catch( err => console.log(err));
    

  </script>

  <script>
    const bodyRates = document.getElementById('bodyRates');

    const btnRateAll = document.querySelector('.btnRateAll');
    const btnRate5 = document.querySelector('.btnRate5');
    const btnRate4 = document.querySelector('.btnRate4');
    const btnRate3 = document.querySelector('.btnRate3');
    const btnRate2 = document.querySelector('.btnRate2');
    const btnRate1 = document.querySelector('.btnRate1');


      const rateAll = {
        storeName : Store
      };

      fetch('/account/pountRate', {

        method: "post",
        body: JSON.stringify(rateAll),
        headers: {"content-type" : "application/json"}

      })
      .then(response =>response.json() )
      .then( jsonx =>  { 
          
          //console.log("Con estos datos armare la lista de las calificaciones", jsonx);

          jsonx.forEach((ele)=>{

              //console.log("dataLogeado ->", ele.dataLogeado);
              const dataLogeado = ele.dataLogeado;
              const username = dataLogeado.username;
              const mailhash = dataLogeado.mailhash;
              const avatarPerfil = dataLogeado.avatarPerfil;
              //console.log("avatarPerfil >", avatarPerfil);
              //console.log("markStar ->", ele.markStar);
              const markstar = ele.markStar;
              //console.log("markstar -->", markstar) 
              //console.log("comment ->", ele.comment);
              let comment;
              comment = ele.comment;


              if (comment === ""){
                comment = "¡Sin comentarios!"
              } 

              const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
              let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
              const fecha = `${dia}-${mes}-${anio}`;


                  if (avatarPerfil[0].public_id === 'sin_data'){
                      
                      if (markstar == 1){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 2){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 3){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span> 
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 4){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star"></i> </span>
                                                                        <span class="ms-2"> ${fecha} </span> 
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 5){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span> 
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>               
                                        `
                      }   

                  } else {
 
                      if (markstar == 1){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        ` 
                      } else if (markstar == 2){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        ` 
                      } else if (markstar == 3){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        `                   
                      } else if (markstar == 4){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        `                   
                      } else if (markstar == 5){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        `                  
                      }
 
                  }            

 
          })


        })
      .catch((error)=>{
        console.log("Ha habido un problema con la carga de calificaciones")
      })

  
        //filtrar por 1 estrellas
        btnRate1.addEventListener('click', ()=>{

            const rate = {
              storeName : Store
            };

            fetch('/account/pountRate/star-1', {

              method: "post",
              body: JSON.stringify(rate),
              headers: {"content-type" : "application/json"}

              })
            .then(response =>response.json() )
            .then( jsonx =>  { 
              
              //console.log("consolta 1 star -> ", jsonx)
              bodyRates.innerHTML = ""; //limpiamos todo antes de colocar los nuevos elementos.
              jsonx.forEach((ele)=>{
                
                const dataLogeado = ele.dataLogeado;
                const avatarPerfil = dataLogeado.avatarPerfil;
                const mailhash = dataLogeado.mailhash;
                const username = dataLogeado.username;

                let comment;
                comment = ele.comment;

                if (comment === ""){
                  comment = "¡Sin comentarios!"
                }

                const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
                let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
                const fecha = `${dia}-${mes}-${anio}`;

                //console.log(`|-> avatarPerfil : ${avatarPerfil} mailhash : ${mailhash} username : ${username}`)

                if (avatarPerfil[0].public_id === 'sin_data'){
                      //carece de avatar customizado usar el hashmail
                      bodyRates.innerHTML += `
                                  <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                    <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                    <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star"></i>
                                                            <i class="bi bi-star"></i>
                                                            <i class="bi bi-star"></i>
                                                            <i class="bi bi-star"></i> </span>
                                                            <span class="ms-2"> ${fecha} </span> 
                                    </p>
                                    <p class="mb-1"> <span> ${comment} </span> </p>
                                  </div>               
                                  `

                } else {
                  bodyRates.innerHTML += `
                                  <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                    <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                    <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star"></i>
                                                            <i class="bi bi-star"></i>
                                                            <i class="bi bi-star"></i>
                                                            <i class="bi bi-star"></i> </span>
                                                            <span class="ms-2"> ${fecha} </span>

                                    </p>
                                    <p class="mb-1"> <span> ${comment} </span> </p>
                                  </div>           
                                  `   
                }  

              })
               

            })
            .catch((err)=>{ console.log(err) }); 
          


            
        }) 

        //filtrar por 2 estrellas
        btnRate2.addEventListener('click', ()=>{

          const rate = {
            storeName : Store
          };
          
          fetch('/account/pountRate/star-2', {

            method: "post",
            body: JSON.stringify(rate),
            headers: {"content-type" : "application/json"}

            })
          .then(response =>response.json() )
          .then( jsonx =>  {
            
            //console.log("consolta 2 star -> ", jsonx)
            bodyRates.innerHTML = ""; //limpiamos todo antes de colocar los nuevos elementos.
            jsonx.forEach((ele)=>{
              
              const dataLogeado = ele.dataLogeado;
              const avatarPerfil = dataLogeado.avatarPerfil;
              const mailhash = dataLogeado.mailhash;
              const username = dataLogeado.username;

              let comment;
              comment = ele.comment;

              if (comment === ""){
                comment = "¡Sin comentarios!"
              }

              const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
              let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
              const fecha = `${dia}-${mes}-${anio}`;              

              //console.log(`|-> avatarPerfil : ${avatarPerfil} mailhash : ${mailhash} username : ${username}`)

              
              if (avatarPerfil[0].public_id === 'sin_data'){
                    //carece de avatar customizado usar el hashmail
                    bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star"></i>
                                                          <i class="bi bi-star"></i>
                                                          <i class="bi bi-star"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span> 
                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>               
                                `

              } else {
                bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star"></i>
                                                          <i class="bi bi-star"></i>
                                                          <i class="bi bi-star"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span>

                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>           
                                `   
              }  

            })
            

           })
          .catch((err)=>{ console.log(err) }); 
        
        }) 
  
        //filtrar por 3 estrellas
        btnRate3.addEventListener('click', ()=>{

          const rate = {
            storeName : Store
          };

          fetch('/account/pountRate/star-3', {

            method: "post",
            body: JSON.stringify(rate),
            headers: {"content-type" : "application/json"}

            })
          .then(response =>response.json() )
          .then( jsonx =>  {
            
            //console.log("consolta 3 star -> ", jsonx)
            bodyRates.innerHTML = ""; //limpiamos todo antes de colocar los nuevos elementos.
            jsonx.forEach((ele)=>{
              
              const dataLogeado = ele.dataLogeado;
              const avatarPerfil = dataLogeado.avatarPerfil;
              const mailhash = dataLogeado.mailhash;
              const username = dataLogeado.username;

              let comment;
              comment = ele.comment;

              if (comment === ""){
                comment = "¡Sin comentarios!"
              }

              const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
              let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
              const fecha = `${dia}-${mes}-${anio}`;              

              //console.log(`|-> avatarPerfil : ${avatarPerfil} mailhash : ${mailhash} username : ${username}`)

              
              if (avatarPerfil[0].public_id === 'sin_data'){
                    //carece de avatar customizado usar el hashmail
                    bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star"></i>
                                                          <i class="bi bi-star"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span> 
                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>               
                                `

              } else {
                bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star"></i>
                                                          <i class="bi bi-star"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span>

                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>           
                                `   
              }  

            })

          })
          .catch((err)=>{ console.log(err) }); 

        }) 

        //filtrar por 4 estrellas
        btnRate4.addEventListener('click', ()=>{

          const rate = {
            storeName : Store
          };

          fetch('/account/pountRate/star-4', {

            method: "post",
            body: JSON.stringify(rate),
            headers: {"content-type" : "application/json"}

            })
          .then(response =>response.json() )
          .then( jsonx =>  {
            
            //console.log("consolta 4 star -> ", jsonx)
            bodyRates.innerHTML = ""; //limpiamos todo antes de colocar los nuevos elementos.
            jsonx.forEach((ele)=>{
              
              const dataLogeado = ele.dataLogeado;
              const avatarPerfil = dataLogeado.avatarPerfil;
              const mailhash = dataLogeado.mailhash;
              const username = dataLogeado.username;

              let comment;
              comment = ele.comment;

              if (comment === ""){
                comment = "¡Sin comentarios!"
              }

              const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
              let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
              const fecha = `${dia}-${mes}-${anio}`;              

              //console.log(`|-> avatarPerfil : ${avatarPerfil} mailhash : ${mailhash} username : ${username}`)

              
              if (avatarPerfil[0].public_id === 'sin_data'){
                    //carece de avatar customizado usar el hashmail
                    bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span> 
                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>               
                                `

              } else {
                bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span>

                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>           
                                `   
              }  

            })

          })
          .catch((err)=>{ console.log(err) }); 

        }) 

        //filtrar por 5 estrellas
        btnRate5.addEventListener('click', ()=>{

          const rate = {
            storeName : Store
          };

          fetch('/account/pountRate/star-5', {

            method: "post",
            body: JSON.stringify(rate),
            headers: {"content-type" : "application/json"}

            })
          .then(response =>response.json() )
          .then( jsonx =>  {
            
            //console.log("consulta 5 star -> ", jsonx)
            bodyRates.innerHTML = ""; //limpiamos todo antes de colocar los nuevos elementos.
            jsonx.forEach((ele)=>{
              
              const dataLogeado = ele.dataLogeado;
              const avatarPerfil = dataLogeado.avatarPerfil;
              const mailhash = dataLogeado.mailhash;
              const username = dataLogeado.username;

              let comment;
              comment = ele.comment;

              if (comment === ""){
                comment = "¡Sin comentarios!"
              }

              const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
              let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
              const fecha = `${dia}-${mes}-${anio}`;              

              //console.log(`|-> avatarPerfil : ${avatarPerfil} mailhash : ${mailhash} username : ${username}`)

              
              if (avatarPerfil[0].public_id === 'sin_data'){
                    //carece de avatar customizado usar el hashmail
                    bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span> 
                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>               
                                `

              } else {
                bodyRates.innerHTML += `
                                <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                  <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                  <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i>
                                                          <i class="bi bi-star-fill"></i> </span>
                                                          <span class="ms-2"> ${fecha} </span>

                                  </p>
                                  <p class="mb-1"> <span> ${comment} </span> </p>
                                </div>           
                                `   
              }  

            })

          })
          .catch((err)=>{ console.log(err) }); 

        }) 

        //filtrar por All estrellas
        btnRateAll.addEventListener('click', ()=>{

          const rate = {
            storeName : Store
          };

          fetch('/account/pountRate', {

            method: "post",
            body: JSON.stringify(rate),
            headers: {"content-type" : "application/json"}

            })
          .then(response =>response.json() )
          .then( jsonx =>  {
            
            //console.log("consolta All star -> ", jsonx)
            bodyRates.innerHTML = ""; //limpiamos todo antes de colocar los nuevos elementos.
            jsonx.forEach((ele)=>{
                                   
              const markstar = ele.markStar;
              const dataLogeado = ele.dataLogeado;
              const avatarPerfil = dataLogeado.avatarPerfil;
              const mailhash = dataLogeado.mailhash;
              const username = dataLogeado.username;

              let comment;
              comment = ele.comment;

              if (comment === ""){
                comment = "¡Sin comentarios!"
              }

              const updatedAt = ele.updatedAt; const date = new Date(updatedAt); 
              let dia = date.getDate(); let mes = date.getMonth() +1; let anio = date.getFullYear();
              const fecha = `${dia}-${mes}-${anio}`;              

              //console.log(`|-> avatarPerfil : ${avatarPerfil} mailhash : ${mailhash} username : ${username}`)

              if (avatarPerfil[0].public_id === 'sin_data'){
              //console.log("avatarPerfil[0] ", avatarPerfil[0]); 
              //console.log("markstar ", markstar);       
                      if (markstar == 1){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 2){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 3){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span> 
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 4){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star-fill"></i>
                                                                        <i class="bi bi-star"></i> </span>
                                                                        <span class="ms-2"> ${fecha} </span> 
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>            
                                        `
                      } else if (markstar == 5){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="https://www.gravatar.com/avatar/${mailhash}?d=identicon" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span> 
                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>               
                                        `
                      }   

                  } else {
 
                      if (markstar == 1){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        ` 
                      } else if (markstar == 2){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        ` 
                      } else if (markstar == 3){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        `                   
                      } else if (markstar == 4){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        `                   
                      } else if (markstar == 5){
                        bodyRates.innerHTML += `
                                        <div class="boxRatesView my-2" style="border-bottom: 2px dotted rgb(211, 211, 211);">
                                          <p class="mb-1"> <img src="${avatarPerfil[0].url}" style="width: 40px;"> <span> ${username} </span> </p>
                                          <p class="mb-1"> <span> <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i>
                                                                  <i class="bi bi-star-fill"></i> </span>
                                                                  <span class="ms-2"> ${fecha} </span>

                                          </p>
                                          <p class="mb-1"> <span> ${comment} </span> </p>
                                        </div>           
                                        `                  
                      }
 
                  }                
              
  


            })

          })
          .catch((err)=>{ console.log(err) }); 

        }) 


        
  </script>

<script>
  /* script que controla la aparicion del mapa, politicas faq y encuestas.  */
  const storenameValue = document.getElementById('StorenameValue');
  const containerInfoBliss = document.querySelector('.containerInfoBliss');
  const containerPolity = document.querySelector('.containerPolity');
  const containerFaqs = document.querySelector('.containerFaqs'); 
  const containerSurvey = document.querySelector('.containerSurvey');
  const containerLocation = document.querySelector('.containerLocation');
  const btnBackToAds = document.getElementById('btnBackToAds'); //boton para devolver los anuncios 

  const containerSegment = document.querySelector('.containerSegment');
  //const containerWorkSpace = document.querySelector('.containerWorkSpace'); //declarado arriba.
  const mainGallery = document.querySelector('.mainGallery');

  const btnPolity = document.querySelector('.btn-polity');
  const btnFaqs = document.querySelector('.btn-faqs');
  const btnSurvey = document.querySelector('.btn-survey');
  const btnLocation = document.querySelector('.btn-location');

  const dataPolicy = document.getElementById('dataPolicy');
  const dataFaq = document.getElementById('dataFaq');
  
  const quillPolicy = document.getElementById('quillPolicy');
  const quillFaq = document.getElementById('quillFaq');

  //contenedores importantes para la encuesta
  const containerSurveyCustomer = document.querySelector('.containerSurveyCustomer');
  const containerSurveyDone = document.querySelector('.containerSurveyDone');
  const containerError = document.querySelector('.containerError');
  


if (btnPolity) {
  btnPolity.addEventListener('click', ()=>{
    containerSegment.classList.add('close');
    containerWorkSpace.classList.add('close');
    mainGallery.classList.add('close');

    containerInfoBliss.classList.remove('close');

    containerPolity.classList.remove('close');
    containerFaqs.classList.add('close');
    containerSurvey.classList.add('close');
    containerLocation.classList.add('close');
    popupCart.classList.add('close'); //cerramos la lista del carrito si lo tiene.
    
    containerViewRatesStore.classList.add('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    });

    const DataPolicy = dataPolicy.value;
    //console.log("DataPolicy", DataPolicy);  
    let deltaPolicy;

    let quillPolicy = new Quill('#quillPolicy', {
      modules: {
        toolbar : false
      },
      readOnly : true
    })

    
    deltaPolicy = JSON.parse(DataPolicy);
        //console.log("deltaPolicy" , deltaPolicy);
    quillPolicy.setContents(deltaPolicy)

    irATopBar() //nos llevan al lugar que se debe en el DOM

  });
}  

if (btnFaqs){  
  btnFaqs.addEventListener('click', ()=>{
    containerSegment.classList.add('close');
    containerWorkSpace.classList.add('close');
    mainGallery.classList.add('close');

    containerInfoBliss.classList.remove('close');

    containerPolity.classList.add('close');
    containerFaqs.classList.remove('close');
    containerSurvey.classList.add('close');
    containerLocation.classList.add('close');
    popupCart.classList.add('close'); //cerramos la lista del carrito si lo tiene.
    containerViewRatesStore.classList.add('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    });

    const DataFaq = dataFaq.value;
    console.log("DataFaq", DataFaq);
      
    let deltaFaq;

    let quillFaq = new Quill('#quillFaq', {
      modules: {
        toolbar : false
      },
      readOnly : true
    })

    
    deltaFaq = JSON.parse(DataFaq);
        //console.log("deltaFaq" , deltaFaq);
    quillFaq.setContents(deltaFaq)
    irATopBar() //nos llevan al lugar que se debe en el DOM

  });
}  

if (btnSurvey){

    //<input type="hidden" value="<#%= surveyId %>" id="surveyId">  esto es un input y esta dentro de una condicion donde solo existira cuando haya un user.
    const surveyId = document.getElementById('surveyId'); //existira solo cuando alguien este logeado porque esta dentro de un bloque user
        
    btnSurvey.addEventListener('click', ()=>{

      //aqui vamos hacer la consulta.
      const indexed = store_indexed.value; //dueño de la tienda          
      

      //verificamos que el visitante realmente exista.
      //cuando no exista este input no hay user
      if (surveyId){
        const surveyIdValue =  surveyId.value; //visitante 
        //existe un valor en surveyIdValue

            const datos = {
              indexed,
              surveyId: surveyIdValue,
            };

            console.log("datos ->", datos);

            //hacemos una consulta para evaluar si este usuario ya ha realizado la encuesta en el caso que exista.
            fetch('/account/survey/search', {

              method: "post",
              body: JSON.stringify(datos),
              headers: {"content-type" : "application/json"}

            })
              .then(response => response.json() )
              .then( jsonx => {
                  console.log(jsonx)
                  const code = jsonx.code;
                  console.log("code -->", code);
                  popupCart.classList.add('close'); //cerramos la lista del carrito si lo tiene.
                                      
                    if (code == 0){
                      //este usuario no ha realizado la encuesta
                      containerSegment.classList.add('close');
                      containerWorkSpace.classList.add('close');
                      mainGallery.classList.add('close');

                      containerInfoBliss.classList.remove('close');

                      containerPolity.classList.add('close');
                      containerFaqs.classList.add('close');
                      containerSurvey.classList.remove('close');
                      containerLocation.classList.add('close');
                      containerViewRatesStore.classList.add('close');

                      containerSurveyCustomer.classList.remove('close');
                      containerSurveyDone.classList.add('close');
                      containerError.classList.add('close');
                      irATopBar() //nos llevan al lugar que se debe en el DOM

                    } else if (code == 1) {
                      //este usuario ha realizado la encuesta
                      containerSegment.classList.add('close');
                      containerWorkSpace.classList.add('close');
                      mainGallery.classList.add('close');

                      containerInfoBliss.classList.remove('close');

                      containerPolity.classList.add('close');
                      containerFaqs.classList.add('close');
                      containerSurvey.classList.remove('close');
                      containerLocation.classList.add('close');
                      containerViewRatesStore.classList.add('close');
                      
                      containerSurveyCustomer.classList.add('close');
                      containerSurveyDone.classList.remove('close');
                      containerError.classList.add('close');
                      irATopBar() //nos llevan al lugar que se debe en el DOM

                    } else if (code == 2) {
                      //ha habido un error
                      containerSegment.classList.add('close');
                      containerWorkSpace.classList.add('close');
                      mainGallery.classList.add('close');

                      containerInfoBliss.classList.remove('close');

                      containerPolity.classList.add('close');
                      containerFaqs.classList.add('close');
                      containerSurvey.classList.remove('close');
                      containerLocation.classList.add('close');
                      containerViewRatesStore.classList.add('close');
                      
                      containerSurveyCustomer.classList.add('close');
                      containerSurveyDone.classList.add('close');
                      containerError.classList.remove('close');
                      irATopBar() //nos llevan al lugar que se debe en el DOM

                    }

          
                })
              .catch((error)=> {
                console.log('Ha ocurrido un error')
                containerSegment.classList.add('close');
                containerWorkSpace.classList.add('close');
                mainGallery.classList.add('close');

                containerInfoBliss.classList.remove('close');

                containerPolity.classList.add('close');
                containerFaqs.classList.add('close');
                containerSurvey.classList.remove('close');
                containerLocation.classList.add('close');
                containerViewRatesStore.classList.add('close');
                
                containerSurveyCustomer.classList.add('close');
                containerSurveyDone.classList.add('close');
                containerError.classList.remove('close');
                irATopBar() //nos llevan al lugar que se debe en el DOM
              })    


              efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
              efectSoundExpan.play().catch(error => {
                  console.error("Error al reproducir el sonido:", error);
              });

      } else {

        console.log("No hay nadie logeado asi que enviamos un modal");
        //staticSurveyNoLogin   ->id modal que queremos hacer ver.
        // Crear una instancia del modal de Bootstrap
        var myModal = new bootstrap.Modal(document.getElementById('staticSurveyNoLogin'));
        // Mostrar el modal
        myModal.show();

      }      
 
    });
  }    

if (btnLocation){  
  btnLocation.addEventListener('click', ()=>{
    containerSegment.classList.add('close');
    containerWorkSpace.classList.add('close');
    mainGallery.classList.add('close');

    containerInfoBliss.classList.remove('close');

    containerPolity.classList.add('close');
    containerFaqs.classList.add('close');
    containerSurvey.classList.add('close');
    containerViewRatesStore.classList.add('close');
    popupCart.classList.add('close'); //cerramos la lista del carrito si lo tiene.
    containerLocation.classList.remove('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    });

    irATopBar() //nos llevan al lugar que se debe en el DOM
    createMap()
   
  });
}  

let map; // Variable global para almacenar la instancia del mapa


function createMap() {
    const Lon = document.getElementById('mapDataLon'); 
    const Lat = document.getElementById('mapDataLat');
    const storename = storenameValue.value; //username de la tienda
   
    if (Lon && Lat){

        const lon = Lon.value;
        const lat = Lat.value;

        console.log("lon -->", Lon);
        console.log("Lat -->", Lat);

        console.log(`Estas variables ya están definidas ---> Latitud: ${lat}, Longitud: ${lon}`);

        // Verifica si el mapa ya ha sido creado
        if (map) {
            map.remove(); // Destruye el mapa existente
        }

        
        // Crear un nuevo mapa en el div con id "map" instanciar
        map = L.map('mapStore').setView([lat, lon], 13); // El segundo parámetro es el nivel de zoom
        
        //var myMap = L.map('miMapa').setView([latitud, longitud], zoomLevel);

        console.log("map ->", map);

        // Añadir una capa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Añadir un marcador en las coordenadas especificadas
        L.marker([lat, lon]).addTo(map)
            .bindPopup(storename)
            .openPopup();
 
        

        const options = {
            position: 'topleft',
            primaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'hectares',
            activeColor: '#9200FF',
            completedColor: '#c174fc',
            // Traducción de los textos
        };
        const measureControl = new L.Control.Measure(options);
        map.addControl(measureControl); // Asegúrate de añadir el control al mapa

        L.Control.Measure.include({
            _setCaptureMarkerIcon: function () {
                this._captureMarker.options.autoPanOnFocus = false;

                this._captureMarker.setIcon(
                    L.divIcon({
                        iconSize: this._map.getSize().multiplyBy(2)
                    })
                );
            },
        });
        

    }



}

if (btnBackToAds){

  btnBackToAds.addEventListener('click', ()=>{
    containerSegment.classList.remove('close');
    containerWorkSpace.classList.remove('close');
    mainGallery.classList.remove('close');

    containerInfoBliss.classList.add('close');

    containerPolity.classList.add('close');
    containerFaqs.classList.add('close');
    containerSurvey.classList.add('close');
    containerLocation.classList.add('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    });
  })

}


//esta function permite tener un ancla para poder llevar al usuario al topbar.
function irATopBar() {
  const seccion = document.getElementById('topBar');
  seccion.scrollIntoView({ behavior: 'smooth' });
}

</script>




<% if ( user !== undefined ) { %>
  <!-- estas son las opciones que estaran cuando SI exista un usuario logeado -->




<script>
console.log("shoppingCart.............:", shoppingCart);
if (shoppingCart == "true"){
  //controlador de tagShippingCart
  const tagShippingCart = document.querySelectorAll('.tagShippingCart');
  const cartMenos = document.querySelectorAll('.CartMenos');
  const cartMas = document.querySelectorAll('.CartMas');
  const countTag = document.querySelectorAll('.countTag'); //es el span que muestra la cantidad de pedido por el cliente
  
 
  const containerCartList = document.querySelector('.containerCartList'); //este es el icono de cartShopping donde las personas podran con un click ver su lista de compra.
  const lightCartShopping = document.querySelector('.lightCartShopping'); //luz parpadeante identificadora de carrito activo
  const deleteALLEle = document.querySelector('.deleteALLElements'); //boton que elimina todos los elementos del carrito y deja el listado en cero.
  const cartItems = document.getElementById('cartItems'); // Es la tabla donde vamos a inyectar los datos de la lista de compra                         
  const totalPagar = document.getElementById('totalPagar'); //es el total a pagar del carrito de compras.

  const StoreId = document.getElementById('StoreId').value;
  const UserId = document.getElementById('UserId').value;
  const counters = {};   
  let totalPay = 0; // esta variable es global la necesitamos en varios lugares.

  //exploramos si en el localStorage ya hay un cart si existe es porque ya tenemos un boxShopping y no hace falta crearlo sino actualizarlo.
  const cart = JSON.parse(localStorage.getItem(`cart_${UserId}+${StoreId}`)) || [];
  console.log("esto es el cart de este usuario en esta tienda. Extraido localstorage", cart);
  let boxShopping = []; //este es el array donde se guardan todos los elementos del carrito.
  
  //si cart tiene elementos 
  if (cart.length !==0){
    boxShopping.push(...cart);
  }
  console.log("boxShopping :", boxShopping );


  deleteALLEle.addEventListener('click', ()=>{
    console.log("boxShopping .............:", boxShopping );

    if (boxShopping.length !==0){

      efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
      efectSoundExpan.play().catch(error => {
          console.error("Error al reproducir el sonido:", error);
      });    

      boxShopping = []; //limpiamos el array boxShopping
      cartItems.innerHTML = "" //limpiamos todos los lementos de la tabla.
      totalPagar.innerText = "0.00" //limpiamos el valor total.

      console.log("boxShopping actualizado.............:", boxShopping );
      //salvamos la informacion
      localStorage.setItem(`cart_${UserId}+${StoreId}`, JSON.stringify(boxShopping));

      const message = "Ha vaciado el carrito.";
      mostrarToast( message , 'right', 'info', '', false ); // Agrega título aquí

      //console.log("countTag ....:", countTag);
      countTag.forEach((ele, i)=>{
        ele.innerText = 0; //actualizamos en tiempo real colcoando todos los valores de las tarjetas en cero (0).
      })
      
      lightCart()
      
    } else {

      const message = "Sin articulos que eliminar.";
      mostrarToast( message , 'right', 'info', '', false ); // Agrega título aquí

    }

  });

  //----- Esta funcion coloca un identificador al boton de cartShopping----
  lightCart();

  function lightCart(){
    if (boxShopping.length !==0){

        lightCartShopping.classList.remove('close');

        cartItems.innerHTML = "" //limpiamos e inyectamos 
        totalPay = 0; //comenzamos en 0 sino se concatena dando sumas locas, ya que sumara incluso sino hay existencia.
        
        //inyectamos los datos en la tabla
        boxShopping.forEach((ele)=>{

          const total = parseFloat((ele.price * ele.countRequest).toFixed(2));

          totalPay = totalPay + total; //aqui sumamos cada total

          cartItems.innerHTML += `
            <tr>
              <th style="text-align: left;"> <span class="delItemCart">  <input type="hidden" value="${ ele.id }">  <i class="bi bi-x-square" style="font-size: 17px"></i> </span> </th>
              <th style="text-align: left;"> ${ ele.title } </th>
              <th style="text-align: center;">${ ele.countRequest }</th>
              <th style="text-align: right;">${ ele.price }</th>
              <th style="text-align: right;">${ total }</th>
            </tr>
          `
        })


        totalPagar.innerText = totalPay.toFixed(2);

        const delItem = document.querySelectorAll('.delItemCart')  
      
        delItem.forEach((ele)=>{
          ele.addEventListener('click', ()=>{
            const son = ele.children;
            const id = son[0].value
            console.log("Este es el id :", id);
            const index = boxShopping.findIndex(ele => ele.id === id);

            if (index !== -1) {
              //tiene el indice, existe el articulo
              
                if (boxShopping.length > 1){ //cuando el array tiene mas de un elemento
                  boxShopping.splice(index, 1); // eliminar el elemento del array boxShopping
                  console.log("boxShopping ultimo dato:", boxShopping);
                    tagShippingCart.forEach((ele, i)=>{
                      //console.log("Este es ele", ele);
                      const son = ele.children;
                      const idEle = son[0].value;
                      if (idEle === id){
                        countTag[i].innerText = 0; //actualizamos en tiempo real
                      }
                    })
                
                    const message = "Eliminado del carrito.";
                    mostrarToast( message , 'right', 'danger', '', false ); // Agrega título aquí
                    lightCart()

                } else { //cuando el array tiene solo un (1) elemento.
                  boxShopping.splice(index, 1); // eliminar el elemento del array boxShopping
                  tagShippingCart.forEach((ele, i)=>{
                    //console.log("Este es ele", ele);
                    const son = ele.children;
                    const idEle = son[0].value;
                    if (idEle === id){
                      countTag[i].innerText = 0; //actualizamos en tiempo real
                    }
                  })
                  cartItems.innerHTML = ""; //limpiamos toda la lista
                  totalPagar.innerText = "$0.00"; //iniciamos el monto en $0.00
                  console.log("ver boxShopping ultimo dato:", boxShopping);
                  //countTag[i].innerText = 0; //actualizamos en tiempo real
                  const message = "Eliminado del carrito.";
                  mostrarToast( message , 'right', 'danger', '', false ); // Agrega título aquí
                  lightCart()
                }
              
              //salvamos la informacion
              localStorage.setItem(`cart_${UserId}+${StoreId}`, JSON.stringify(boxShopping));

            } else {
              console.log("Elemento no encontrado en boxShopping");
            }


          })
      })

      
    } else {
      lightCartShopping.classList.add('close');
    } //solo para cuando carga la pagina o se refresca.
  }  
  //----------------------------------------------------------------------



  tagShippingCart.forEach((ele, i)=>{

    //console.log("Este es ele", ele);
    const son = ele.children;
    //console.log("son : ", son);

    const id = son[0].value;
    const depart = son[1].value;
    const title = son[2].value;
    const price = son[3].value;
    const count = parseInt(son[4].value);
    const presentation = son[5].value;

    boxShopping.forEach((elemento)=>{
      const idElemento = elemento.id;

      if (idElemento === id){
        console.log("idElemento === id", idElemento + "  " + id);
        countTag[i].innerText = `${elemento.countRequest}`
      }

    })

    cartMenos[i].addEventListener('click', ()=>{

          //console.log( "quiero retar unidades de este articulo", title );
          //console.log("boxShopping :", boxShopping);
         
          const index = boxShopping.findIndex(ele => ele.id === id);
          //console.log("boxShopping[index]", boxShopping[index]);

          if (index !== -1) {
            //tiene el indice, existe el articulo
            const countRequest = boxShopping[index].countRequest;
            
            if (countRequest > 1){
              boxShopping[index].countRequest--;
              console.log("ver boxShopping :", boxShopping);
              countTag[i].innerText = countRequest - 1; //actualizamos en tiempo real
            } else {
              if (boxShopping.length > 1){ //cuando el array tiene mas de un elemento
                boxShopping.splice(index, 1); // eliminar el elemento del array boxShopping
                console.log("boxShopping ultimo dato:", boxShopping);
                countTag[i].innerText = 0; //actualizamos en tiempo real
                const message = "Eliminado del carrito.";
                mostrarToast( message , 'right', 'danger', '', false ); // Agrega título aquí
              } else { //cuando el array tiene solo un (1) elemento.
                boxShopping.splice(index, 1); // eliminar el elemento del array boxShopping
                cartItems.innerHTML = ""; //limpiamos toda la lista
                totalPagar.innerText = "$0.00"; //iniciamos el monto en $0.00
                console.log("ver boxShopping ultimo dato:", boxShopping);
                countTag[i].innerText = 0; //actualizamos en tiempo real
                const message = "Eliminado del carrito.";
                mostrarToast( message , 'right', 'danger', '', false ); // Agrega título aquí
              }

            }
            //salvamos la informacion
            localStorage.setItem(`cart_${UserId}+${StoreId}`, JSON.stringify(boxShopping));
          } else {
            console.log("Elemento no encontrado en boxShopping");
          }

           lightCart();

    })

    cartMas[i].addEventListener('click', ()=>{
      
        let requestExist;
        boxShopping = JSON.parse(localStorage.getItem(`cart_${UserId}+${StoreId}`)) || [];

        console.log("boxShopping........... :", boxShopping);

        if ( boxShopping.length !== 0 ){
          const index = boxShopping.findIndex(elem => elem.id === id);

          if (index !== -1){ //consigue el indice
            requestExist = boxShopping[index].countRequest;

              if (requestExist < count){
                console.log("requestExist :", requestExist);
                console.log("typeof requestExist :", typeof requestExist);
                const request = requestExist + 1;
                countTag[i].innerText = request; //actualizamos en tiempo real
                // Existe, actualizar datos
                let data = { "depart": depart, "id": id, "title": title, "price": price, "countRequest": request, "presentation": presentation };
                boxShopping[index] = data;
                console.log("Artículo actualizado en el carrito:", data);
              } else {
                const message = "Articulo sin existencia.";
                mostrarToast( message , 'right', 'info', '', false ); // Agrega título aquí
              }  

          } else { //no existe el indice
            // No existe, agregar nuevo
            console.log("Esto es count", count);
            if ( 1  <= count){
              countTag[i].innerText = 1;
              let data = { "depart": depart, "id": id, "title": title, "price": price, "countRequest": 1, "presentation": presentation };
              boxShopping.push(data);
              console.log("Artículo agregado al carrito:", data);
              const message = "Agregado al carrito.";
              mostrarToast( message , 'right', 'success', '', false ); // Agrega título aquí
            } else {
              const message = "Articulo sin existencia.";
              mostrarToast( message , 'right', 'info', '', false ); // Agrega título aquí
            }  
            
          } 

        } else {

          if (count >= 1){
            countTag[i].innerText = 1;
            let data = { "depart": depart, "id": id, "title": title, "price": price, "countRequest": 1, "presentation": presentation };
            boxShopping.push(data);
            const message = "Agregado al carrito.";
            mostrarToast( message , 'right', 'success', '', false ); // Agrega título aquí
          } else {
            const message = "Articulo sin existencia.";
            mostrarToast( message , 'right', 'info', '', false ); // Agrega título aquí
          }
          
        }

          //salvamos la informacion    
          localStorage.setItem(`cart_${UserId}+${StoreId}`, JSON.stringify(boxShopping));
        
          console.log("---------Save in the localStorage");
          lightCart();

    })  


 })

    
  //boton de lista de compra que hace aparecer o desaparecer el popup de lista de compra     
  const popupCart = document.getElementById('popupCart'); //esta es la lista propiamente
  const closePopupCartList = document.querySelector('.closePopupCartList');
  const consolidate = document.getElementById('consolidate');
  const noConsolidate = document.getElementById('noConsolidate'); // boton cuando no el usuario no tenga perfil
  const dataMissing = document.querySelector('.dataMissing');

  const orderDetail = document.getElementById('orderDetail');
  const clientAddress = document.getElementById('clientAddress');
  const clientPhone = document.getElementById('clientPhone');
  const clientIndentification = document.getElementById('clientIndentification');
  const clientName = document.getElementById('clientName');
  const selectDeliveryOptions = document.getElementById('selectDeliveryOptions');

  containerCartList.addEventListener('click', () => {
    popupCart.classList.remove('close');

    efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
    efectSoundExpan.play().catch(error => {
        console.error("Error al reproducir el sonido:", error);
    });


  });


  closePopupCartList.addEventListener('click', ()=>{
      popupCart.classList.add('close'); // Cerrar el popup desde arriba icono x
  })
  
  if (consolidate){

    consolidate.addEventListener('click', ()=>{

        consolidate.setAttribute("disabled", ""); //desactivamos el boton.

        console.log("Esto es consolidate ..............")
        console.log("boxShopping :", boxShopping);
        //console.log("Id Tienda :", StoreId);
        //console.log("Id Cliente :", UserId);  
        const clientNameV = clientName.value; const clientIndentificationV = clientIndentification.value;
        const clientPhoneV = clientPhone.value; const clientAddressV = clientAddress.value;
        const deliveryOptV = selectDeliveryOptions.value; const orderDetailV = orderDetail.value;
        console.log("deliveryOptV ....................:", deliveryOptV)

        TotalPay = totalPay.toFixed(2);

        if (boxShopping.length !==0){

          if (clientAddressV !=="" && clientPhoneV !=="" && clientIndentificationV !=="" && clientNameV !=="" && deliveryOptV !=="" ) {
        
                const datos = {
                  boxShopping: boxShopping,
                  StoreId: StoreId,
                  UserId: UserId,
                  Amount: TotalPay,
                  clientAddress: clientAddressV,
                  clientPhone: clientPhoneV,
                  clientIndentification: clientIndentificationV,
                  clientName: clientNameV,
                  deliveryOptionV: deliveryOptV,
                  orderDetail: orderDetailV
                }

                console.log("esto es datos", datos); 
        
                fetch('/send_shoppingCart/consolidate', {

                  method: "post",
                  body: JSON.stringify(datos),
                  headers: { "content-type": "application/json" }

                })
                .then(response =>response.json() )
                .then( jsonx => {
                    console.log(jsonx) //const response = { code: "ok", message: "En proceso de consolidación, espere por favor."}
                                    
                    const code = jsonx.code;
                    const message = jsonx.message;

                    if (code == "ok"){

                        setTimeout(() => {
                          consolidate.removeAttribute("disabled"); //activamos el boton.
                        }, 5000);
                        mostrarToast( message , 'right', 'success', '¡Hecho!', true ); // Agrega título aquí

                    } else if (code == "info"){

                        mostrarToast( message , 'right', 'info', '¡Atención!', true ); // Agrega título aquí
                        setTimeout(() => {
                          consolidate.removeAttribute("disabled"); //activamos el boton.
                        }, 5000);
                        
                    } else {

                        setTimeout(() => {
                          consolidate.removeAttribute("disabled"); //activamos el boton.
                        }, 5000);
                        mostrarToast( message , 'right', 'danger', '¡Error!', true ); // Agrega título aquí

                    }
                
                })
                .catch( err =>{ console.log(err)

                    setTimeout(() => {
                      consolidate.removeAttribute("disabled"); //activamos el boton.
                    }, 5000);
                    mostrarToast( message , 'right', 'danger', '', true ); // Agrega título aquí

                });

          } else {
            //alert("faltan datos de receptor de esta compra.")
            dataMissing.innerHTML = `                        
                                    <div class="alert alert-danger">
                                      <b>
                                        <span> <i class="bi bi-exclamation-triangle-fill me-2"></i> Faltan datos del Receptor o Delivery. </span>
                                      </b> 
                                    </div>
                                    `;

            setTimeout(() => {
              dataMissing.innerHTML = "" // limpiamos el alert
              consolidate.removeAttribute("disabled"); //activamos el boton.
            }, 5000);    
                                    
          } 

        } else {

          const message = "El carrito esta vacio."
          mostrarToast( message , 'right', 'info', '', false ); // Agrega título aquí
          setTimeout(() => {
            consolidate.removeAttribute("disabled"); //activamos el boton.
          }, 5000);

        }

    })

  }

  if (noConsolidate){
    noConsolidate.addEventListener('click', ()=>{

      noConsolidate.setAttribute("disabled", "");
      dataMissing.innerHTML = `                        
                          <div class="alert alert-danger">
                            <b>
                              <span> <i class="bi bi-exclamation-triangle-fill me-2"></i> Debe crear su perfil. </span>
                            </b> 
                          </div>
                          `;

      setTimeout(() => {
        noConsolidate.removeAttribute("disabled");
        dataMissing.innerHTML = ""
      }, 4000);                    

    })
  }

}    
</script>

<script>
    //este script es para manejar la accion de los favoritos dentro de la tienda.
    const linkHeart = document.querySelectorAll('.linkHeart')
    for (let i = 0; i < linkHeart.length; i++) {
      const element = linkHeart[i];
      element.addEventListener('click', () => {

        efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
        efectSoundExpan.play().catch(error => {
            console.error("Error al reproducir el sonido:", error);
        });

        efecto()

        setTimeout(() => {
          normalHeart()
        }, 8000);
        
        //console.log(element.childNodes)
        //console.log(element.childNodes[0].value)
        //console.log(element.childNodes[1].value)
        const depart = element.childNodes[0].value;
        const id = element.childNodes[1].value;
        console.log(depart)
        console.log(id)

        const datos = {
          depart: depart,
          id: id
        }

        fetch('/myfavorites', {

          method: "post",
          body: JSON.stringify(datos),
          headers: { "content-type": "application/json" }

        })
          .then(response => response.json())
          .then(jsonx => {
            //console.log("Esto llega del backend cuando agregamos un anuncio a favorito", jsonx)
            const code = jsonx.code;
            const message = jsonx.message;
            console.log("code :", code);
            console.log("message :", message);

            mostrarToast( message , 'right', 'info', '¡ Hecho !', false ); // Agrega título aquí

          }) 
          .catch(err => console.log(err));

      })


      function efecto() {
        element.classList.remove('bi-heart');
        element.classList.add('bi-heart-fill')
      }

      function normalHeart() {
        element.classList.remove('bi-heart-fill');
        element.classList.add('bi-heart')
      }


    }

</script>

<script>
 //este es el controlador de las ofertas
  const offer = document.querySelectorAll('.offer');
  const tagOffer = document.querySelectorAll('.tagOffer');//visitante de tienda
  const tagOfferUser = document.querySelectorAll('.tagOfferUser');//propietario de tienda
  const boxDetail = document.querySelectorAll('.boxDetail');
  //const tagSoldOut -> declardo abajo
  //const tagSoldOutUser declarado abajo

  //console.log("offer-->", offer)



  for (let i = 0; i < offer.length; i++) {
    const element = offer[i];
    element.addEventListener('click', () => {
      
      console.log("element-->", element)
      console.log("depart ---->",element.childNodes[1].value);
      console.log("id ---->",element.childNodes[3].value);
      
      const depart = element.childNodes[1].value;
      const id = element.childNodes[3].value;
      
      const datos = {
          depart: depart,
          id: id
        }

        fetch('/account/offer', {

          method: "post",
          body: JSON.stringify(datos),
          headers: { "content-type": "application/json" }

        })
          .then(response => response.json())
          .then(jsonx => {
            
            console.log("Esto es jsonx--->",jsonx)
            const Offer = jsonx[0].offer;
            console.log("Offer --->", Offer)
            if ( Offer === false ) {
              boxDetail[i].style.backgroundColor = "#ffffff";
              let closeClass =tagOffer[i].classList.contains('invisible');
              console.log("closeClass ->", closeClass)
              console.log("esto i ->", i)
              tagSoldOut[i].classList.add('invisible');
              tagSoldOutUser[i].classList.add('invisible');
              tagOffer[i].classList.toggle('invisible');
              tagOfferUser[i].classList.toggle('invisible');

            } else if ( Offer === true ) {
              boxDetail[i].style.backgroundColor = "#fcda57";
              let closeClass =tagOffer[i].classList.contains('invisible');
              console.log("closeClass ->", closeClass)
              console.log("esto i ->", i)
              tagSoldOut[i].classList.add('invisible');
              tagSoldOutUser[i].classList.add('invisible');
              tagOffer[i].classList.toggle('invisible');
              tagOfferUser[i].classList.toggle('invisible');
            }

          })
          .catch(err => console.log(err));
  
  
    });
  
  };
  
</script>

<script>
  //este es el controlador bestProduct
   const bestProduct = document.querySelectorAll('.bestProduct');
   const containBestProduct = document.querySelectorAll('.containBestProduct');
 
   for (let e = 0; e < bestProduct.length; e++) {
     const element = bestProduct[e];
     element.addEventListener('click', () => {
   
       //console.log(element.childNodes)
       console.log("depart ---->",element.childNodes[1].value);
       console.log("id ---->",element.childNodes[3].value);
       
       const depart = element.childNodes[1].value;
       const id = element.childNodes[3].value;
       
       const datos = {
           depart: depart,
           id: id
         }
 
         fetch('/account/best-product', {
 
           method: "post",
           body: JSON.stringify(datos),
           headers: { "content-type": "application/json" }
 
         })
           .then(response => response.json())
           .then(jsonx => {
             
             console.log("Esto es jsonx--->",jsonx)
             const BestProduct = jsonx[0].bestProduct;
 
             if ( BestProduct === false ){
              containBestProduct[e].innerHTML = '';
             } else {
              containBestProduct[e].innerHTML = '<i class="bi bi-award"></i>';
             }
 
           })
           .catch(err => console.log(err));
   
   
     });
   
   };
   
</script>

<script>
  //este es el controlador del onlyOneAvailable "unico disponible"
   const onlyOneAvailable = document.querySelectorAll('.onlyOneAvailable');
   const containerOnlyOneAvailable = document.querySelectorAll('.containerOnlyOneAvailable');
   //const tagSoldOut -> declarado abajo
   //const tagSoldOutUser -> declarado abajo
 

   for (let g = 0; g < onlyOneAvailable.length; g++) {
     const element = onlyOneAvailable[g];
     element.addEventListener('click', () => {
   
       //console.log(element.childNodes)
       console.log("depart ---->",element.childNodes[1].value);
       console.log("id ---->",element.childNodes[3].value);
       
       const depart = element.childNodes[1].value;
       const id = element.childNodes[3].value;
       
       const datos = {
           depart: depart,
           id: id
         }
 
         fetch('/account/only-one-available', {
 
           method: "post",
           body: JSON.stringify(datos),
           headers: { "content-type": "application/json" }
 
         })
           .then(response => response.json())
           .then(jsonx => {
             
             console.log("Esto es jsonx - unico disponible--->",jsonx)
             const OnlyOneAvailable = jsonx[0].onlyOneAvailable;
             console.log("OnlyOneAvailable ->", OnlyOneAvailable)

             if ( OnlyOneAvailable === false ){
              containerOnlyOneAvailable[g].innerHTML = '';
              tagSoldOut[g].classList.add('invisible');
              tagSoldOutUser[g].classList.add('invisible');
             } else {
              containerOnlyOneAvailable[g].innerHTML = '<i class="bi bi-1-square-fill me-1"></i>';
              tagSoldOut[g].classList.add('invisible');
              tagSoldOutUser[g].classList.add('invisible');
             }
 
           })
           .catch(err => console.log(err));
   
   
     });
   
   };
   
</script>

<script>
  //este es el controlador de los delivery
   const delivery = document.querySelectorAll('.delivery');
   const containerDelivery = document.querySelectorAll('.containerDelivery');
   //console.log("------- containerDelivery ---------", containerDelivery);
  

   for (let i = 0; i < delivery.length; i++) {
     const element = delivery[i];
     element.addEventListener('click', () => {
       console.log("Esto es i -->", i);
       //console.log(element.childNodes)
       console.log("depart ---->",element.childNodes[1].value);
       console.log("id ---->",element.childNodes[3].value);
       
       const depart = element.childNodes[1].value;
       const id = element.childNodes[3].value;
       
       const datos = {
           depart: depart,
           id: id
         }
 
         fetch('/account/delivery', {
 
           method: "post",
           body: JSON.stringify(datos),
           headers: { "content-type": "application/json" }
 
         })
           .then(response => response.json())
           .then(jsonx => {
             
             console.log("Esto es jsonx--->",jsonx);
             const ID = jsonx[0]._id;
             const Delivery = jsonx[0].delivery;
             console.log("Esto es ID ---->", ID);
             console.log("Esto es Delivery ---->", Delivery);
 
             if ( Delivery === false ){
                containerDelivery[i].innerHTML = ''
             } else {        
                containerDelivery[i].innerHTML = '<i class="bi bi-truck me-1"></i>';
             }
 
           })
           .catch(err => console.log(err));
   
   
     });
   
   };
   
</script>

<script>
  //este es el controlador de las etiquetas agotados
  
   const soldOut = document.querySelectorAll('.soldOut');
   const tagSoldOut = document.querySelectorAll('.tagSoldOut');
   const tagSoldOutUser = document.querySelectorAll('.tagSoldOutUser');
   const boxDetailSoldOut = document.querySelectorAll('.boxDetail'); //limpiar si estaba en oferta y quitar unio disponible
   //const tagOffer --> declarado arriba esto es un array de objetos
   //const tagOfferUser --> declarado arriba esto es un array de objetos
   //const containerOnlyOneAvailable --> declarado arriba. cuando colocamos agotado se debe eliminar tambien la etiqueta de ultimo disponible

    
  
  if (soldOut){
    //console.log("soldOut-->", soldOut)

      for (let i = 0; i < soldOut.length; i++) {
        const element = soldOut[i];
        element.addEventListener('click', () => {
          
          console.log("element-->", element)
          console.log("depart ---->",element.childNodes[1].value);
          console.log("id ---->",element.childNodes[3].value);
          
          const depart = element.childNodes[1].value;
          const id = element.childNodes[3].value;
          
          const datos = {
              depart: depart,
              id: id
            }
    
            fetch('/account/soldOut', {
    
              method: "post",
              body: JSON.stringify(datos),
              headers: { "content-type": "application/json" }
    
            })
              .then(response => response.json())
              .then(jsonx => {
                
                //console.log("Esto es jsonx--->",jsonx)
                const SoldOut = jsonx[0].soldOut;
                console.log("SoldOut --->", SoldOut)
                if ( SoldOut === false ) {
                  boxDetailSoldOut[i].style.backgroundColor = "#ffffff";
                  let closeClass =tagSoldOut[i].classList.contains('invisible');
                  console.log("closeClass ->", closeClass)
                  console.log("esto i ->", i)
                  tagOffer[i].classList.add('invisible');
                  tagOfferUser[i].classList.add('invisible');
                  tagSoldOut[i].classList.toggle('invisible');
                  tagSoldOutUser[i].classList.toggle('invisible');
                  containerOnlyOneAvailable[i].innerHTML = '';
    
                } else if ( SoldOut === true ) {
                  boxDetailSoldOut[i].style.backgroundColor = "#ffffff";
                  let closeClass =tagSoldOut[i].classList.contains('invisible');
                  console.log("closeClass ->", closeClass)
                  console.log("esto i ->", i)
                  tagOffer[i].classList.add('invisible');
                  tagOfferUser[i].classList.add('invisible');
                  tagSoldOut[i].classList.toggle('invisible');
                  tagSoldOutUser[i].classList.toggle('invisible');
                  containerOnlyOneAvailable[i].innerHTML = '';
                }
    
              })
              .catch(err => console.log(err));
      
      
        });
    
      };
    
  }

</script>

<script>
/* purchaseTime es el agotado que termine con el avisarme cuando este disponible */
const purchaseTime = document.querySelectorAll('.purchaseTime');
const boxDetailPurchaseTime = document.querySelectorAll('.boxDetailPT');

if (purchaseTime){

    purchaseTime.forEach((ele, i)=>{
      ele.addEventListener('click', ()=>{

        console.log("element-->", ele)
        //console.log("ele.childNodes -->", ele.childNodes);
        console.log("depart ---->",ele.childNodes[3].value);
        console.log("id ---->",ele.childNodes[5].value);
        const depart = ele.childNodes[3].value;
        const id = ele.childNodes[5].value;

        efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
        efectSoundExpan.play().catch(error => {
            console.error("Error al reproducir el sonido:", error);
        });

        const datos = {
            depart: depart,
            id: id
        }
        console.log("datos ->", datos);
  
          fetch('/account/purchaseTime', {
  
            method: "post",
            body: JSON.stringify(datos),
            headers: { "content-type": "application/json" }
  
          })
            .then(response => response.json())
            .then(jsonx => {
              
              console.log("Esto es jsonx--->",jsonx);
              const note = jsonx.note;
              console.log("note ->", note)
              // esto llefa del backend --> const response = con note 0 o note 1;

              if (note === 1){
                boxDetailPurchaseTime[i].innerHTML = `<div class="d-flex flex-column align-items-center">  <span class="d-flex justify-content-center align-items-center bg-success text-light rounded-pill" style= "width: 30px; height: 30px"> <i class="bi bi-envelope"></i> </span>  ¡Será notificado al estar disponible!. </div>`
              } else {
                boxDetailPurchaseTime[i].innerHTML = `<div class="d-flex flex-column align-items-center">  <span class="d-flex justify-content-center align-items-center bg-danger text-light rounded-pill" style= "width: 30px; height: 30px"> <i class="bi bi-trash-fill"></i> </span>  ¡Notificación eliminada!. </div>`
              }                

              boxDetailPurchaseTime[i].classList.toggle('close');

              setTimeout(() => {
                boxDetailPurchaseTime[i].classList.toggle('close');
              }, 3500);

  
            })
            .catch(err => console.log(err));
    

      })
    })

}  



</script>

<script>
  //aqui enviamos datos al backend para saber si el usuario logeado ha hecho la encuesta si hay disponible en la tienda visitada.
  //aqui vamos hacer la consulta. la idea es que a todos los visitante sle salte un aviso de que hay una encuesta disponible. y de esta manera la hagan. 
  const surveyShow = document.getElementById('surveyShow');
  const btnTakeSurvey = document.getElementById('btnTakeSurvey');

  // Crea una instancia del modal
  let myModal = new bootstrap.Modal(document.getElementById('staticSurveyinvitation'));

  if (surveyShow){

      const surveyShowValue = surveyShow.value;
      
      console.log("surveyShowValue --->", surveyShowValue);

      if (surveyShowValue === "true"){
        console.log("Esta tienda tiene una encuesta activa. vamos a notificarle al visitante que la haga");
        
        const indexed = store_indexed.value; //dueño de la tienda          
        const surveyIdValue =  surveyId.value;     

          const datos = {
            indexed,
            surveyId: surveyIdValue,
          };

          console.log("datos ->", datos);

          //hacemos una consulta para evaluar si este usuario ya ha realizado la encuesta en el caso que exista.
          fetch('/account/survey/search', {

            method: "post",
            body: JSON.stringify(datos),
            headers: {"content-type" : "application/json"}

          })
            .then(response => response.json() )
            .then( jsonx => { 
              const code = jsonx.code
              //1 = Si ha realizado la encuesta
              //0 = No ha realizada la encuesta
              console.log("esta es la consulta de si ha hecho o no la encuesta", code)
            
              if (code === 0){
                console.log("Como no la ha hecho vamos a ponerle un mensaje en pantalla invitandole hacer la encuesta")

                // Muestra el modal
                myModal.show();

              } 


            })
            .catch( err => console.log(err)); 

      }

      //aqui activamos el boton para hacer la subasta
      btnTakeSurvey.addEventListener('click', ()=>{

        //escondemos el modal 
        myModal.hide();

        //activamos la encuesta
        surveyTakeShow()

        function surveyTakeShow(){
          //acciones que se realzian para mostrar la encuesta
          containerSegment.classList.add('close');
          containerWorkSpace.classList.add('close');
          mainGallery.classList.add('close');

          containerInfoBliss.classList.remove('close');

          containerPolity.classList.add('close');
          containerFaqs.classList.add('close');
          containerSurvey.classList.remove('close');
          containerLocation.classList.add('close');

          containerSurveyCustomer.classList.remove('close');
          containerSurveyDone.classList.add('close');
          containerError.classList.add('close');
          irATopBar() //nos llevan al lugar que se debe en el DOM
        }  

      })
  }  
    

</script>

<script>

const countResponse = []; let countLikert = 0;
const surveyDataInput = document.getElementById('surveyDataInput');

if (surveyDataInput){

    const survey = JSON.parse(surveyDataInput.value);

    async function countLikertF(){
        //console.log("survey -->", survey); // Muestra el array en la consola

        // iteramos sobre el array
        survey.forEach(item => {
            const boxResponses = item.boxResponses
            //console.log(boxResponses); // Haz algo con cada elemento del array
            countResponse.push(...boxResponses)
        });

        //console.log("countResponse -->", countResponse)
        countResponse.forEach((ele, i)=>{
            if (ele === "likert" ){
                countLikert ++;
            }
        })
    }

    countLikertF()
        .then(()=>{
            //console.log("countLikert --", countLikert);
            const cards = {};

            for (let i = 0; i < countLikert + 2; i++) {
                //console.log("Esto es i", i);
                const boxLikertSelect = document.querySelectorAll(`.card${i}`);
                cards[`card${i}`] = boxLikertSelect;

                boxLikertSelect.forEach(box => {
                    box.addEventListener('click', () => {
                        // Agregar o quitar la clase 'mark' al elemento clicado
                        box.classList.toggle('marked');

                        // Desmarcar los demás elementos dentro de la misma NodeList
                        boxLikertSelect.forEach(otherBox => {
                            if (otherBox !== box) {
                                otherBox.classList.remove('marked');
                            }
                        });
                    });
                });
            }

            
    })

      

}


</script>

<script>
  //const store_indexed = document.getElementById('store_indexed'); declarado arriba
  //const surveyId = document.getElementById('surveyId'); declarado arriba
  const surveyTitle = document.getElementById('surveyTitle');
  const surveyTime = document.getElementById('surveyTime'); //aqui tenemos la fecha de creacion de la encuesta esquema 
  const radios = document.querySelectorAll('.radioQuestion'); 
  const totalQuestions = document.getElementById('totalQuestions');
  const likert = document.querySelectorAll('.boxLikert');
  const btnSendSurvey = document.getElementById('btnSendSurvey');
  const btnSendSurveyLock = document.getElementById('btnSendSurveyLock');



  if (btnSendSurvey){

    btnSendSurvey.addEventListener('click', ()=>{
   
        const checkedValues = [];
        const totalCard = totalQuestions.value;

        // Itera sobre los radios para encontrar los que están seleccionados
        radios.forEach((radio) => {
            if (radio.checked) {
              checkedValues.push(radio.value); // Agrega el valor del radio seleccionado al array
            }
        });

        likert.forEach((ele)=>{
          if (ele.classList.contains('marked') === true ){
            const value = ele.getAttribute('data-value');
            console.log(value); // Esto mostrará "tuValor"
            checkedValues.push(value); // Agrega el valor del radio seleccionado al array
          }
        })
      
        // Muestra los valores seleccionados en la consola o haz lo que necesites con ellos
        console.log("Valores seleccionados:", checkedValues);
        console.log("Valores seleccionados length:", checkedValues.length);
        console.log("totalCard --->", totalCard);

        if (totalCard == checkedValues.length){
            
            //debemos bloquear el boton para que no pueda darle dos veces y crear dos encuestas.
            btnSendSurvey.setAttribute("disabled", "");
            btnSendSurvey.classList.add('close');
            btnSendSurveyLock.classList.remove('close');
            console.log("Se ha respondido todas las preguntas, podemos enviar al backend");

            efectSoundExpan.currentTime = 0; //Reiniciamos el sonido
            efectSoundExpan.play().catch(error => {
                  console.error("Error al reproducir el sonido:", error);
            });

            const indexed = store_indexed.value;  
            const surveyTitleValue = surveyTitle.value;
            const surveyTimeValue = surveyTime.value;       
            const surveyIdValue =  surveyId.value;
            const surveyDataValue = JSON.parse(surveyDataInput.value);
             

            const datos = {
              indexed,
              surveyTitle: surveyTitleValue,
              surveyId: surveyIdValue,
              surveyTime : surveyTimeValue,
              boxSurvey : checkedValues,
              surveyData : surveyDataValue
            };

            console.log("datos ->", datos);
  
            fetch('/account/survey', {

              method: "post",
              body: JSON.stringify(datos),
              headers: {"content-type" : "application/json"}

            })
              .then(response =>response.json() )
              .then( jsonx => {
                  console.log(jsonx)
                  const code = jsonx.code;
                  const message = jsonx.message;
                  console.log("code --->", code);
                  console.log("code typeof --->", typeof code);
                  console.log("message --->", message);

                  setTimeout(() => {
                    
                    if (code === 0){
                      containerSurveyCustomer.classList.add('close');
                      containerSurveyDone.classList.add('close');
                      containerError.classList.add('close');

                    } else if (code === 1) {
                      containerSurveyCustomer.classList.add('close');
                      containerSurveyDone.classList.remove('close');
                      containerError.classList.add('close');

                    } else if (code === 2){
                      containerSurveyCustomer.classList.add('close');
                      containerSurveyDone.classList.add('close');
                      containerError.classList.remove('close');

                    }

                  }, 2000);  
                
              })
              .catch( err => console.log(err));


        } else {
          console.log("Faltan preguntas por responder, un alert que faltan por responder.");
          var myModal = new bootstrap.Modal(document.getElementById('staticSurveyFail'));
          myModal.show();
        }
    

    })

  }

</script>


<script>


    function mostrarToast(mensaje, posicion, color, titulo = '', conBotonCerrar = false) {
        // Configuración predeterminada
        toastr.options = {
            "closeButton": conBotonCerrar, // Agregar botón de cerrar si se solicita
            "debug": false,
            "newestOnTop": false,
            "progressBar": !conBotonCerrar, // Si tiene botón de cerrar, no mostrar barra de progreso
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "600",
            "hideDuration": "1000",
            "timeOut": conBotonCerrar ? false : "8000", // No se oculta automáticamente si tiene botón de cerrar
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
  
        // Configurar la posición
        switch (posicion) {
            case 'center':
                toastr.options.positionClass = 'toast-top-center';
                break;
            case 'left':
                toastr.options.positionClass = 'toast-top-left';
                break;
            case 'right':
                toastr.options.positionClass = 'toast-top-right';
                break;
            default:
                toastr.options.positionClass = 'toast-top-right'; // Posición predeterminada
        }
  
        // Mostrar el mensaje según el color especificado
        switch (color) {
            case 'success':
                titulo ? toastr.success(mensaje, titulo) : toastr.success(mensaje);
                break;
            case 'info':
                titulo ? toastr.info(mensaje, titulo) : toastr.info(mensaje);
                break;
            case 'warning':
                titulo ? toastr.warning(mensaje, titulo) : toastr.warning(mensaje);
                break;
            case 'danger':
                titulo ? toastr.error(mensaje, titulo) : toastr.error(mensaje);
                break;
            case 'primary':
                titulo ? toastr.info(mensaje, titulo, { toastClass: 'toast-primary' }) : toastr.info(mensaje, '', { toastClass: 'toast-primary' });
                break;
            case 'dark':
                titulo ? toastr.info(mensaje, titulo, { toastClass: 'toast-dark' }) : toastr.info(mensaje, '', { toastClass: 'toast-dark' });
                break;
            default:
                console.warn('Color no válido. Usando el color por defecto (success).');
                titulo ? toastr.success(mensaje, titulo) : toastr.success(mensaje);
        }
    }
  
    //mostrarToast( response , 'right', 'danger', '', true ); // Agrega título aquí
  
</script>


<% }; %>


</body>


