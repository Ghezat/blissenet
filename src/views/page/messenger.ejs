<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head.ejs') %>
    <link rel="stylesheet" href="/toastr/toastr.min.css"> <!-- tiene que estar despues del CDN de bootstrap -->
    <script src="/toastr/toastr.min.js"></script>
    <title>Blissenet Notificaciones</title>
</head>
<style>
    .blockRed{
        background-color: red;
        border-radius: 2px;
        width: 26px;
        height: 16px;
        padding: 0px, 5px;
        margin-top: 6px;
    }

    .blockGreen{
        background-color: green;
        border-radius: 2px;
        width: 26px;
        height: 16px;
        padding: 0px, 5px;
        margin-top: 6px;
    }

    .open{
    display: block;
    }

    .closed{
        display: none;
   
    }

    .blackBody{
        /* esta es la clase que utiliza bodyTheme */
        background-color: #272b2f;
    }

    .textLight{
        /* trabaja en conjunto con themaTextLight */
        color: white;
    }

    .toast-success {
        /* Esta clase es unicamente para dar color al alert toastr de tipo success que debe ser violeta */
        background-color: #6f42c1; /* Azul tirando a morado */
        color: white; /* Color del texto */
    }

</style>
<body class="mainTheme">

     
  <main style="height: auto;">
    <%- include('../partials/navi-simple.ejs') %>
    <% if (user) { %>
      <% const seeMarket = user.seeMarket %>
      <% const idUser = user._id %>
      <input type="hidden" value="<%= seeMarket.countryMarketCode %>" id="seeMarket">
      <input type="hidden" value="<%= idUser %>" id= "idUser">
      <!-- este bloque me permite validad si el usuario que se logea tiene un mercado definido. sino lo tiene debe obligatoriamente hacerlo. --> 

  
        <div class="container-fluid d-flex justify-content-between py-2" style="background: linear-gradient(90deg, rgba(146,0,255,1) 0%, rgba(174,65,255,1) 50%, rgba(13,110,253,1) 100%);">
            <div class="ms-2 p-0" style="font-weight: 400; color: #ffde00;"> <b> Notificaciones </b>  </div>
            
            <div class="btn-group btn-group-sm mx-2" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-dark active" id="btnInbox">Entrantes</button>
                <button type="button" class="btn btn-dark" id="btnOutbox">Salientes</button>
            </div>
        </div>
   
        <!-- searchMessageInbox -->
        <div class="contentInbox">
            <div class="row m-0 d-flex justify-content-center" style="width: 100%; overflow-y: auto;">

                <div class="col-xxl-10 col-xl-10 col-lg-10 col-md-10 col-sm-10 col-11 my-4 p-0">

                      <div class="ContainerMessage rounded-1 p-2" style="background-color: rgba(56, 61, 66, 0.2);">
                         <div class="containerMessage d-flex flex-column p-2 themaTextLight">
                            <div class="containerMain d-flex flex-column">
                                    <!-- mensajes que llegan al messenger -->
                                    <div class="contentLabel mb-2" style="display: flex; align-items: center;">
                                        <label for="" class="text-secondary my-1 me-2" style="font-size: 16px; margin-right: 10px;"> Entrantes </label>
                                        <hr style="border-top: 1px solid #ccc; flex-grow: 1; margin: 0;">
                                    </div>

                                    <% if (searchMessageInbox.length !== 0 ) { %>
                                        <% searchMessageInbox.forEach((ele, i)=>{ %>
    
                                            <% if (ele.typeNote === "notes") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-between">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <div> <img src="/img/iconAdmin.gif" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <div class="d-flex align-items-end"> <a href="/product/<%= ele.depart %>/<%= ele.productId %>"> <p class="m-0" style="font-size: 18px;"><%= ele.titleArticle %></p> </a> </div>
                                                            </div>

                                                            <div>  <p style="font-size: 18px;"><%= ele.question %> <span> <small> <code>(admin-report)</code></small> </span></p> </div>
                                                        </div>
                                                        <div class="contentView">
                                                            <% if (ele.answer === 'waiting'){  %>
                                                                <a href="/myaccount/messenger/view/<%= ele._id %>"><button class="btn btn-primary btn-sm">Visto</button></a>
                                                            <% }; %>    
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>

                                            <% } else if (ele.typeNote === "spread") {  %>  
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-between">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/product/<%= ele.depart %>/<%= ele.productId %>/<%= ele.titleURL %>"> <p class="m-0" style="font-size: 18px;"><%= ele.titleArticle %></p> </a> </div>
                                                            </div>

                                                            <div>  <p style="font-size: 18px;"><%= ele.question %></p> </div>
                                                        </div>
                                                        <div class="contentView">
                                                            <% if (ele.answer === 'waiting'){  %>
                                                                <a href="/myaccount/messenger/view/<%= ele._id %>"><button class="btn btn-primary btn-sm">Visto</button></a>
                                                            <% }; %>    
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>
                                                
                                            <% } else if (ele.typeNote === "followMe") {  %>  
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-between">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>

                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> </p> </div>
                                                        </div>
                                                        <div class="contentView">
                                                            <% if (ele.answer === 'waiting'){  %>
                                                                <a href="/myaccount/messenger/view/<%= ele._id %>"><button class="btn btn-primary btn-sm">Visto</button></a>
                                                            <% }; %>    
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>
                                            
                                            <% } else if (ele.typeNote === "availability-noti") { %>
                                                <div class="bodyTheme">
                                                    <form action="/myaccount/messenger/view/<%= ele._id %>" method="get">

                                                        <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                        
                                                        <div class="containerImgTitle d-flex">
            
                                                            <div><img src="<%= ele.urlImageArticle %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                            <div> <a href="/product/<%= ele.depart %>/<%= ele.productId %>/<%= ele.titleURL %>"> <p style="font-size: 18px;" ><%= ele.titleArticle %></p> </a> </div>
                    
                                                        </div>
                                                        <div class="question d-flex justify-content-between">
                                                            <p style="font-size: 18px;"><%= ele.question %> 
                                                                <span> <a href="/account/<%= ele.ownerStore %>"> <small>(<%= ele.ownerStore %>) </small> </a> </span>
                                                            </p> 
                                                            <button type="submit" class="btn btn-primary btn-sm ms-2" style="height: 30px;">Visto</button>
                                                        </div>                                      

                                                    </form>
                                                    <hr class="m-1">     
                                                </div>
                                                
                                            <% } else if (ele.typeNote === "messages") { %>
                                                <div class="bodyTheme">
                                                    <form action="/myaccount/messenger/response" method="post">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex">
        
                                                        <div><img src="<%= ele.urlImageArticle %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                        <div> <a href="/product/<%= ele.depart %>/<%= ele.productId %>/<%= ele.titleURL %>"> <p style="font-size: 18px;" ><%= ele.titleArticle %></p> </a> </div>
                
                                                    </div>
                                                    <div class="question">
                                                        <p style="font-size: 18px;"><%= ele.question %> <span>  <small>(<%= ele.username %>) </small>  </span></p> 
                                                    </div>
                                                    <div class="containerInputSubmit form-group d-flex justify-content-between mb-2">
                                                        <input type="hidden" name="idMesagge" value="<%= ele._id%>">
                                                        <input type="text" name="answer" class="form-control" style="width: 79%;" required> 
                                                        <input type="submit" class="form-control btn btn-primary" style="width: 20%;">
                                                    </div>
                                                    

                                                    </form>
                                                    <hr class="m-1">     
                                                </div>                                                  
                                            
                                            <% } else if (ele.typeNote === "shoppingCart-Cre") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-start">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                    
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>
                                                                                                
                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> Ir a la <a href="/myaccount/shopping-cart-admin"> <b>Administración de carritos.</b> </a> </p> </div>
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>

                                            <% } else if (ele.typeNote === "shoppingCart-Del") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-between">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>

                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> </p> </div>
                                                        </div>
                                                        <div class="contentView">
                                                            <% if (ele.answer === 'waiting'){  %>
                                                                <a href="/myaccount/messenger/view/<%= ele._id %>"><button class="btn btn-primary btn-sm">Visto</button></a>
                                                            <% }; %>    
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>

                                            <% } else if (ele.typeNote === "shoppingCart-Con") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-star">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>

                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> <a href="/payShoppingCart"> <b>gestione su pago aquí.</b> </a> </p> </div>
                                                        </div>
                                                        <div class="contentView">
                                                           <!--  NO existe el boton view -->
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div> 
          
                                            <% } else if (ele.typeNote === "shoppingCart-RPay") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-star">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>
                                                            
                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> Puedes ir a la <a href="/myaccount/shopping-cart-admin"> <b> Administración de carritos para hacerlo. </b> </a> </p> </div>
                                                            
                                                        </div>
                                                        <div class="contentView">
                                                           <!--  NO existe el boton view -->
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>
                                                
                                            <% } else if (ele.typeNote === "shoppingCart-Paid") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-start">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>
                                                            
                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> Puedes ver el seguimiento en <a href="/myaccount/tracking"><b>Tracking</b>.</a>   </p> </div>
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>
                                                 
                                            <% } else if (ele.typeNote === "shoppingCart-unPaid") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-between">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>
                                                            
                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> Puedes ver el seguimiento en <b>Tracking</b>. </p> </div>
                                                        </div>
                                                        <div class="contentView">
                                                            <% if (ele.answer === 'waiting'){  %>
                                                                <a href="/myaccount/messenger/view/<%= ele._id %>"><button class="btn btn-primary btn-sm">Visto</button></a>
                                                            <% }; %>
                                                        </div>
                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>
                                                                                                                                                                              
                                            <% } else if (ele.typeNote === "shoppingCart-Sent") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-start">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>
                                                            
                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> Por favor, confirme la recepción en <a href="/payShoppingCart"> <b>Gestión de Carritos.</b> </a> </p> </div>
                                                        </div>

                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>

                                            <% } else if (ele.typeNote === "shoppingCart-Received") { %>
                                                <div class="bodyTheme">

                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex justify-content-start">
  
                                                        <div class="contentImgTitle d-flex flex-column">
                                                            <div class="contentImgTitle d-flex">
                                                                <% if (ele.objeAvatar.avatar ==="") { %>
                                                                    <div> <img src="https://www.gravatar.com/avatar/<%= ele.objeAvatar.avatarDefault %>?d=identicon" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                                   
                                                                <% } else { %>
                                                                    <div> <img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div> 
                                                                <% }; %>        
                                                                 
                                                                <div class="d-flex align-items-end"> <a href="/account/<%= ele.username %> "> <p class="m-0" style="font-size: 18px;"> <%= ele.username %></p> </a> </div>
                                                            </div>
                                                            
                                                            <div>  <p style="font-size: 18px;"> <%= ele.question %> ir a <a href="/myaccount/shopping-cart-admin"><b> <i>Administrador de carritos.</i> </b> </a> </p> </div>
                                                        </div>

                                            
                                                    </div>
                                                    

                                                    <hr class="m-1">     
                                                </div>

                                             <% } else if (ele.typeNote === "artAndArticle-Rate") { %>
                                                <div class="bodyTheme">
                                                    
                                                    <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>  
                                                    <div class="containerImgTitle d-flex">
        
                                                        <div><img src="<%= ele.objeAvatar.avatar %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                        <div> <p style="font-size: 18px;"> La comunidad agradece las calificaciones.</p> </div>
                
                                                    </div>
                                                    
                                                    <div class="question mt-2">
                                                        <p class="rounded-2 ps-1" style="font-size: 18px;"><%= ele.question %> <span>  </span></p> 
                                                    </div>

                                                    <div class="containRateStar d-flex justify-content-center border border-dark py-3 my-2 rounded-2" style="width: 100%; background-color: rgba(56, 56, 56, 1);">
                                                        <input type="hidden" id="idMesagge" value="<%= ele._id%>"> <!-- esto es importante porque luego de enviar la califacion con este id podemos actualizar este mensaje para que ya no aparezca dandole un valor true en el campo view -->
                                                        <input type="hidden" id="department"  value= "<%= ele.department %>"> 
                                                        <input type="hidden" id="productId"  value= "<%= ele.productId %>"> 
                                                        <input type="hidden" name="starValue" id="starHidden">
                                                        <i class="starE bi bi-star mx-2" data-star="1" style="color: #0d6efd; font-size: 1.4rem; cursor: pointer;"></i>
                                                        <i class="starE bi bi-star mx-2" data-star="2" style="color: #0d6efd; font-size: 1.4rem; cursor: pointer;"></i>
                                                        <i class="starE bi bi-star mx-2" data-star="3" style="color: #0d6efd; font-size: 1.4rem; cursor: pointer;"></i>
                                                        <i class="starE bi bi-star mx-2" data-star="4" style="color: #0d6efd; font-size: 1.4rem; cursor: pointer;"></i>
                                                        <i class="starE bi bi-star mx-2" data-star="5" style="color: #0d6efd; font-size: 1.4rem; cursor: pointer;"></i> 
                                                    </div>  

                                                    <div class="containerInputSubmit form-group d-flex justify-content-between mb-2">
                                                        <input type="text" class="form-control" style="width: 79%;" id="commentId" required> 
                                                        <input type="submit" class="form-control btn btn-primary" style="width: 20%;" id="btnSend">
                                                    </div>
                                                    
                                                    <hr class="m-1">     
                                                </div>    

                                             <% }; %>  

<!--                                             newNotificationRate  {
                                                typeNote: 'artAndArticle-Rate',
                                                times: '17-11-2025 12:57',
                                                objeAvatar: {
                                                    avatar: 'https://bucket-blissve.nyc3.digitaloceanspaces.com/firstImgBuySell/1763389938471.png'
                                                },
                                                username: 'DayOfTheTentacle',
                                                question: '¡Hola, es tiempo de calificar Linterna Cat - baterias recargables!',
                                                toCreatedArticleId: '68add4dca09409e3310898e0',
                                                productId: new ObjectId("678eaa9dd30c9cb0f7745033"),
                                                markStar: 0,
                                                answer: 'waiting',
                                                view: false,
                                                _id: new ObjectId("691b540764d487d9ccc30d5b")
                                            } -->

                                        <% }); %>
                                      
                                    <% } else {  %>
                                      <div class="containerMessage">
                                          <span style="font-size: 16px;">¡No hay notificaciones entrantes! <i class="bi bi-emoji-frown ms-3"></i></span>
                                      </div>
                                    <% }; %> 
  
                            </div>
                         </div>
                      </div>

                </div> 
  
            </div>
        </div>

        <!-- searchMessageOutbox -->
        <div class="contentOutbox">
            <div class="row m-0 d-flex justify-content-center" style="width: 100%; overflow-y: auto;">

                <div class="col-xxl-10 col-xl-10 col-lg-10 col-md-10 col-sm-10 col-11 my-4 p-0">

                    <div class="ContainerMessage rounded-1 p-2" style="background-color: rgba(56, 61, 66, 0.2);">
                        <div class="containerMessage d-flex flex-column p-2 themaTextLight">
                            <div class="containerMain d-flex flex-column">

                                <!-- mensajes que llegan al outBox -->
                                <div class="contentLabel mb-2" style="display: flex; align-items: center;">
                                    <label for="" class="text-secondary my-1 me-2" style="font-size: 16px; margin-right: 10px;"> Salientes </label>
                                    <hr style="border-top: 1px solid #ccc; flex-grow: 1; margin: 0;">
                                </div>
                                
                                <% if (searchMessageOutbox.length !== 0) {  %>
                                    <% searchMessageOutbox.forEach((ele)=>{ %>

                                        <div class="containerMessage">
                                            <div class="contentDateTime d-flex justify-content-center"> <small><span class="rounded-pill px-1 shadow-sm" style="background-color: rgba(95, 103, 110, 0.4);"><%= ele.times %></span> </small> </div>
                                            <div class="containerImgTitle d-flex justify-content-between">
  
                                                <div class="contentImgTitle d-flex">
                                                    <div><img src="<%= ele.urlImageArticle %>" style="width: 50px; height: 50px; object-fit: cover;" class="me-4 rounded-1"></div>
                                                    <div> <a href="/product/<%= ele.depart %>/<%= ele.productId %>/<%= ele.titleURL %>"> <p style="font-size: 18px;"><%= ele.titleArticle %></p> </a> </div>
                                                </div>
                                                <div class="contentView">
                                                    <% if (ele.answer !== 'waiting'){  %>
                                                        <a href="/myaccount/messenger/view/<%= ele._id %>"><button class="btn btn-primary btn-sm">Visto</button></a>
                                                    <% }; %>    
                                                </div>
                                    
                                            </div>
                                            <div class="contentQuestion">
                                                <p style="font-size: 18px;"><%= ele.question %></p>
                                            </div>

                                            <% if (ele.answer !== 'waiting'){ %>
                                            <div class="contentAnswer ms-2 rounded-1 p-1 d-flex" style="font-size: 18px;">
                                                <i class="bi bi-arrow-return-right me-2"></i> 
                                                <p><%= ele.answer %> <span> <a href="/account/<%= ele.ownerStore %>"> <small>(<%= ele.ownerStore %>)</small> </a> </span></p>
                                            </div>
                                            <% } else { %>
                                            <div class="contentAnswer ms-2 rounded-1 p-1 d-flex" style="font-size: 18px;">
                                                <i class="bi bi-arrow-return-right me-2"></i> 
                                                <p><i>¡...En espera de respuesta!</i></p>
                                            </div>
                                            <% } %>    
                                            <hr class="m-1">

                                        </div>
                                   
                                    <% }); %>    
                                
                                <% } else { %>

                                    <div class="containerMessage">
                                        <span style="font-size: 16px;">¡No hay notificaciones salientes!<i class="bi bi-emoji-frown ms-3"></i></span>
                                    </div>
                                   
                                <% } %>    
                            
                            </div>
                        
                        </div>
                    </div>
                
                </div>
                
            </div>
        </div>

    <% } else { %>
        <div class="container-fluid d-flex justify-content-center p-3" style="height: 90%; width: 100%; background-color:  rgb(243, 238, 238); box-shadow: 1px 1px 5px 1px rgb(99, 98, 98);  border-top: 2px ridge  rgb(243, 238, 238);">
    
            <%- include('../partials/noLogin.ejs') %>
        
        </div>    
    <% }; %>     

  </main>
  <%- include('../partials/scripts.ejs') %>
  <%- include('../partials/scriptsOnlyNavi-simpleNoIcons.ejs') %>

  <script>
    

    let btnInbox = document.getElementById('btnInbox');
    let btnOutbox = document.getElementById('btnOutbox');
    let contentInbox = document.querySelector('.contentInbox');
    let contentOutbox = document.querySelector('.contentOutbox');
                                                  
    btnInbox.addEventListener('click', ()=>{
      contentOutbox.classList.add('closed')
      contentInbox.classList.remove('closed')

      btnInbox.classList.add('active');
      btnOutbox.classList.remove('active');
    });

    btnOutbox.addEventListener('click', ()=>{
      contentOutbox.classList.remove('closed')
      contentInbox.classList.add('closed')

      btnInbox.classList.remove('active');
      btnOutbox.classList.add('active');
    });

  </script>

  <script>
    const starHidden = document.getElementById('starHidden'); //aqui guardo el valor de lacalificacion de la contraparte
    const starE = document.querySelectorAll('.starE'); // esto son iconos tipo estrella 
    let star = 1;

    if (starE) {
        starE.forEach((ele, i) => {
            ele.addEventListener("click", () => {
                star = ele.getAttribute("data-star"); // aquí es el número de la estrella
                
                // Desactivar o activar las estrellas
                starE.forEach((starElement, index) => {
                    if (index < parseInt(star)) {
                        starElement.classList.replace("bi-star", "bi-star-fill");
                    } else {
                        starElement.classList.replace("bi-star-fill", "bi-star");
                    }
                });

                starHidden.value = star;
                //console.log("el valor de starHidden .....:", starHidden.value);   

            });
        });
    }


</script>

<script>
    
    //const starHidden = document.getElementById('starHidden'); ya esta declarada arriba
    const commentId = document.getElementById('commentId');
    const btnSend = document.getElementById('btnSend');
    const idMesagge = document.getElementById('idMesagge');
    const department = document.getElementById('department');
    const productId = document.getElementById('productId');
    const starValue = starHidden;
    const answer = commentId;
    

    if (btnSend){
        btnSend.addEventListener('click', () => {

            // Proceso de validación
            if (validarFormulario()) {
            
                const Department = department.value; const ProductId = productId.value; const StarValue = starValue.value; const Answer = answer.value;
                const IdMesagge = idMesagge.value;
                console.log(` Department :${Department} | ProductId :${ProductId} | StarValue :${StarValue} | Answer :${Answer} | IdMesagge : ${IdMesagge} `)
                
                // lo que debe recibir en la ruta:  department, productId, starValue, answer
                const datos = {
                    department : Department,
                    productId : ProductId,
                    starValue : StarValue,
                    answer : Answer,
                    idMesagge : IdMesagge
                };

                fetch('/rateProduct', {

                method: "post",
                body: JSON.stringify(datos),
                headers: {"content-type" : "application/json"}

                })
                .then(response =>response.json() )
                .then( jsonx => {
                    console.log(jsonx)
                    const code = jsonx.code;
                    const message = jsonx.message;

                    if (code === "ok"){
                        mostrarToast( message , 'right', 'success', 'Hecho', true ); 
                        mostrarToast( "3 Ssegundos para actualizar la pagina." , 'right', 'info', '', true ); // Agrega título aquí
                        setTimeout(() => {

                        location.reload();

                        }, 3000);

                    } else {
                        mostrarToast( message , 'right', 'danger', 'Upps', true ); // Agrega título aquí
                    }

                })
                .catch( err => {
                    console.log(err);
                    mostrarToast( message , 'right', 'danger', 'Upps', true ); // Agrega título aquí
                });
                
                
            } else {
                //alert("Por favor, completa todos los campos requeridos."); // Mensaje de error
                console.log("comment", commentId.value.trim());
                console.log("starHidden", starHidden.value);
                const message = "Por favor, completa todos los campos requeridos.";
                mostrarToast( message , 'right', 'info', '', true ); // Agrega título aquí
            }
            
        });
    }    

    function validarFormulario() {
        // Aquí puedes agregar tus condiciones de validación
        return (commentId.value.trim() !== "") && (starHidden.value !== ""); // Esto envio un false o un true ?
    }

</script>

</body>
</html>

