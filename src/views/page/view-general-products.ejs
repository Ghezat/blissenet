<!DOCTYPE html>
<html lang="en">

<head>
    <title>Blissenet  View-General-Product</title>

    <meta property="og:title" content="<%= search.title %>">
    <meta property="og:type" content="product">
    <% if (user) { %>
    <meta property="og:description" content="Por tan solo $<%= search.price %> y Compartido por <%= user.username %>">
    <% } else { %>
    <meta property="og:description" content="Por tan solo $<%= search.price %>">
    <% } %>    
    <meta property="og:image" content="<%= search.images[0].url %>">
    <meta property="og:url" content="https://blissenet.com/product/<%= search.department %>/<%= search._id %>/<%= search.titleURL %>">    
    <meta name= "twitter:card" content="summary_large_image">
    <meta name= "twitter:title" content="<%= search.title %>">
    <% if (user) { %>
    <meta name= "twitter:description" content="Por tan solo $<%= search.price %> y Compartido por <%= user.username %>">
    <% } else { %>
    <meta name= "twitter:description" content="Por tan solo $<%= search.price %>">
    <% } %>
    <meta name= "twitter:image" content="<%= search.images[0].url %>">
    <meta name= "twitter:url" content="https://blissenet.com/product/<%= search.department %>/<%= search._id %>/<%= search.titleURL %>">
     
    <%- include('../partials/head.ejs') %>       

     <!-- semantic-ui -->
    <link rel="stylesheet" href="/semantic/semantic.min.css">
    <script src="/semantic/semantic.min.js"></script>

    <!-- toastr tiene que estar despues del CDN de bootstrap -->
    <link rel="stylesheet" href="/toastr/toastr.min.css"> 
    <script src="/toastr/toastr.min.js"></script>
    
</head>
<style>
    .bgSecondary-light{
        background-color: rgb(128, 128, 128);
    }

    .closed{
        display: none !important;
    }

    .photo img {
       max-width: none; /* Permitir que la imagen crezca sin restricciones */
    }

    .blueMask{
        background-color:  rgba(101, 153, 239, 0);
        transition: all 1s ease;
    }

    .blueMask:hover{
        background-color: rgba(101, 153, 239, 0.3);
        outline: 1px solid #6599ef;
        cursor: pointer;
    }

    .textLight{
    color: white;
    }


    .colorSelected{
        width: 20px;
        height: 20px;
        border-radius: 3px;
        border: 1px solid grey;
    }

    .emoji{
        cursor: pointer;
        transition: 0.3s;
    }

    .emoji:hover{
        font-size: 18px;
    }

    .color-cube{
        width: 30px;
        height: 30px;
        display: inline-block;
        margin: 3px;
        transition: 0.5s;
    }
    
    .color-cube:hover{
        cursor: pointer;
        outline: 2px solid lightskyblue;
    }

    .deleteNote{
        padding: 3px;
        color: #cbd1d6;
        background-color: rgba(0, 0, 0, 0.8);
        border-radius: 3px;
        opacity: 0;
        transition: 0.5s;
    }

    .note{
        transition: 0.5s;
    }

    .note:hover{

        .deleteNote{
            opacity: 1;
            cursor: pointer;
        }

    }

    /*este clase controla el comportamiento de las img que estan dentro 
    del contenedor de texto descripcionTecnica producido por el editor de texto */
    .contenSoon img{
        width: 100%;
        height: auto;
    }

    .ql-editor{
        padding: 0;
    }

    .buttonPause{
      background-color: #9200FF;
      color: #FEDE05;
      width: 100%;  
      position: relative;
      padding: 15px 20px;
      overflow: hidden;
      letter-spacing: 3px;
      font-weight: 800;
      font-size: 1em;
      text-transform: uppercase;
    }

    /* Estilos del boton processing ------------------------- */
    .buttonProcessingBuy{
      width: 100%;  
      position: relative;
      padding: 15px 20px;
      overflow: hidden;
      letter-spacing: 3px;
      font-weight: 800;
      font-size: 1em;
      text-transform: uppercase;
      animation: colorChange 3s infinite alternate; /* Cambia la duración y el modo según prefieras */
    }

    @keyframes colorChange {
        0% {
            background-color: blue;
            box-shadow: 0 0 20px blue;
        }
        50% {
            background-color: #9200FF;
            box-shadow: 0 0 20px #9200FF;
        }
        100% {
            background-color: blue;
            box-shadow: 0 0 20px blue;
        }
    }
    /* fin de estilos del boton processing ------------------------- */

/* Css para el boton de compra */

  section.containerBuy_btn{
    width: 100%;
    margin: 20px auto;
    text-align: left;
  }

  
    .buttonSlice:hover{
        cursor: pointer
    }

    .buttonSlice{
      width: 100%;  
      background: transparent; outline: none;
      background: #9200FF; outline: none;
      color: #FEDE05;
      position: relative;
     /*  border: 2px solid #111; */
      padding: 15px 20px;
      overflow: hidden;
    }

    /*button:before (attr data-hover)*/
    .buttonSlice:hover:before{opacity: 1; -webkit-transform: translate(0,0); transform: translate(0,0);}
    .buttonSlice:before{
      content: attr(data-hover);
      position: absolute;
      top: 1.1em; left: 0;
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-weight: 800;
      font-size: 1em;
      opacity: 0;
      -webkit-transform: translate(-100%,0);
              transform: translate(-100%,0);
      -webkit-transition: all .3s ease-in-out;
      transition: all .3s ease-in-out;
      color: #FEDE05;
    }
      /*button div (button text before hover)*/
    .buttonSlice:hover div{opacity: 0; -webkit-transform: translate(100%,0); transform: translate(100%,0)}
    .buttonSlice div{
        text-transform: uppercase;
        letter-spacing: 3px;
        font-weight: 800;
        font-size: 1em;
        -webkit-transition: all .3s ease-in-out;
        transition: all .3s ease-in-out;
        color: #FEDE05;
      }

    /* Css para el boton de compra */

    @media screen and (min-width: 290px) and (max-width: 499px ){
      .containerShare{
        /* esto pertenece al modulo de compartir */
        right: 3px;
    }

    }


</style>
<body class="mainTheme">
    
  <main>
    
    <%- include('../partials/navi-simple.ejs') %>

    <% if (reportDone) { %>
        <%- include('../alert/reportDone.ejs') %>
    <% }; %> 

    <% if (reportSuccess) { %>
        <%- include('../alert/reportSuccess.ejs') %>
    <% }; %> 

    <input type="hidden" value="<%= depart %>" id="departAllBody">
    <% if (user) { %>
        <% const seeMarket = user.seeMarket %>
        <!-- <% const idUser = user._id %> -->
        <input type="hidden" value="<%= seeMarket.countryMarketCode %>" id="seeMarket">
        <!-- <input type="hidden" value="<%= idUser %>" id= "idUser"> -->
          <!-- este bloque me permite validad si el usuario que se logea tiene un meercado definido. sino lo tiene debe obligatoriamente hacerlo. --> 
    
        <input type="hidden" value="<%= user._id %>" id="newBTNvisitante"> <!-- aqui el id del visitante -->
        <input type="hidden" value="<%= search.username %>" id="newBTNanunciante"> <!-- aqui el user anunciante -->
        <input type="hidden" value="<%= search.user_id %>" id="newBTNid_anunciante"> <!-- aqui el id del anunciante -->
        <input type="hidden" value="<%= search.department %>" id="newBTNdepart"> <!-- aqui el department -->
        <input type="hidden" value="<%= search.title %>" id="newBTNtitle"> <!-- aqui el title -->
        <input type="hidden" value="<%= search._id %>" id="newBTNid_title"> <!-- aqui el id del articulo -->
    

    <% }; %>
    
    <!-- audios disponibles para diferentes acciones -->        
    <!-- <audio src="/sound/Icon-efect.mp3" id="efectSoundNewNote"></audio> -->
    <audio src="/sound/Note-efect.mp3" id="efectSoundNewBid"></audio>
    <audio src="/sound/Icon-efect.mp3" id="efectSoundNewNote"></audio> 
     

    <!-- esta variable desgloza la fecha de creacion del anuncio -->
    <% const creationADS = search.createdAt %>
 
    <% const TDay = creationADS.getDate() %>
    <% const TMonth = creationADS.getMonth() + 1 %>
    <% const TYear = creationADS.getFullYear() %>
            
    

    <div class="row border border-ligth m-0" style="width: 100%;">      
       <!--  ::::: productId ::::: -->
        <% if (productId) { %>
            <input type="hidden" value="<%= productId %>" id="productId">
        <% }; %>
        <!-- :::::::::: -->

        <% if  (search) { %>
            <% const titleURL = search.titleURL %> 
            <div class="col-lg-3 p-2" style="background-color: rgb(233, 236, 239); ">
            <% if (depart == 'arts')  { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1>
                            <p class="fw-bold mb-1">Categoria: <span class="fw-light ms-1"><%= search.category %></span> </p>
                            <p class="fw-bold mb-1">Autor: <span class="fw-light ms-1"><%= search.author %></span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>
                            <hr>
                            
                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>
                </div>
            <% }; %>    
            <% if (depart == 'automotive')  { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1>
                            <p class="fw-bold mb-1">Categoria : <span class="fw-light ms-1"><%= search.category %></span> </p>
                            <p class="fw-bold mb-1">Marca : <span class="fw-light ms-1"><%= search.sub_category %></span> </p>
                            <p class="fw-bold mb-1">Modelo : <span class="fw-light ms-1"><%= search.model %> </span> </p>
                            <p class="fw-bold mb-1">Año : <span class="fw-light ms-1"><%= search.construcDate %> </span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>
                            <hr>
        
                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>     
                </div>
            <% }; %>
            <% if (depart == 'items')  { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1>
                            <p class="fw-bold mb-1">Categoria : <span class="fw-light ms-1"><%= search.category %></span> </p>
                            <p class="fw-bold mb-1">Sub-Categoria : <span class="fw-light ms-1"><%= search.sub_category %></span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>
                            <hr>

                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>
                </div>
            <% }; %>
            <% if (depart == 'airplanes')  { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1> 
                            <p class="fw-bold mb-1">Categoria : <span class="fw-light ms-1"> <%= search.category %></span>  </p>
                            <p class="fw-bold mb-1">Marca : <span class="fw-light ms-1"> <%= search.produce %></span> </p>  
                            <p class="fw-bold mb-1">Modelo : <span class="fw-light ms-1"> <%= search.model %></span> </p> 
                            <p class="fw-bold mb-1">Año : <span class="fw-light ms-1"> <%= search.construcDate %></span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p> 
                            <hr>

                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>
                </div>
            <% }; %>
            <% if (depart == 'realstate') {  %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1>
                            <p class="fw-bold mb-1"> Tipo: <span class="fw-light ms-1"><%= search.category %> </span> </p>
                            <p class="fw-bold mb-1"> Oferta: <span class="fw-light ms-1"><%= search.sub_category %></span> </p>
                            <p class="fw-bold mb-1"> Año: <span class="fw-light ms-1"> <%= search.construcDate %> |</span> Mtrs2:  <span class="fw-light ms-1"><%= search.mtrs2 %> </span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p> 
                            <hr>

                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>
                </div>
            <% }; %>
            <% if (depart == 'nautical') {  %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1>
                            <p class="fw-bold mb-1">Tipo : <span class="fw-light ms-1"><%= search.category %></span> </p>
                            <p class="fw-bold mb-1">Oferta : <span class="fw-light ms-1"><%= search.sub_category %></span> </p>
                            <p class="fw-bold mb-1">Año : <span class="fw-light ms-1"> <%= search.construcDate %> |</span> Eslora :<span class="fw-light ms-1"><%= search.length %> </span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>
                            <hr>

                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>
                </div>
            <% }; %>
            <% if (depart == 'service')  { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                    <div class="card-body">
                        <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1> 
                        <p class="fw-bold mb-1">Categoria: <span class="fw-light ms-1"><%= search.category %></span> </p>
                        <p class="fw-bold mb-1">Sub-Categoria: <span class="fw-light ms-1"><%= search.sub_category %></span> </p>
                        <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>
                        <hr>
                        
                        <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                        <div class="mb-1" id="showContent">
                        </div>
                                                     
                        <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                        <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                        
                   </div>
                </div>
            <% }; %>
            <% if (depart == 'raffle') { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                    <div class="card-body">
                         <h1 class="fw-bold my-1" style="font-size: 28px;"><%= search.title %> </h1>
                         <p class="fw-bold my-1">Categoria : <span class="fw-light ms-1"><%= search.category %></span> </p>
                         <p class="fw-bold my-1">Politica : <span class="fw-light ms-1"><%= search.raffleClosingPolicy %></span> </p>
                         <p class="fw-bold my-1">Tickets : <span class="fw-light ms-1"><%= search.numTickets %></span> </p>
                         
                            
                            <% if (search.raffleClosingPolicy === 'byDate'){ %>
                                <% let date = new Date (search.dateEnd) %>
                                <% let dia = date.getDate(); %> <% let mes = date.getMonth() + 1; %> <% let anio = date.getFullYear(); %>
                                <% let hora = date.getHours(); %> <% let minu = date.getMinutes(); %>
                                <% let fechaCelebracion; %>
                                <% if (minu <= 9){ %>
                                    <% fechaCelebracion = `${dia}-${mes}-${anio} ${hora}:0${minu}` %>
                                <% } else { %>
                                    <% fechaCelebracion = `${dia}-${mes}-${anio} ${hora}:${minu}` %>
                                <% } %>
                                
                                <p class="fw-bold my-1">Fecha Celebración : <span class="fw-light ms-1"><%= fechaCelebracion %></span> </p>
                            <% } else { %>
                                <p class="fw-bold my-1">Fecha Celebración : <span class="fw-light ms-1">Hasta agotarse todos los Tickets.</span> </p>
                            <% } %>

                         <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>   
                         
                         <hr>

                         <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                         <div class="mb-1" id="showContent">
                         </div>
                                                      
                         <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                         <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                         
                    </div>
                </div>
            <% }; %>    
            <% if (depart == 'auctions')  { %>
                <div class="card py-2 px-1" style="max-height: 80vh; overflow-y: auto;">
                       <div class="card-body">
                            <input type="hidden" value="<%= search._id %>"  id="idTitle"> <!-- esto lo llamo para trabajar con el cronometro -->
                            <h1 class="fw-bold" style="font-size: 28px;"><%= search.title %> </h1>
                            <p class="fw-bold mb-1">Categoria : <span class="fw-light"><%= search.category %></span> </p>
                            <p class="fw-bold mb-1">Sub-Categoria : <span class="fw-light"><%= search.sub_category %></span> </p>
                            <p class="fw-bold mb-1">Anunciado en : <span class="fw-light ms-1"><%= search.country %> </span> </p>
                            <hr>
                            
                            <!-- Nota: aqui parseo la data y la guardo en un input hidden -->
                            <div class="mb-1" id="showContent">
                            </div>
                                                         
                            <input type="hidden" value="<%= search.tecnicalDescription %>" id="hiddenTecDescript">
                            <!-- con la data en el value la inyecto abajo en un script con setContent ya que es un objeto quilljs -->
                            
                       </div>
                </div>
            <% }; %>

                <!-- tarjeta de precio y anunciante -->
                <div class="card my-2 p-2">
                    <div class="card-body">

                        <span class="bg-warning px-1 py-1 rounded-2 pe-5" style="font-size: 18px; clip-path: polygon(0% 0%, 75% 0%, 82% 50%, 75% 100%, 0% 100%);">Precio: <i class="bi bi-currency-dollar"></i><%= search.price %></span> <hr>

                    <% if (user) {  %>        
                        <div class="form-check"> <input class="form-check-input" type="checkbox" value="" id="flexCheckChecked">
                            <label class="form-check-label" for="flexCheckChecked" style="user-select: none;">
                              Selecciona para Comparar
                            </label>
                        </div>
                        <p class="me-1 my-1 favoriteProduct" style="user-select: none;"> <i class="bi bi-heart me-1 linkHeart cursor-pointer"></i> Articulo como Favorito  <input type="hidden" value="<%= search.department %>"><input type="hidden" value="<%= search._id %>"> </p>
                        <p class="me-1 mt-1 mb-3 favoriteStore" style="user-select: none;"> <i class="bi bi-bookmark-check me-1 starData cursor-pointer"></i> Seguir esta Tienda  <!-- usuario que esta logeado --><input type="hidden" value="<%= user._id %>">   <!-- id del usuario del anuncio --><input type="hidden" value="<%= search.user_id %>">  </p>
                      
                    <% } else { %>
                        <div class="alert alert-light alert-dismissible fade show p-0" role="alert">
                            <strong class="me-2"> <i class="bi bi-check-circle-fill me-2"></i> Para una mejor experiencia inicia sessión <a href="/myaccount/signin">aquí.</a> </strong>
                           
                        </div>
                    <% }; %>    
                        <p> <span class="bg-dark ps-2 py-2 rounded-2 text-light" style=" padding-right: 50px;  clip-path: polygon(0% 0%, 75% 0%, 84% 50%, 75% 100%, 0% 100%);"><i class="bi bi-shop-window me-2"></i><%= search.username %></p>
                    </div>
                </div>

                <!-- tarjeta reporte Contenido Inapropiado -->
                <% if (user) {  %>
                    <% if (user.username !== search.username) { %>    
                    <div class="card my-2 p-2 alert-danger">
                        <div class="card-body">

                            <p class="d-flex justify-content-between fw-bold mb-1">
                            
                                <a href="/terms" class=" text-decoration-none" style="color: #842029;">Reporte el problema <i class="bi bi-info-circle ms-2"></i></a>
                            
                                <a data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample"> <i class="bi bi-chevron-down" style="color: #842029;"></i> </a>
                            
                            </p>
                        
                            
                            <div class="collapse" id="collapseExample">
                                <p class="mb-2">¿Cree que este contenido no es apto para la comunidad? <span class="ps-1 btnReportar text-decoration-underline fst-italic fw-bold" style="cursor: pointer;">Reporte aquí</span></p>

                                <form action="/admin/report" method="post" id="formReportar" class="close">

                                    <div class="form-group">
                                        <input type="hidden" value="<%= user.username %>" name="visitante"> <!-- aqui el user visitante -->
                                        <input type="hidden" value="<%= search.username %>" name="anunciante"> <!-- aqui el user anunciante -->
                                        <input type="hidden" value="<%= search.user_id %>" name="id_anunciante"> <!-- aqui el id del anunciante -->
                                        <input type="hidden" value="<%= search.department %>" name="depart"> <!-- aqui el department -->
                                        <input type="hidden" value="<%= search.title %>" name="title"> <!-- aqui el title -->
                                        <input type="hidden" value="<%= search._id %>" name="id_title"> <!-- aqui el id del articulo -->
                                        <!-- <input type="text" class="form-control my-1" name="denuncia" placeholder="Resuma su denuncia" maxlength="100" required> -->
                                        <textarea class="my-1 form-control" name="denuncia" placeholder="Resuma su denuncia" cols="30" rows="2" maxlength="120" required></textarea>
                                        <button type="submit" class="form-control btn btn-danger my-2"> Reportar anuncio</button>
                                    </div>
                                    
                                </form>
                            </div>    
                            
                        </div>
                    </div>
                    <% }; %>
                <% }; %>
            </div>  
             

            <div class="col-lg-6 d-flex flex-column p-2" style="background-color: rgb(233, 236, 239)">

                   

                        <div class="containerMiniaturas d-flex flex-row mb-2" style="overflow-x: auto;">
                            
                            <% if (search.video.length !==0) { %>
                                    
                                <div class="containMiniImg me-1 rounded-1" style="background-color: rgba(0, 0, 0, 0.9);">

                                    <div class="videoMini blueMask d-flex justify-content-center align-items-center" style="object-fit: cover; background-position: center; background-size: auto; width: 60px; height: 60px;">
                                        <i class="bi bi-play-btn" style="color: rgb(204, 204, 204); font-size: 1.3rem"></i>
                                    </div>         
                                
                                </div>

                            <%};%>

                            <% search.images.forEach((ele)=> { %>
                                                        
                            <div class="containMiniImg me-1">
                                <img src="<%= ele.url%>" class="imgMini border rounded-1" style="object-fit: cover; background-position: center; background-size: auto; width: 60px; height: 60px; cursor: pointer;" >
                            </div>         
                            
                            <% }); %>

                        </div>
                       
                        
                        <div class="containerViewImg border">
                            <img src="<%= search.images[0].url %>" id="mainImage" class="imgView rounded-1 zoomImage" style="object-fit: cover; width: 100%;">                               
                        </div>                         


                        <% if (search.video.length !==0) { %>
                        <div class="containerViewVideo closed border d-flex justify-content-center rounded-1" style="width: 100%; max-height: 85vh">
                            <video src="<%= search.video[0].url %>" controls class="videoView rounded-1" style="object-fit: cover; width: 100%"></video>
                        </div>  
                      

                        <% }; %>
                    
            </div>
       
            
            <div class="col-lg-3 p-2" style="background-color: rgb(233, 236, 239);">
                    
                    <% if (user) {  %>

                        <% if (depart == 'auctions') { %>
                            <% if (search.sound.length !==0) {%>
                            <div class="card p-1 alert alert-success my-1">
                                <div class="card-body p-0">

                                    <p class="mx-2 my-2"><i class="bi bi-cloud-check-fill me-2"></i><b>Streaming</b> Disponible. </p> 
                                    <audio src="<%= search.sound[0].url %>" controls style="width: 100%;"></audio>
                                     
                                </div> 
                            </div>
                            <% }; %>    
                        <% }; %>

                    <% } else { %>
                        <% if (depart == 'auctions') { %>
                            <% if (search.sound.length !==0) {%>
                            <div class="card p-1 alert alert-success my-1">
                                <div class="card-body p-0">

                                    <p class="mx-2 my-2"><i class="bi bi-cloud-check-fill me-2"></i><b>Streaming</b> Disponible. </p> 
                                    <audio src="<%= search.sound[0].url %>" controls style="width: 100%;"></audio>
                                     
                                </div> 
                            </div>
                            <% }; %>     
                        <% }; %>    
                    <% }; %>    
                    

                    <div class="card secondCard p-0">
                        <div class="card-body">
                            <% if (user) {  %>
                                <% if (depart == 'items' || depart == 'arts') { %>
                                                                         
                                    <div class="alert alert-light" style="background-color: #E9ECEF;">
                                        <span> <i class="bi bi-exclamation-triangle-fill me-1"></i> Solo de a comprar si esta seguro de adquirir este producto.</span>
                                    </div>
                                    <hr>
                                    <!-- <p>Modo compra directa sin seguro</p> -->

                                <% }; %>
                                <% if (depart == 'raffle') { %>
                                    <div class="alert alert-light" style="background-color: #E9ECEF;">
                                        <span> <i class="bi bi-exclamation-triangle-fill me-1"></i> ¿Con suerte? Entre y busque un Ticket Ganador.</span>
                                    </div>
                                <% }; %>
                                <% if (depart == 'airplanes' || depart == 'automotive' || depart == 'realstate' || depart == 'nautical' || depart == 'service') { %>    
                                    <div class="alert alert-light" style="background-color: #E9ECEF;">
                                        <span> <i class="bi bi-exclamation-triangle-fill me-1"></i> Solo de a comprar si esta seguro de adquirir este producto.</span>
                                    </div>    
                                <% }; %>
                               
                           
                                <!-- primera condicion validar el departamento del anuncio -->
                                <% if (depart == 'items' || depart == 'arts') { %>
                                    <!-- segunda condicion que el usuario no pueda autocomprarse -->
                                    <% if (user.username !== search.username) { %>
                                        <!-- tercera condicion que el articulo no este pausado -->
                                        <% if (search.paused !== true && search.soldOut !== true   ) { %>
                                            <!-- en este punto el usuario es diferente al anunciante y el anuncio no esta pausado y no esta agotado -->
                                                                                 
                                            <section class="containerBuy_btn">
                                                
                                                <div class="contentPubliRating">
                                                    <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                    <div class="meta">
                                                        Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> | Vendidos <%= search.sales %>
                                                    </div>
                                                    <div class="extra text-dark">
                                                        Rating: 4.4
                                                        <!-- <div class="ui star rating" data-rating="4.4" data-max-rating="5" data-readonly="true"></div>  -->
                                                         <div class="contentStart" style="color: gold">
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-half"></i>

                                                            <a href=""> <span class="mx-2 text-dark">|</span> 2 Calificación</a>
                                                         </div>    
                                                        
                                                        
                                                    </div> 
                                                </div>
                                                
                                                <form action="/buysell/direct" method="post" id="form_buysell">

                                                    <p class="m-0">Disponible : <%= search.count %> </p>

                                                    <div class="input-group my-2">
                                                        <!-- la cantidad que quiere comprar el cliente  -->
                                                        <div class="input-group-text">Cantidad :</div> 
                                                        <input class="form-control" name="countRequest" id="countRequest"  type="number" style="font-size: 20px;" value="1" max="<%= search.count %>" min="1">
                                                    </div>    

                                                    <!-- vendedor, comprador, depart, idProduct, countRequest, unitPrice -->
                                                 
                                                    <input type="hidden" name="comprador" value="<%= user._id %>"> <!-- aqui el id del visitante -->
                                                    <input type="hidden" name="vendedor" value="<%= search.user_id %>"> <!-- aqui el id del anunciante -->
                                                    <input type="hidden" name="title" value="<%= search.title %>"> <!-- aqui el title -->
                                                    <input type="hidden" name="depart" value="<%= search.department %>"> <!-- aqui departamento -->
                                                    <input type="hidden" name="idProduct" value="<%= search._id %>"> <!-- aqui el id del articulo -->
                                                    <input type="hidden" name="delivery" value="<%= search.delivery %>"> <!-- aqui el estado de delivery -->
                                                    <input type="hidden" name="unitPrice" class="unitPrice" value="<%= search.price %>"> <!-- aqui el precio --> 
                                                   
                                                    <input type="hidden" class="available" value="<%= search.count %>">
                                                    
                                                    <p class="m-0 d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                        <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                            <i class="bi bi-info-circle text-primary ms-2"></i>
                                                        </button>   
                                                    </p>
                                                    <p style="font-size: 18px; font-weight: bolder;">Total<span class="ms-3 totalPay">$<%= search.price %><!-- valor dinamico  --> </span> </p>
                                                    <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNBuy"><div>¡Compra ahora! </div></button>
                                                    <button class="buttonProcessingBuy rounded-2 btn btn-primary close"  id="newBTNBuySpinning" style="color: #FEDE05;" disabled>
                                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                                        Processing ... 
                                                    </button>
                                                

                                                </form>

                                            </section>
                                            
                                        <% }  else { %>

                                            <section class="containerBuy_btn">
                                                
                                                <div class="contentPubliRating">
                                                    <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                    <div class="meta">
                                                        Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> | Vendidos <%= search.sales %>
                                                    </div>
                                                    <div class="extra text-dark">
                                                        Rating: 4.4
                                                        <!-- <div class="ui star rating" data-rating="4.4" data-max-rating="5" data-readonly="true"></div>  -->
                                                         <div class="contentStart" style="color: gold">
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-half"></i>

                                                            <a href=""> <span class="mx-2 text-dark">|</span> 2 Calificación</a>
                                                         </div>    
                                                        
                                                        
                                                    </div> 
                                                </div>

                                                <p class="m-0">Disponible : <%= search.count %> </p>

                                                <div class="input-group my-2">
                                                    <!-- la cantidad que quiere comprar el cliente  -->
                                                    <div class="input-group-text">Cantidad :</div> 
                                                    <input class="form-control" id="countRequest" type="number" style="font-size: 20px;" value="1" max="<%= search.count %>" min="1">
                                                </div>    
                                                <input type="hidden" class="available" value="<%= search.count %>">
                                                <input type="hidden" class="unitPrice" value="<%= search.price %>">
                                                <p class="m-0 d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                    <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                        <i class="bi bi-info-circle text-primary ms-2"></i>
                                                    </button>   
                                                </p>
                                                <p style="font-size: 18px; font-weight: bolder;">Total<span class="ms-3 totalPay">$<%= search.price %><!-- valor dinamico  --> </span> </p>
                                                <!-- <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNBuy"><div>¡Compra ahora! </div></button> -->
                                                <button class="buttonPause rounded-2 btn" disabled>
                                                     PAUSADO/AGOTADO
                                                </button>

                                            </section>    
                                        
                                         <% }; %>
                                    
                                    <% } else { %>
                                            <!-- este es un usuario que esta viendo su mismo anuncio no puede comprarse asi mismo -->
                                            <section class="containerBuy_btn">
                                                
                                                <div class="contentPubliRating">
                                                    <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                    <div class="meta">
                                                        Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> | Vendidos <%= search.sales %>
                                                    </div>
                                                    <div class="extra text-dark">
                                                        Rating: 4.4
                                                        <!-- <div class="ui star rating" data-rating="4.4" data-max-rating="5" data-readonly="true"></div>  -->
                                                         <div class="contentStart" style="color: gold">
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-half"></i>

                                                            <a href=""> <span class="mx-2 text-dark">|</span> 2 Calificación</a>
                                                         </div>    
                                                        
                                                        
                                                    </div> 
                                                </div>

                                                <p class="m-0">Disponible : <%= search.count %> </p>

                                                <div class="input-group my-2">
                                                    <!-- la cantidad que quiere comprar el cliente  -->
                                                    <div class="input-group-text">Cantidad :</div> 
                                                    <input class="form-control" id="countRequest" type="number" style="font-size: 20px;" value="1" max="<%= search.count %>" min="1">
                                                </div>    

                                                <input type="hidden" class="available" value="<%= search.count %>">
                                                <input type="hidden" class="unitPrice" value="<%= search.price %>">
                                                <p class="m-0 d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                    <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                        <i class="bi bi-info-circle text-primary ms-2"></i>
                                                    </button>   
                                                </p>
                                                <p style="font-size: 18px; font-weight: bolder;">Total<span class="ms-3 totalPay">$<%= search.price %><!-- valor dinamico  --> </span> </p>
                                                <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNBuy" disabled><div> ¡Compra ahora! </div></button>
                                               <!--  <button class="buttonProcessingBuy rounded-2 btn btn-primary close"  id="newBTNBuySpinning" style="color: #FEDE05;" disabled>
                                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                                     Processing ... 
                                                </button> -->
                                            </section>

                                    <% }; %>
                                <% }; %>
                                <!-- primera condicion validar el departamento del anuncio -->
                                <% if (depart == 'raffle' ) { %>
                                <!-- segunda condicion que el articulo no este pausado-->
                                    
                                     <!-- puede entrar tanto el anfitrion como los demas participantes -->   
                                    <% if (search.paused !== true  ) { %>
                                        <a href="/raffleModule/<%= search._id %>" class="form-control btn btn-primary mt-2">Participar</a>
                                    <% } else { %>
                                        <button type="button" class="dataBuy btn btn-secondary mt-2 text-light form-control" disabled>
                                               Paused Raffle 
                                        </button>
                                     <% }; %>                                                    
                                 
                                 
                                <% }; %>        
                                <% if (depart == 'airplanes' || depart == 'automotive' || depart == 'realstate' || depart == 'nautical' || depart == 'service') { %>        
                                    <!-- segunda condicion que el usuario no pueda autocontactarse -->
                                    <% if (user.username !== search.username) { %>
                                        <!-- tercera condicion que el articulo no este pausado -->
                                        <% if (search.paused !== true  ) { %>

                                            <section class="containerBuy_btn">
                                                
                                                <div class="contentPubliRating">

                                                    <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                    <div class="meta">
                                                        Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> 
                                                    </div>
                            
                                                </div>
                                                
                                                <form action="/buysell/direct" method="post" id="form_contact"> 

                                                    <!-- vendedor, comprador, depart, idProduct, unitPrice -->
                                                 
                                                    <input type="hidden" name="comprador" value="<%= user._id %>"> <!-- aqui el id del visitante -->
                                                    <input type="hidden" name="vendedor" value="<%= search.user_id %>"> <!-- aqui el id del anunciante -->
                                                    <input type="hidden" name="title" value="<%= search.title %>"> <!-- aqui el title -->
                                                    <input type="hidden" name="depart" value="<%= search.department %>"> <!-- aqui departamento -->
                                                    <input type="hidden" name="idProduct" value="<%= search._id %>"> <!-- aqui el id del articulo -->
                                                    <input type="hidden" name="unitPrice" class="unitPrice" value="<%= search.price %>"> <!-- aqui el precio --> 
                                                   
                                                    
                                                    <p class="d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                        <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                            <i class="bi bi-info-circle text-primary ms-2"></i>
                                                        </button>   
                                                    </p>
                                                    
                                                    <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNContact"><div>¡Contactar ahora! </div> </button>
                                                    <button class="buttonProcessingBuy rounded-2 btn btn-primary close"  id="newBTNContactSpinning" style="color: #FEDE05;" disabled>
                                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                                        Processing ... 
                                                    </button>
                                                

                                                </form>

                                            </section>

                                        <% } else { %>

                                            <button type="button" class="dataBuy btn btn-secondary mt-2 text-light form-control" disabled>
                                                Paused Article 
                                            </button>   

                                        <% }; %>
                                    
                                    <% } else { %>
                                            <section class="containerBuy_btn">
                                                
                                                    <div class="contentPubliRating">

                                                        <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                        <div class="meta">
                                                            Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> 
                                                        </div>
                                
                                                    </div>
                                                
                                                    <!-- este contenedor muestra el boton disabled porque el anuncio es del usuario -->
                                                                                                     
                                                    <p class="d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                        <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                            <i class="bi bi-info-circle text-primary ms-2"></i>
                                                        </button>   
                                                    </p>
                                                    
                                                    <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNContact" disabled><div> ¡Contactar ahora! </div></button>                                                

                                            </section>
  
                                    <% }; %>
                                <% }; %>
                                <% if (depart == 'auctions') { %>
                                    
                                        <!-- tercera condicion que el articulo no este pausado -->
                                        <% if (search.paused !== true  ) { %>

                                            <% if (search.active === false){ %>
                                                <span>Fecha pautada para esta Subasta</span> <br> <hr>
                                                <div class="d-flex justify-content-around border mt-2 text-dark form-control shadow-sm">
                                                    <span><%= search.auctionDate %></span>  <span><i class="bi bi-stopwatch-fill"></i> (<%= search.biddingTime %> Hrs.)</span>
                                                </div>
                                            <% } else { %>
                                                <% if (user.username !== search.username) { %>
                                                    <!-- El usuario es diferente al Anfitrion puede participar en la subasta -->
                                                    <div class="card bid p-0">
                                                        <div class="card-body p-2">
                                                            <div class="card-header form-group mb-1 d-flex justify-content-between px-1" style="border: none;" >
                                                                <p class="m-0">Sala Iniciada</p>
                                                                <span id="dateInicio" style="font-size: 15px;"></span>
                                                            </div>
                                                            <div class="form-group mb-1 d-flex justify-content-between px-1" style="border: none;" >
                                                                <p class="m-0">Tiempo:</p>
                                                                <span id="bidding" style="font-size: 15px;"></span>
                                                            </div>
                                                            <div class="form-group d-flex justify-content-between px-1">
                                                                <p class="m-0">Finaliza: </p>
                                                                <span id="auctionClose"></span>
                                                            </div>
                                                            <div class="form-group d-flex justify-content-between px-1">
                                                                <p class="m-0">Queda: </p>
                                                                <span id="leftTime"></span>
                                                            </div>
                                                            <div class="form-grup px-1 my-1">
                                                                <p class="m-0">Inicia en: $<span><%= search.price %></span></p>
                                                            </div>
                                                              
                                                            <div class="form-group d-flex justify-content-between">
                                                                <input type="hidden" class="bidUser" value="<%= user.username %>">
                                                                <input type="hidden" class="bidDepartment" value="<%= search.department %>">
                                                                <input type="hidden" class="bidIDProduct" value="<%= search._id %>">
                                                                <input type="number" class="form-control bidAmount" style="width: 56%;">
                                                                <button class="btn btn-success btnBID"  style="width: 40%;">Bid</button>
                                                                <button class="btn btn-success btnBID_Disabled close" style="width: 40%;" disabled>Bid <i class="bi bi-lock ms-1"></i></button> 

                                                            </div>
                                                            <div class="contMSJ mt-2">
                                                                <!-- alertas dinamicos -->                                                              
                                                            </div>
                                                            <hr>
                                                            <div class="containerBid border" style="max-height: 40vh; overflow-y: auto;">
                                                               
                                                                <table class="table p-0 tableBids">
                                                                    <!-- datos creados dinamicamente -->
                                                                </table>    

                                                            </div>
                                                                                       
                                                            <!-- <span class="alert alert-success p-0">tonygamed  54</span> <br> -->
                                                        </div>
                                                    </div>
                                                <% } else  { %>
                                                    <!-- El usuario Anfitrion No puede participar en la subasta solo ver -->    
                                                    <div class="card bid p-0">
                                                        <div class="card-body p-2">
                                                                <div class="card-header form-group mb-1 d-flex justify-content-between px-1" style="border: none;" >
                                                                    <p class="m-0">Sala Iniciada</p>
                                                                    <span id="dateInicio" style="font-size: 15px;"></span>
                                                                </div>
                                                                <div class="form-group mb-1 d-flex justify-content-between px-1" style="border: none;" >
                                                                    <p class="m-0">Tiempo:</p>
                                                                    <span id="bidding" style="font-size: 15px;"></span>
                                                                </div>
                                                                <div class="form-group d-flex justify-content-between px-1">
                                                                    <p class="m-0">Finaliza: </p>
                                                                    <span id="auctionClose"></span>
                                                                </div>
                                                                <div class="form-group d-flex justify-content-between px-1">
                                                                    <p class="m-0">Queda: </p>
                                                                    <span id="leftTime"></span>
                                                                </div>
                                                                <div class="form-grup px-1 my-1">
                                                                    <p class="m-0">Inicia en: $<span><%= search.price %></span></p>
                                                                </div>
                                                                  
                                                                <div class="form-group d-flex justify-content-between">
                                                                    <input type="number" class="form-control" style="width: 56%;" disabled>
                                                                    <button class="btn btn-secondary" class="form-control" style="width: 40%;">Bid</button>
                                                                </div>
                                                                <div class="contMSJOwn mt-2">
                                                                    <!-- alertas dinamicos -->                                                              
                                                                </div>
                                                                <hr>
                                                                <div class="containetBid border" style="max-height: 40vh; overflow-y: auto;">
                                                                    <table class="table p-0 tableBidsOwn">
                                                                       <!-- datos creados dinamicamente -->    
                                                                    </table>        
                                                                </div>    
                                                        </div>
                                                    </div>
                                                <% }; %>

                                            <% }; %>    
                                            
                                        <% }  else { %>
                                            <span>¡Esta Subasta esta pausada!</span> <br> <hr>
                                            <button type="button" class="btn btn-secondary mt-2 text-light form-control" disabled>
                                                Paused Auction 
                                            </button>
                                        <% }; %>                                        
                                  
                                <% }; %>            
                            <% } else { %>
                            <!-- esto es si no hay un usuario logeado -->
                                <% if (depart == 'items' || depart == 'arts') { %>

                                    <div class="alert alert-light" style="background-color: #E9ECEF;">
                                        <span> <i class="bi bi-exclamation-triangle-fill me-1"></i> Solo de a comprar si esta seguro de adquirir este producto.</span>
                                    </div>
                                    <hr>

                                    <!-- si existe un usuario desconocido y el depart es un itens o arte tendrá la opcion de ver el precio y calcular pero no puede comprar -->
                                   
                                            <section class="containerBuy_btn">
                                                
                                                <div class="contentPubliRating">
                                                    <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                    <div class="meta">
                                                        Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> | Vendidos <%= search.sales %>
                                                    </div>
                                                    <div class="extra text-dark">
                                                        Rating: 4.4
                                                        <!-- <div class="ui star rating" data-rating="4.4" data-max-rating="5" data-readonly="true"></div>  -->
                                                         <div class="contentStart" style="color: gold">
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-fill"></i>
                                                            <i class="bi bi-star-half"></i>

                                                            <a href=""> <span class="mx-2 text-dark">|</span> 2 Calificación</a>
                                                         </div>    
                                                        
                                                        
                                                    </div> 
                                                </div>
                                                
                                                <form action="/buysell/direct" method="post" id="form_buysell">

                                                    <p class="m-0">Disponible : <%= search.count %> </p>

                                                    <div class="input-group my-2">
                                                        <!-- la cantidad que quiere comprar el cliente  -->
                                                        <div class="input-group-text">Cantidad :</div> 
                                                        <input class="form-control" name="countRequest" id="countRequest"  type="number" style="font-size: 20px;" value="1" max="<%= search.count %>" min="1">
                                                    </div>    

                                                    <!-- vendedor, comprador, depart, idProduct, countRequest, unitPrice -->

                                                  
                                                    <input type="hidden" class="unitPrice" value="<%= search.price %>">
                                                    <input type="hidden" class="available" value="<%= search.count %>">
                                                    
                                                    <p class="m-0 d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                        <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                            <i class="bi bi-info-circle text-primary ms-2"></i>
                                                        </button>   
                                                    </p>
                                                    <p style="font-size: 18px; font-weight: bolder;">Total<span class="ms-3 totalPay">$<%= search.price %><!-- valor dinamico  --> </span> </p>
                                                    <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNBuy" disabled ><div>¡Compra ahora! </div></button>
                                                                                               

                                                </form>

                                            </section>

                                <% }; %>
                                <% if (depart == 'raffle') { %>
                                    <div class="alert alert-danger"><i class="bi bi-exclamation-triangle me-1"></i> Debe estar Logeado para participar en Sorteos.</div> <hr>
                                    <button type="button" class="btn btn-secondary mt-2 text-light form-control">
                                        Participar
                                    </button>
                                <% }; %>
                                <% if (depart == 'airplanes' || depart == 'automotive' || depart == 'realstate' || depart == 'nautical' || depart == 'service') { %>    
                                    <div class="alert alert-light" style="background-color: #E9ECEF;">
                                        <span> <i class="bi bi-exclamation-triangle-fill me-1"></i> "Para comunicar con este anunciante, ¡simplemente inicia sesión y dale a contactar!.</span>
                                    </div>
                                    <hr>
                                    <section class="containerBuy_btn">
                                        
                                            <div class="contentPubliRating">

                                                <div class="title fw-bold mb-2" style="font-size: 20px;"><%= search.title %></div>
                                                <div class="meta">
                                                    Publicado  <%= TDay %>-<%= TMonth %>-<%= TYear %> 
                                                </div>
                        
                                            </div>
                                        
                                            <!-- este contenedor muestra el boton disabled porque el anuncio es del usuario -->
                                                                                                
                                            <p class="d-flex align-items-start" style="font-size: 24px; font-weight: bolder;">Precio <span class="ms-3"> $<%= search.price %></span>
                                                <button class="popoverCarBuy" type="button" style="background-color: transparent; border: none; font-size: 16px;" data-bs-toggle="popover"  data-bs-placement="top" data-bs-content="Los precios en blissenet.com están en moneda local o en dólares. Si están en dólares, acuerda con el vendedor el pago en tu moneda local.">                                                               
                                                    <i class="bi bi-info-circle text-primary ms-2"></i>
                                                </button>   
                                            </p>
                                            
                                            <button data-hover="click me!" class="buttonSlice rounded-2 btn btn-primary"  id="newBTNContact" disabled><div> ¡Contactar ahora! </div></button>                                                

                                    </section>
                                <% }; %>
                                <% if (depart == 'auctions') { %>
                                    <!-- segunda condicion que el articulo no este pausado -->
                                    <% if (search.paused !== true  ) { %>
                                        <% if (search.active === false){ %>
                                            <span>Fecha pautada para esta Subasta</span> <br> <hr>
                                            <p  class="d-flex justify-content-around border mt-2 text-dark form-control shadow-sm">
                                               <span><%= search.auctionDate %> </span> <span><i class="bi bi-stopwatch-fill"></i> (<%= search.biddingTime %>Hrs.)</span>
                                            </p>
                                        <% } else { %>
                                            <!-- El usuario No logeado No puede participar en la subasta solo ver -->    
                                            <div class="card bid p-0">
                                                <div class="card-body p-2">
                                                        <div class="card-header form-group mb-1 d-flex justify-content-between px-1" style="border: none;" >
                                                            <p class="m-0">Sala Iniciada</p>
                                                            <span id="dateInicio" style="font-size: 15px;"></span>
                                                        </div>
                                                        <div class="form-group mb-1 d-flex justify-content-between px-1" style="border: none;" >
                                                            <p class="m-0">Tiempo:</p>
                                                            <span id="bidding" style="font-size: 15px;"></span>
                                                        </div>
                                                        <div class="form-group d-flex justify-content-between px-1">
                                                            <p class="m-0">Finaliza: </p>
                                                            <span id="auctionClose"></span>
                                                        </div>
                                                        <div class="form-group d-flex justify-content-between px-1">
                                                            <p class="m-0">Queda: </p>
                                                            <span id="leftTime"></span>
                                                        </div>
                                                        <div class="form-grup px-1 my-1">
                                                            <p class="m-0">Inicia en: $<span><%= search.price %></span></p>
                                                        </div>
                                                          
                                                        <div class="form-group d-flex justify-content-between">
                                                            <input type="number" class="form-control" style="width: 56%;" disabled>
                                                            <button class="btn btn-secondary" class="form-control" style="width: 40%;">Bid</button>
                                                        </div>
                                                        <hr>
                                                        
                                                        <table class="table p-0 tableBidsNoLogin">
                                                            <!-- datos creados dinamicamente -->    
                                                         </table>  

                                                </div>
                                            </div>
                                        <% }; %>    

                                    <% }  else { %>
                                        <button type="button" class="btn btn-secondary mt-2 text-light form-control" disabled>
                                            Paused Auction 
                                        </button>
                                    <% }; %>   
                                <% }; %>
                            <% } %>     
                                                                

                        </div>
                    </div>

                                        

                    <!-- Modal de subasta -->
                    <div class="modal fade" id="staticBid" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBidLabel" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                <h5 class="modal-title" id="staticBidLabel">Sala de Subasta</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                El acto de participar y pujar es un compromiso que acarrea responsabilidad de ejecutar el pago. Si este es ganado, de lo contrario su calificación se vera afectada.  
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                    <% if (user) { %>
                                        <% if (usernameSell){ %>
                                            <% if  (search) { %>
                                            <a href="/buysell-one/direct/<%= user.username %>/<%= usernameSell %>/<%= search.department %>/<%= search._id %>">
                                                <button type="button" class="btn btn-primary buyDirect" data-bs-dismiss="modal">De acuerdo</button>
                                            </a>
                                            <% }; %>    
                                        <% }; %>
                                    <% }; %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal codigo QR -->
                    <div class="modal fade" id="staticQR" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticQRLabel" aria-hidden="true">
                        <div class="modal-dialog border border-secondary p-2 rounded-3" style="background-color: rgb(0, 0, 0, 0.3);">
                            <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="staticComprarLabel">Codigo QR</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body d-flex justify-content-center align-items-center py-5" style="background: linear-gradient(90deg, rgba(146,0,255,1) 0%, rgba(102,0,255,1) 100%);">
                                    <div class="contentQR d-flex flex-column my-2" style="position: relative; max-width: 320px;">
                                      <canvas id="qr-canvas" class="rounded-3 mt-2 p-3" style="background-color: white;">  
                                         <!-- Aqui va el codigo QR dinamico -->
                                      </canvas>
                                      <img src="/img/logoSuperiorQR.png" class="shadow" alt="" style="position: absolute; top: -33px; right: 87px; width: 60px;"> 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card p-2 mt-2">
                        <div class="card-header">
                            Datos de Tienda
                        </div>
                        <div class="card-body d-flex flex-column">
                            <% if (depart == 'items' || depart == 'arts' || depart == 'auctions' || depart == 'raffle') { %>
                                <div class="contentScoreTrust d-flex justify-content-between">
                                    <div class="contenTiempo d-flex flex-column justify-content-center pe-3" style="border-right: 2px solid  #cbd1d6;">
                                        <p>Fiabilidad</p>
                                        <span class="trustLevel d-flex justify-content-center"></span>
                                    </div>
                                    <div class="contenFiabilidad d-flex flex-column justify-content-center pe-3" style="border-right: 2px solid  #cbd1d6;">
                                        <p>Ventas</p>
                                        <span class="scoreLevel d-flex justify-content-center"></span>
                                    </div>
                                    <div class="contenVentas d-flex flex-column justify-content-center  pe-3 ">
                                        <p>Nivel</p>
                                        <span class="level d-flex justify-content-center"></span>
                                    </div>
                                </div>
                            <% } else { %>    
                                <div class="contentMessageOnlyContact">
                                    <p class="mb-1">1. Procure ser especifico con las preguntas que realiza, use palabras no ofensivas. </p>
                                    <p class="mb-1">2. Nunca es demasiado la seguridad que pueda usted aportar.</p>
                                    <p class="mb-1">3. Siempre asista acompañado(a) al lugar de reunión si el caso lo amerita.</p>
                                </div>
                            <% }; %>    
                                <div class="contentLinkStore my-2  py-2" style="border-top: 1px solid  #cbd1d6;" >

                                    
                                    <div class="storeCreated d-flex justify-content-between mb-1">    
                                        <p class="mb-1 boder border-dark"> Creacion de Tienda </p>
                                        <!-- <%= search.createdAt %> -->
                                       <% if (store) { %> 
                                            <% const dateProfile = new Date(store.createdAt) %>
                                            <% const dia = dateProfile.getDate() %>
                                            <% const mes = dateProfile.getMonth() +1 %>
                                            <% const anio = dateProfile.getFullYear() %>
                                            <span> <i class="bi bi-calendar2-week mx-1"></i> <%= dia %>-<%= mes %>-<%= anio %> </span>
                                       <% }; %>     
                                    </div>
                                    <!-- search es el articulo en cuestion -->
                                    <% if (search) { %>
                                    
                                        
                                        <div class="comment d-flex justify-content-between mb-1">
                                            <p class="mb-1"> Comentarios de sus clientes </p>
                                            <a href="/comments/<%= search.username%>"> Aquí</a>
                                        </div>
                                        <div class="goToStore d-flex justify-content-between my-1">
                                            <p class="mb-3 me-2">Visitar Tienda... </p>
                                            <a href="/account/<%= search.username %>" class="store"><span><%= search.username %></span> <input type="hidden" value="<%= search.username %>"></a>
                                        </div>

                                        
                                            
                                        <div class="form-group" style="position: relative; cursor: pointer;">

                                            <button class="btn btn-secondary form-control shareToggle"> Compartir este anuncio  <i class="bi bi-share ms-1"></i> </button>
                                            <!-- <span style="user-select: none;"> Compartir este anuncio  <i class="bi bi-share ms-1"></i></span>  -->
                                             
                                            <% if (depart) { %>
                                               
                                                <% if (productId) { %> 
                                                <div class="containerShare d-flex invisible border border-secondary p-3 rounded-3" style="background-color: white; position: absolute; top: -120px; right: -10px" >
                                                    <a href="https://api.whatsapp.com/send?text=https://blissenet.com/product/<%= depart %>/<%= productId %>/<%= titleURL %>" target="_blank" class="mx-2"> <img src="/img/helpWhatsapp.png" alt="" style="width: 42px; height: 42px;">   </a> 
                                                    <a href="https://t.me/share/url?url=https://blissenet.com/product/<%= depart %>/<%= productId %>/<%= titleURL %>" target="_blank" class="mx-2"> <img src="/img/helpTelegram.png" alt="" style="width: 42px; height: 42px"> </a> 
                                                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://blissenet.com/product/<%= depart %>/<%= productId %>/<%= titleURL %>" target="_blank" class="mx-2"> <img src="/img/helpFacebook.png" alt="" style="width: 42px; height: 42px">  </a>
                                                    <div class="containerBTN p-0 mx-2" style="position: relative; width: 43px !important">   
                                                        <button class="btn btn-sm btn-primary" style="border-radius: 8px; position: absolute; right: - 200px; height: 100%; width: 100%;" id="btnClicBoard"> <i class="bi bi-clipboard px-1" style="font-size: large;"></i> </button>
                                                        <button class="btn btn-sm btn-dark invisible" style="border-radius: 8px; position: absolute; right: - 200px; height: 100%; width: 100%;" id="btnClicBoardCheck"> <i class="bi bi-clipboard-check px-1" style="font-size: large;"></i>  </button>
                                                    </div>
                                                    <button class="btn btn-dark mx-2" id="btnQR" style="border-radius: 8px;"  data-bs-toggle="modal" data-bs-target="#staticQR"> <i class="bi bi-qr-code px-0" style="font-size: large;"></i> </button>
                                                </div> 
                                                <input type="hidden" id="linkToShare" value="https://blissenet.com/product/<%= depart %>/<%= productId %>/<%= titleURL %>">
                                                <% }; %>    
                                            <% }; %>
                                        </div>

                                    <% }; %>
                                </div>
                        </div>
                    </div>


                    <% if (depart == 'auctions' || depart == 'raffle') { %>
                        <% if (search) { %> 
                            <% if (user) { %>
                                <% if (user.username === search.username) { %>
                                    <!-- aqui todo lo que deben ver el autor y anfitrion -->
                                    <div class="card mt-2" style="position: relative;">

                                        <div class="card-body d-flex flex-column">
                                            <div class="title">
                                                <span>Crear notas para sus espectantes.</span>
                                            </div> 
                                            <div class="form-group">
                                                <div class="contentTextNote" style="position: relative;">
                                                    <!-- <input type="text" class="form-control my-1 pe-5" id="textMessage" maxlength="250"> viejo elemento-->
                                                    <textarea id="textMessage"  maxlength="250" class="form-control my-1 pe-5"> </textarea>
                                                    <% if (search) { %> <!-- datos ocultos importantes -->
                                                    <input type="hidden" value="<%= search._id %>" id="idHidden"><!-- este input oculto guarda el id de la subasta y que necesito como dato --> 
                                                    <input type="hidden" value="<%= search.department %>" id="departHidden"><!-- este input oculto guarda el depart que necesito como dato  -->
                                                    <% }; %>
                                                    <div class="colorSelected" id="colorSelected" style="position: absolute; right: 4px; top:9px">
                                                        <input type="hidden" id="colorAlertSelected">
                                                    </div>
                                                </div>

                                                <div class="form-group d-flex">
                                                    <div class="border cententStyle d-flex alert-secondary p-2 my-1 me-2 rounded-3">
                                                        <div class="mx-2" id="emojiSelectorIcon"><i class="bi bi-emoji-smile"></i></div>
                                                        <div class="mx-2" id="colorsSelectorIcon"><i class="bi bi-paint-bucket"></i></div>
                                                    </div>
                                                    <button class="border btn form-control my-1 d-flex justify-content-center" id="btnSubmitNote" style="color:white; background: linear-gradient(90deg, rgba(186,5,18,1) 10%, rgba(247,38,53,1) 20%, rgba(247,38,53,1) 80%, rgba(186,5,18,1) 90%);">
                                                        
                                                        <div class="contentElem">
                                                            <i class="bi bi-stickies me-3"></i>
                                                            <span>Crear nota</span>
                                                        </div>
                                                    
                                                    </button>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <!-- este es la card que contiene todos los emojis -->
                                        <div class="card closed shadow" id="emojiSelector" style="position: absolute; bottom: 0px;">
                                            <div class="card-body" style="height: 50vh; overflow-y: auto;">
                                                <div class="iconClose d-flex justify-content-end">
                                                    <i class="bi bi-x emotiClosed"></i>
                                                </div>
                                            
                                                <%- include('../partials/emojis.ejs') %>

                                            </div>
                                        </div>

                                        <!-- este es la card que contiene todos los colores disponibles -->
                                        <div class="card closed shadow" id="colorsSelector" style="position: absolute; bottom: 0px;">
                                            <div class="card-body" style="height: auto; overflow-y: auto;">
                                                <div class="iconClose d-flex justify-content-between">
                                                    <span class="ms-1 text-secondary">Colores</span>
                                                    <i class="bi bi-x colorClosed"></i>
                                                </div>
                                            
                                                <div class="contentCubes">
                                                    <div class="color-cube border border-secondary rounded-3 shadow-sm" style="background-color: white;"> <input type="hidden" value="light"> </div>
                                                    <div class="color-cube border rounded-3 shadow-sm" style="background-color: #e2e3e5"> <input type="hidden" value="dark"> </div>
                                                    <div class="color-cube border rounded-3 shadow-sm" style="background-color: #cfe2ff"> <input type="hidden" value="primary"> </div>
                                                    <div class="color-cube border rounded-3 shadow-sm" style="background-color: #d1e7dd"> <input type="hidden" value="success"> </div>
                                                    <div class="color-cube border rounded-3 shadow-sm" style="background-color: #cff4fc"> <input type="hidden" value="info"> </div>
                                                    <div class="color-cube border rounded-3 shadow-sm" style="background-color: #fff3cd"> <input type="hidden" value="warning"> </div>
                                                    <div class="color-cube border rounded-3 shadow-sm" style="background-color: #f8d7da"> <input type="hidden" value="danger"> </div>
                                                </div>
                                                

                                            </div>
                                        </div>
                                
                                    </div>
                                    <div class="showNotes" style="max-height: 30vh; overflow-y: auto;">

                                        <!-- las notas se crean de forma dinamica -->      

                                    </div>
                                <% } else { %>
                                    <div class="card mt-2" style="position: relative;">

                                        <div class="card-body d-flex flex-column">
                                            <div class="title">
                                                <span><i class="bi bi-stickies me-2"></i> Notas publicadas por el Anfitrión. </span>
                                            </div> 
                                            <% if (search) { %> <!-- datos ocultos importantes -->
                                                <input type="hidden" value="<%= search._id %>" id="idHidden"><!-- este input oculto guarda el id de la subasta y que necesito como dato --> 
                                                <input type="hidden" value="<%= search.department %>" id="departHidden"><!-- este input oculto guarda el depart que necesito como dato  -->
                                            <% }; %>
                                        
                                        </div>
                                        
                                    </div>    
                                    <div class="showNotesSpectadores" style="max-height: 30vh; overflow-y: auto;">

                                        <!-- las notas se crean de forma dinamica -->      

                                    </div>
                                <% }; %>

                            <% } else { %>
                                <div class="card mt-2" style="position: relative;">

                                    <div class="card-body d-flex flex-column">
                                        <div class="title">
                                            <span><i class="bi bi-stickies me-2"></i> Notas publicadas por el Anfitrión. </span>
                                        </div> 
                                        <% if (search) { %> <!-- datos ocultos importantes -->
                                            <input type="hidden" value="<%= search._id %>" id="idHidden"><!-- este input oculto guarda el id de la subasta y que necesito como dato --> 
                                            <input type="hidden" value="<%= search.department %>" id="departHidden"><!-- este input oculto guarda el depart que necesito como dato  -->
                                        <% }; %>
                                    
                                    </div>
                                    
                                </div>    
                                <div class="showNotesSpectadores" style="max-height: 30vh; overflow-y: auto;">

                                    <!-- las notas se crean de forma dinamica -->      

                                </div>
                            <% }; %>    
                                
                        <% }; %>        
                    <% }; %>


            </div>

        <% }; %>   <!-- ::::Aqui cierro el search:::: -->   
    </div>
    <div class="row m-0" style="background-color: rgb(233, 236, 239, 0.1); width: 100%;">
        <div class="col-lg-12 p-2">
            <div class="contenExt rounded-3 themaTextLight">
                <div class="contenInt">
                    

                    <div class="my-1 p-2">
                        <div class="d-flex shadow justify-content-between p-2 rounded-1 border">
                            
                            <% if (user) {  %>

                                <div class="containerMakeQuestion me-1" style="width: 100%; ">

                                   <% if (search) { %> 
                                        <% if (user.username !== search.username) { %>
                                        <h6 class="text-decoration-underline mb-2">Hacer una pregunta al anunciante.</h6>
                                        <div class="form-group">
                                            <!-- <input type="text" class="form-control" name="questions" id="questions"  placeholder="Escribe aqui su pregunta" style="width: 100%;">     -->
                                            <textarea class="form-control" name="questions" id="questions" rows="2" placeholder="Escribe aqui su pregunta"></textarea>
                                        </div>
                                        <div class="form-group mt-3">
                                            <input type="button" class="form-control btn btn-primary" id="btnSenMessage" value="Enviar Pregunta" style="width: 100%;">
                                        </div>
                                        <% } else { %>
                                        <h6 class="text-decoration-underline mb-2">Hacer una pregunta al anunciante.</h6>
                                        <div class="form-group">
                                            <!--  <input type="text" class="form-control" name="questions" id="questions"  placeholder="Escribe aqui su pregunta" style="width: 100%;" disabled>     -->
                                             <textarea class="form-control" name="questions" id="questions" rows="2" placeholder="Escribe aqui su pregunta" disabled></textarea>
                                        </div>
                                        
                                        <div class="form-group mt-3">
                                             <input type="button" class="form-control btn btn-primary" value="Enviar Pregunta" style="width: 100%;" disabled>
                                        </div>
                                        <% }; %>
                                   <% }; %>

                                </div>

                                    
                            <% } else {  %>
                                <div class="contenNOUser">
                                    <p class="m-0 p-3"><span>¡Tienes que estar logeado para poder hacer una pregunta!</span> </p>
                                </div>    
                                    
                            <% } %>

                              
                            
                        </div>
                    </div>
                    <div class="my-1 showMessage" style="padding-right: 10px;">
                        <!-- aqui va los datos que se mostrarán solo cuando el usuario ejecute la pregunta en tiempo real -->
                    </div>
           
                    <div class="showMessageCharge my-1" style="padding-right: 10px;">
                        <!-- aqui van los menssajes que han dejado con sus respuestas las que las tenga -->
                    </div>

                </div>
            </div>
        </div>
    </div>

    <% if (!user) { %>
        <div class="containerFixedSinUser border border-danger">
            <div class="d-flex flex-column"  style="position: fixed; right: 10px; bottom: 100px; z-index : 100">
                <div class="d-flex justify-content-end px-4">

                    <span class="rounded-pill d-flex justify-content-center align-items-center cursor-pointer shadow" id="btnXSinUser"  style="width: 40px; height: 40px; background-color: rgba(238, 238, 238, 0.9);">
                         <i class="bi bi-x-lg" style="font-size: 16px;"></i>
                    </span> 
                   
                </div>    
                <div class="body fixedSinUser mx-2 mt-5">
                    
                    <div class="d-flex flex-column align-items-center justify-content-center">

                    <div style="position: relative;">

                        <div class="px-4 py-2 lightbulbAnimation shadow d-flex" style="background-color: #ffe372; font-size: 16px; color: #7a6202; border-top-left-radius: 12px; border-top-right-radius: 12px;"> 
                            <span> No estas logeado </span>   
                        </div>
                        <div class="rounded-pill d-flex justify-content-center align-items-center" style="background-color: #ffe372; position: absolute; top: -40px; right:60px; width: 42px; height: 42px;">
                        <i class="bi bi-lightbulb-fill lightbulbAnimation" style="font-size: 28px;"></i>
                        </div>
                        
                    </div>
                    
                    </div>

                    <div class="form-group my-1 py-2" style="width: 100%; font-size: 24px;">

                    <a href="/myaccount/signin-change" class="form-control rounded-pill btn btn-dark border-secondary shadow" style="font-size: 20px;"> Entrar </a>

                    </div>
                </div>
            </div>
        </div>    
        
    <% }; %>
    
  </main>
  <%- include('../partials/scripts.ejs') %>
  <%- include('../partials/scriptsOnlyNavi-simpleNoIcons.ejs') %>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" integrity="sha512-pUhApVQtLbnpLtJn6DuzDD5o2xtmLJnJ7oBoMsBnzOkVkpqofGLGPaBJ6ayD2zQe3lCgCibhJBi4cj5wAxwVKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- con este script cconectamos este HTML al servidor socket  -->         
  <script src="/socket.io/socket.io.js" charset="utf-8"></script>

</body>
</html>

<script>

 const form_buysell = document.getElementById('form_buysell');

 const Comprador = document.getElementById('newBTNvisitante');
 const Vendedor = document.getElementById('newBTNanunciante');

 const newBTNdepart = document.getElementById('newBTNdepart');
 const newBTNtitle = document.getElementById('newBTNtitle');
 const newBTNid_title = document.getElementById('newBTNid_title');
 const countRequest = document.getElementById('countRequest');
 const available = document.querySelector('.available');
 const unitPrice = document.querySelector('.unitPrice');
 const totalPay = document.querySelector('.totalPay');


 const newBTNBuy = document.getElementById('newBTNBuy'); //boton inicial 
 const newBTNBuySpinning = document.getElementById('newBTNBuySpinning'); //boton de processing 

 let validPurchase = true;

 if (countRequest){

    countRequest.addEventListener('input', ()=>{
        const countRequestValue =  parseInt(countRequest.value);
        const availableValue = parseInt(available.value);

        console.log("unitPrice :", unitPrice.value);
        console.log("countRequest :", countRequestValue);
        console.log("available :", availableValue);
        console.log("typeOf countRequest :", typeof countRequestValue);
        console.log("typeOf available :", typeof availableValue);

        console.log(`${countRequestValue} < ${availableValue}`)

        if (countRequestValue <= availableValue){
            console.log("Se puede procesar");
            countRequest.style.cssText = "color: black;font-size: 20px"
            totalMount = (unitPrice.value * countRequest.value).toFixed(2)  //limitar dos decimales
            totalPay.innerText = `$${totalMount}`
            validPurchase = true;
        } else {
            console.log("Has pasado el limite colocarlo en rojo")
            countRequest.style.cssText = "color: red;font-size: 20px"
            totalPay.innerText = ""
            validPurchase = false;
        }

    
    });

 }    
 if (newBTNBuy){

    newBTNBuy.addEventListener('click', (e)=>{
        let comprador = Comprador.value;
        let vendedor = Vendedor.value;

        const countRequestValue =  parseInt(countRequest.value);
        const availableValue = parseInt(available.value);

        if (comprador !== vendedor){
            if ( availableValue !== 0 ){
            
                if ( availableValue  >= countRequestValue ){

                    e.preventDefault(); // Esto previene el envío del formulario
                    // Aquí puedes poner la lógica que quieras antes de enviar el formulario
                    console.log('Botón clicado, pero el formulario no se envió aún.');
                    newBTNBuy.classList.add('close');
                    newBTNBuySpinning.classList.remove('close');
                    console.log("Existe imventario")
                    // Cuando estés listo para enviar, puedes hacerlo manualmente:
                    setTimeout(() => {

                        form_buysell.submit(); 
                        console.log("Enviamos el formulario para crear la venta");

                    }, 2000);
                
                }     
                    
            } else {
                //enviar un toast diciendo que no hay disponibilidad
                console.log("No existe imventario")
            }
        }    

    })

 }   




</script>

<script>
    const containerFixedSinUser = document.querySelector('.containerFixedSinUser');
    const btnXSinUser = document.querySelector('#btnXSinUser');

    if (btnXSinUser){
        btnXSinUser.addEventListener('click', ()=>{
            containerFixedSinUser.classList.add("closed"); //quitamos el contenedor para que no le moleste, no quiere logearse
        })
    }

</script>

<script>

    const form_contact = document.getElementById('form_contact');
    const newBTNContact = document.getElementById('newBTNContact'); //boton inicial 
    const newBTNContactSpinning = document.getElementById('newBTNContactSpinning'); //boton de processing 

    newBTNContact.addEventListener('click', (e)=>{
        let comprador = Comprador.value;
        let vendedor = Vendedor.value;
        console.log("Hemos dado al boton");
        e.preventDefault(); // Esto previene el envío del formulario

        if (comprador !== vendedor){
            console.log("he dado al boton");
            newBTNContact.classList.add('close');
            newBTNContactSpinning.classList.remove('close');
    
            // Cuando estés listo para enviar, puedes hacerlo manualmente:
            setTimeout(() => {

                form_contact.submit(); 
                console.log("Enviamos el formulario para crear el contacto en la sala");

            }, 2000);
        }

    })

</script>

<script>
   //Script popover de esta pagina.  
  const popoverCarBuy = document.querySelector('.popoverCarBuy'); 

  // Inicializa el popover de Bootstrap
  const popoverInstanceCar = new bootstrap.Popover(popoverCarBuy);

  // Función para mostrar/ocultar el popover
  function togglePopoverCar() {
      const isVisible = popoverInstanceCar._isShown;
      if (isVisible) {
        popoverInstanceCar.hide();
      } else {
        popoverInstanceCar.show();
      }
  }

  // Añade evento al botón
  popoverCarBuy.addEventListener('mousemove', (event) => {
      event.stopPropagation(); // Evita que el clic en el botón cierre el popover inmediatamente
      togglePopoverCar();
  });



  // Cierra el popover si se hace clic en cualquier parte de la página
  document.addEventListener('mousemove', () => {
      popoverInstanceCar.hide();
  });

</script>

<script>
    //comentario explicativo
    const showContent = document.getElementById('showContent');
    const hiddenTecDescript = document.getElementById('hiddenTecDescript');

    const tecDescrip = hiddenTecDescript.value;
    const delta = JSON.parse(tecDescrip);

    console.log("tecDescrip :", tecDescrip)

    let showConteQuill = new Quill('#showContent', {
        modules: {
            toolbar: false
        },
        readOnly: true
    });

    showConteQuill.setContents(delta)



</script>

<script>

    let mini = document.querySelectorAll('.imgMini');
    let view = document.querySelector('.imgView');
    let videoMini = document.querySelector('.videoMini');
    
    let containerViewImg = document.querySelector('.containerViewImg');
    let containerViewVideo = document.querySelector('.containerViewVideo');

    if (videoMini && containerViewVideo){
        //existe un video entre los recursos de media
        mini.forEach( (ele, i)=>{
            console.log(ele.src)
            
            mini[i].addEventListener('mouseover', ()=>{
                containerViewImg.classList.remove('closed');
                containerViewVideo.classList.add('closed');
                containerViewImg.innerHTML  = `<img src=${ele.src} class="imgView rounded-1 zoomImage" style="object-fit: cover; width: 100%;">  ` 
                                                   
                $(document).ready(function() {
                    $('.imgView').elevateZoom({
                        zoomType: "lens", // Puedes cambiar a "lens", "inner" o "window" si prefieres otro tipo
                        lensShape: "round", // Forma del lente "round" y "square"
                        lensSize: 200, // Tamaño del lente
                        zoomLevel: 1,
                        scrollZoom: true, // Habilita el zoom con scroll
                    });
                })
                
                
            });
           
        });

        videoMini.addEventListener('click', () => {
            // el motivo que tuve para esconder el container zoomContainer es por las razones siguientes.
            // contendor propio de la libreria es el que usa para colocar a un lado y usarse con la configuracion windows
            // aui usamos la configuracion "lens" asi que ese contenedor no lo vamos a usar. 
            // estos contendores porque seran la cantidad de imaganes que existan en la publicacion se ponen a un lado
            // y no dejan usar los controles de play del reproductor de video. la solucion fue quitarlos con la propiedad display: "none"
            const zoomContainer = document.querySelectorAll('.zoomContainer');

            if (zoomContainer) {
                zoomContainer.forEach((ele)=>{
                    ele.style.display = "none"
                })
            }

            $('.imgView').on('mouseleave', function() {
                    zoom.hide(); // Oculta el zoom al salir del mouse
            });

            containerViewImg.classList.add('closed');   
            containerViewVideo.classList.remove('closed');
             

        });

    } else {
        //NO existe video entre los recursos de media
        mini.forEach( (ele, i)=>{
            console.log("Revisa esta parte -->", ele.src)
            
            mini[i].addEventListener('mouseover', ()=>{
                containerViewImg.innerHTML  = `<img src=${ele.src} class="imgView rounded-1 zoomImage" style="object-fit: cover; width: 100%;">  ` 
                
                $(document).ready(function() {
                    $('.imgView').elevateZoom({
                        zoomType: "lens", // Puedes cambiar a "inner" o "window" si prefieres otro tipo
                        lensShape: "round", // Forma del lente "round" y "square"
                        lensSize: 200, // Tamaño del lente
                        zoomLevel: 1,
                        scrollZoom: true, // Habilita el zoom con scroll del mouse importante
                    });
                });        
            });
           
        });
    }   

 
</script>



<script>

const DataFetch = fetch('/extraer')
    .then(response => response.json())
    .then((jsondata) =>
{
       
    //console.log("jsondata ..........: ",jsondata)
    
    let btnSenMessage = document.getElementById('btnSenMessage'); //este es el boton para enviar el mensaje
    let questions = document.getElementById('questions'); //esto es el input donde el usuario escribe su mensaje
    let showMessage = document.querySelector('.showMessage'); //tomo esta card para mostrar en tiempo real el mensaje enviado.

    if (btnSenMessage){

        btnSenMessage.addEventListener('click', ()=>{
        // con esta linea condiciono a que debe haber algun texto para poder enviar una pregunta.
        if (questions.value.length !== 0 ){

            console.log("<<<<Esto es jsondata>>>>---->",jsondata);
            const _data = {
                dataI : jsondata,
                questionsI : questions.value
            }
            

            fetch("/message", {
                method: "POST",
                body : JSON.stringify(_data),
                headers: { "Content-Type" : "application/json"}
            })
            .then(response => response.json())
            .then(json =>{ console.log(":::::: Esto es json  ---->", json)
                    const CreatedAt = json.createdAt;
                   
                  
                })
            .catch( err => console.log(err));

                //mostrar el mensaje dentro de la caja showMessage linea 385.

                        
                showMessage.innerHTML += `<div class="rounded-3 ms-2 my-1 pt-2 pb-1 ps-2 pe-5" style="background-color: rgb(207, 207, 207, 0.2); margin-left: 5px;">
                                                <span class="bg-secondary rounded-2 px-1 text-light">${jsondata.user.username}</span>
                                                <span class="ms-1 me-4">${questions.value}</span>
                                          </div>`


                //limpia el textarea
                questions.value = '';
                questions.focus();

        }
    
    });
    
    }
       
        
                    
});

</script>

<script>
    //este script obtiene todos los mensajes de un articulo o servicio.
    const productId = document.getElementById('productId');
    const showMessageCharge = document.querySelector('.showMessageCharge');

    const _data = {
                idProduct : productId.value
            }
            

            fetch("/messages-product", {
                method: "POST",
                body : JSON.stringify(_data),
                headers: { "Content-Type" : "application/json"}
            })
            .then(response => response.json())
            .then( viewMessage =>{ //console.log(">>>>> Esto es viewMessage <<<<<", viewMessage)

                    viewMessage.forEach((ele)=>{
                        const username = ele.username;
                        const question = ele.question;
                        const answer = ele.answer;
                        const typeNote = ele.typeNote;

                        const CreatedAt = ele.createdAt;
                        const UpdatedAt = ele.updatedAt;
                        const date = new Date(CreatedAt);
                        const updated = new Date(UpdatedAt);
                        
                        const createDia = date.getDate(); const createMes = date.getMonth()+1; const createAni = date.getFullYear();
                        const createHora = date.getHours(); const createMinu = date.getMinutes();
                        
                        const updatedDia = updated.getDate(); const updatedMes = updated.getMonth()+1; const updatedAni = updated.getFullYear();
                        const updatedHora = updated.getHours(); const updatedMinu = updated.getMinutes();

                        //console.log("Esto es username ---->",username);
                        //console.log("Esto es question ---->",question);
                        //console.log("Esto es CreatedAt ---->",CreatedAt);
                       
                        //console.log("createMinu ---->", createMinu);  
                        //console.log("dd, mm, yyyy", createDia, createMes, createAni);
                        let dateCreate;
                        let updatedCreate;

                        if (createMinu < 10 ){
                            //console.log("createMinu es menos a 10")
                            dateCreate = `${createDia}-${createMes}-${createAni} ${createHora}:0${createMinu} ` 
                        } else {
                            dateCreate = `${createDia}-${createMes}-${createAni} ${createHora}:${createMinu}` 
                            //console.log("createMinu es mayor a 10")
                        }

                        if (updatedMinu < 10 ){
                            //console.log("updatedMinu es menos a 10")
                            updatedCreate = `${updatedDia}-${updatedMes}-${updatedAni} ${updatedHora}:0${updatedMinu}` 
                        } else {
                            updatedCreate = `${updatedDia}-${updatedMes}-${updatedAni} ${updatedHora}:${updatedMinu}` 
                            //console.log("updatedMinu es mayor a 10")
                        }

                        
                        //console.log(dateCreate);
                        //console.log("::::::::::fin::::::::::::::");

                        if (typeNote === "messages"){
                            if (answer !== 'waiting'){
                            showMessageCharge.innerHTML += ` <div class="rounded-3 ms-2 mt-1 pt-2 pb-1 ps-2 pe-0" style="background-color: rgb(207, 207, 207, 0.1); margin-left: 5px;">
                                                                <span class="bg-secondary rounded-2 px-1 text-light shadow-sm">${username}</span>
                                                                <span class="ms-1 me-1">${question}</span>
                                                                <span class="p-1 rounded-pill shadow-sm border" style="font-size: 13px;">${dateCreate}</span>
                                                            </div> 
                                                            <div class="rounded-3 ms-4 pt-1 pb-1 ps-2 pe-0" style=" background-color: rgb(233, 236, 239, 0); margin-bottom: 10px;">
                                                                <i class="bi bi-arrow-return-right ms-1 me-2"></i>
                                                                <span class="me-1">${answer}</span>
                                                                <span class="p-1 rounded-pill shadow-sm border" style="font-size: 13px;">${updatedCreate}</span>
                                                            </div> `  
                            
                            };

                        
                            if (answer == 'waiting'){
                            showMessageCharge.innerHTML += ` <div class="rounded-3 ms-2 my-1 pt-2 pb-1 ps-2 pe-0" style="background-color: rgb(207, 207, 207, 0.2); margin-left: 5px;">
                                                                <span class="bg-secondary rounded-2 px-1 text-light shadow-sm">${username}</span>
                                                                <span class="ms-1 me-1">${question}</span>
                                                                <span class="p-1 rounded-pill shadow-sm border" style="font-size: 13px;">${dateCreate}</span>
                                                            </div> ` 
                                                            
                            
                            };

                        }    
                    })
                   

                   
                    
                   /*  const dateQuestion = `${createHora}:${createMinu} ${createDia}-${createMes}-${createAni}`
                    console.log("::::: Esto es dateQuestion ---->", dateQuestion); */
                  
                })
            .catch( err => console.log(err));
           
            
</script>  

<script>
    //aqui estaba antiguamente el sistema que enviaba y recibia toda la informacion 
    //del lebvel de la tienda si era carbo o hierro o diamante 
    //se hacia a traves del fetch con la direccion : fetch("/record-trust"
    //este antiguo sistema era muy laboriado de mantener asi que se decidio por ser reemplazado por uno nuevo.
</script>



<script>
    
    //Este es el script para realizar la solicitud de puja en la subasta
    const bidUser = document.querySelector('.bidUser'); //usuario data
    const bidAmount = document.querySelector('.bidAmount'); //monto que desea ofrecer data
    const bidDepartment = document.querySelector('.bidDepartment'); //department data
    const bidIDProduct = document.querySelector('.bidIDProduct'); //id del producto data
    const btnBID = document.querySelector('.btnBID');
    const btnBID_Disabled = document.querySelector('.btnBID_Disabled');


    if (btnBID){

        btnBID.addEventListener('click', ()=>{

            const bidAmountExist = bidAmount.value;
            console.log("bidAmountExist --->", bidAmountExist)
            if (bidAmountExist !== "" && bidAmountExist > 0){
                console.log("Va para el servidor")

                btnBID_Disabled.classList.remove('close');
                btnBID.classList.add('close');
                    
                //data obtenida en el bloque 648
                const dataBid = {
                    bidUser : bidUser.value,
                    bidAmount : bidAmount.value,
                    bidDepartment : bidDepartment.value,
                    bidIDProduct : bidIDProduct.value
                }
                console.log("Esto es dataBid", dataBid)

                fetch("/bidatauction", {
                    method: "POST",
                    body : JSON.stringify(dataBid),
                    headers: { "Content-Type" : "application/json"}
                })
                .then(response => response.json())
                .then(jsonBid =>{ 
                        console.log(">>>>>>>>>>>><<<<<<<<<<", jsonBid)
                        console.log(">>>>>>>>>-OJO-<<<<<<<<", jsonBid)
                        console.log(">>>>> Esto es jsonBid <<<<<", jsonBid);
                        //{msj: 'Debe ser mayor al ultimo precio.', type: 1}
                        const type = jsonBid.type;
                        console.log("Esto es type ", type );
                        console.log("type es", typeof type );

                        if (type === 2){
                            socket.emit('creacion:Bid', { 'objetBid' : jsonBid  });    
                        } else {
                            socket.emit('error:Bid', { 'objetBid' : jsonBid  });
                        }
                    
                        //aqui es donde se debe enviar la data nueva al socket
                        //el socket recibe y emite al view general product para armar con un escucha la tabla de la puja
                        // Ahora vamos de liberar el boton tras pasar 10 segundos
                        setTimeout(() => {
                            btnBID_Disabled.classList.add('close');
                            btnBID.classList.remove('close');
                        }, 5000);
                    

            })
                .catch(err => console.log(err));

            } else {
                console.log("NO va para el servidor")
            }


        });


    }

  
    //Nota: El endpoint /bidatauction esta en la ruta view-general-product.routes
</script>

<script>
    //consulta periodica cada minuto para evaluar si esta subasta aun existe
    //const bidIDProduct = document.querySelector('.bidIDProduct'); //id del producto data ya declarado arriba
    const depart = document.getElementById('departAllBody').value;

    if (depart == 'auctions')  { 

        const datoId = {
            id : idHidden.value
        };

        setInterval(() => {
            console.log("Esto es datoId de la subasta verrr aqui", datoId)

            fetch('/product/auctions/exist', {

            method: "post",
            body: JSON.stringify(datoId),
            headers: {"content-type" : "application/json"}

            })
            .then(response =>response.json() )
            .then( jsonx => {
                
                console.log("Esto es la respuesta de si existe la subasta ->", jsonx);
                const response  = jsonx.response;
                console.log("Esto es response ------>", response);
                console.log("response es de tipo ------>", typeof response);
                
                if (response === 'delete' ){
                    location.reload()
                }
            
            })
            .catch( err => console.log(err));

        }, 60000);

    }    

</script>

<script>
    const idTitle = document.getElementById('idTitle'); //linia de codigo 166
    const dateInicio = document.getElementById('dateInicio'); //liniea 464 mostrar la hora (tiempo de ejecucion)
    const bidding = document.getElementById('bidding');
    const auctionClose = document.getElementById('auctionClose');
    const leftTime = document.getElementById('leftTime'); // en minutos
    const iclosed = document.querySelector('.i-closed');
    let date; // Fecha y Hora actual del servidor.
    let auctionDate; // Fecha y Hora de Inicio de Sala de Subasta.
    let auctionDateClose; // Fecha y Hora Final de Sala de Subasta.
    let biddingTime; // Cantidad de Horas que Durara la subasta.
    let active; // Identifica si esta Subasta esta o no activa.
    let less; //cantidad de minutos

    //console.log(idTitle.value);

    if (idTitle){

            const data = {
                idTitle : idTitle.value
            }
            

            fetch("/auction/cronoAsta", {
                method: "POST",
                body : JSON.stringify(data),
                headers: { "Content-Type" : "application/json"}
            })
            .then(response => response.json())
            .then( cronoAsta => {console.log("  Esto es cronoAsta ", cronoAsta)
            
                date = new Date(cronoAsta.date); //fecha y hora actual del servidor
                auctionDate = cronoAsta.searchAuction.auctionDate; //fecha y hora de inicio de sala de Subasta.
                auctionDateClose = cronoAsta.searchAuction.auctionDateClose;
                active = cronoAsta.searchAuction.active;
                biddingTime = cronoAsta.searchAuction.biddingTime;
               
                //console.log("date :", date); //fecha y hora actual enviado desde el servidor
                //console.log("active :", active ); //estado del atributo active
                //console.log("auctionDate :", auctionDate); //fecha y hora de inicio de subasta
                //console.log("auctionDateClose :", auctionDateClose); //fecha y hora de cierre de subasta
                //console.log("biddingTime :", biddingTime); //cantidad de horas que dura la subasta

                const biddingMinutes = (biddingTime * 60);
                dateInicio.innerHTML = `<span class="me-2"> ${auctionDate} </span>`  //Sala Iniciada ****
                bidding.innerHTML = `<span><i class="bi bi-stopwatch-fill me-1"></i> (${biddingTime} Hrs. - ${biddingMinutes} Min.)</span>`; //Tiempo ****
                auctionClose.innerText = auctionDateClose; //Finaliza ****


                function calcularTime(){
                    // --- Bloque de codigo para calcular la cantidad de minutos que quedan para cerrar la Sala ---
                    //console.log("**************************ver************************")
                    //console.log("ESTO es date ------------------>", date);
                    const diaActual = date.getDate(); const mesActual = date.getMonth() +1; const yearActual = date.getFullYear()
                    const horaActual = date.getHours(); const minuActual = date.getMinutes();
                    let dateNow, timeNow;
                    let dateClose, timeClose;
                    let dateLocal, timeLocal; //esta es la hora del equipo que esta operando en la subasta;

                    dateNow = `${diaActual}${mesActual}${yearActual}`;
                    if (minuActual <= 9 ){
                        timeNow = `${horaActual}0${minuActual}`;
                    } else if (minuActual == 0) {
                        timeNow = `${horaActual}00`; 
                    } else {
                        timeNow = `${horaActual}${minuActual}`;
                    }

                    let Local = new Date();
                    const diaLocal = Local.getDate() ; const mesLocal = Local.getUTCMonth() + 1; const yearLocal = Local.getFullYear();
                    const horaLocal = Local.getHours(); const minuLocal = Local.getMinutes();
                    
                    dateLocal = `${diaLocal}${mesLocal}${yearLocal}`;
                    if (minuLocal <= 9 ){
                        timeLocal = `${horaLocal}0${minuLocal}`;
                    } else if (minuLocal == 0) {
                        timeLocal = `${horaLocal}00`; 
                    } else {
                        timeLocal = `${horaLocal}${minuLocal}`;
                    }
                    


                    //console.log(auctionDateClose)
                    const auctionCloseSplit = auctionDateClose.split(" ");
                    let fechaClose = auctionCloseSplit[0]; let HoraClose = auctionCloseSplit[1];
                    let fechaCloseSplit = fechaClose.split("-"); 
                    const diaEnd = fechaCloseSplit[0]; const mesEnd = fechaCloseSplit[1]; const yearEnd = fechaCloseSplit[2];
                    const HoraCloseSplit = HoraClose.split(":");
                    let horaEnd = HoraCloseSplit[0]; const minuEnd = HoraCloseSplit[1];
                
                    
                    if (mesEnd <= 9){

                        if (diaEnd <= 9){
                            dateClose = `${yearEnd}-0${mesEnd}-0${diaEnd}`
                        } else {
                            dateClose = `${yearEnd}-0${mesEnd}-${diaEnd}`
                        }
                        
                    } else {

                        if (diaEnd <= 9){
                            dateClose = `${yearEnd}-${mesEnd}-0${diaEnd}`
                        } else {
                            dateClose = `${yearEnd}-${mesEnd}-${diaEnd}`
                        }

                    }


                    //es importante que la hora nunca sea 0, cuando sea 0 se debe colocar 00 para que luego podamos lograr armar con estos datos un nuevo Objeto Date.
                    if (horaEnd == 0){
                        timeClose = `0${horaEnd}:${minuEnd}`;
                    } else {
                        timeClose = `${horaEnd}:${minuEnd}`;
                    }

                    
                    let dateFinish = `${dateClose}T${timeClose}:00`;                   
                    //console.log("dateFinish", dateFinish);
                    let DateFinish = new Date(dateFinish);
                    //console.log("DateFinish",  DateFinish);

                    //console.log("Local", Local);

                    let diferenciaMs = DateFinish - Local;
                    //console.log("diferenciaMs", diferenciaMs);
                    less = Math.floor(diferenciaMs / 60000); // 60000 => 1 min
                    //console.log("less", less); 
                    
                    // ya aqui poseo dateNow y timeNow;
                    console.log("****Fecha actual del servidor*****", dateNow);
                    console.log("****Hora actual del servidor*****", timeNow);//****Hora actual del servidor***** 11041


                    //primera comprobacion es determinar si esta la sala activa tomando en consideracion la Hora
                    //actual y la hora y fecha actual en curso.

                    if (less >= 0){

                        console.log("Esta Sala esta Activa");
                        leftTime.innerHTML = `${less} Min.`;

                    } else {
                        
                        console.log("Esta Sala esta Cerrada");
                        leftTime.innerText = '0 Min.';

                    }

                }


            setInterval(calcularTime, 60000);    
            
                
                })
            .catch( e => console.log(e));

    }


    
</script>

<script>

    const socket = io();
 
 
    const textMessage = document.getElementById('textMessage');
    const emojiSelectorIcon = document.getElementById('emojiSelectorIcon');
    const emojiSelector = document.getElementById('emojiSelector');
    const emojiSelectorList = document.getElementById('emojiSelectorList');
    const emojis = document. querySelectorAll('.emoji');
    const colorsSelectorIcon = document.getElementById('colorsSelectorIcon');
    const colorsSelector = document.getElementById('colorsSelector');
    const emotiClosed = document.querySelector('.emotiClosed');
    const colorClosed = document.querySelector('.colorClosed')
    const colorSelected = document.getElementById('colorSelected'); //padre del colorAlertSelected
    const colorAlertSelected = document.getElementById('colorAlertSelected'); //este es la muestra del color seccionado en el input text
    const btnSubmitNote = document.getElementById('btnSubmitNote');
    const showNotes = document.querySelector('.showNotes');
    const showNotesSpectadores = document.querySelector('.showNotesSpectadores');

    //datos ocultos importantes
    const idHidden = document.getElementById('idHidden'); 
    const departHidden = document.getElementById('departHidden');
    

    const colorCube = document.querySelectorAll('.color-cube'); //estos es un node de colores
    let emojiClick;


 for (let i = 0; i < emojis.length; i++) {
        const emoji = emojis[i];
        emoji.addEventListener('click', ()=>{
            emojiClick = emoji.childNodes[0];
            //console.log(emojiClick);
            textMessage.value += emojiClick.textContent;    
        })
   }
   
        
    if (emojiSelectorIcon){
        emojiSelectorIcon.addEventListener('click', ()=>{
            emojiSelector.classList.toggle('closed');
        });
    }; 


    if (emotiClosed){
        emotiClosed.addEventListener('click', ()=>{
            emojiSelector.classList.toggle('closed');
        });
    };


    if (colorsSelectorIcon){
        colorsSelectorIcon.addEventListener('click', ()=>{
            colorsSelector.classList.toggle('closed');
        });
    };

    if  (colorSelected){
        colorSelected.addEventListener('click', ()=>{
            colorsSelector.classList.toggle('closed'); 
        })
    }


    for (let i = 0; i < colorCube.length; i++) {
        const color= colorCube[i];
        color.addEventListener('click', ()=>{
            const colorAlert = color.childNodes[1];
            //console.log("color : ", colorAlert.value);
            const colorSelectedValue = colorAlert.value;
            colorAlertSelected.value = colorSelectedValue;
          
            if (colorSelectedValue == "dark"){
                colorSelected.style.backgroundColor = "#e2e3e5";
                colorsSelector.classList.toggle('closed'); 
            } else if (colorSelectedValue == "primary"){
                colorSelected.style.backgroundColor = "#cfe2ff";
                colorsSelector.classList.toggle('closed'); 
            } else if (colorSelectedValue == "success"){
                colorSelected.style.backgroundColor = "#d1e7dd";
                colorsSelector.classList.toggle('closed');
            } else if (colorSelectedValue == "info"){
                colorSelected.style.backgroundColor = "#cff4fc";
                colorsSelector.classList.toggle('closed');
            } else if (colorSelectedValue == "warning"){
                colorSelected.style.backgroundColor = "#fff3cd";
                colorsSelector.classList.toggle('closed');
            } else if (colorSelectedValue == "danger"){
                colorSelected.style.backgroundColor = "#f8d7da";
                colorsSelector.classList.toggle('closed');
            } else {
                colorSelected.style.backgroundColor = "white";
                colorsSelector.classList.toggle('closed');
            }
            
        })
        
    }

    if (colorClosed){
        colorClosed.addEventListener('click', ()=>{
            colorsSelector.classList.toggle('closed');
        });
    };


    if (btnSubmitNote){
        btnSubmitNote.addEventListener('click', ()=>{
            const noteCreate = textMessage.value;
            const color = colorSelected.childNodes[1].value;
            const departHidd = departHidden.value;
            const idHidd = idHidden.value;

            if (noteCreate.length > 1){

                const datos = {
                    id : idHidd, //este input oculto guarda el id de la subasta y que necesito como dato
                    depart : departHidd, //este input oculto guarda el departamento
                    nota : noteCreate,
                    color : color
                };

                //console.log("Esto es datos:", datos);
                textMessage.value = ""; //aqui limpio el input de creacion de notas
                textMessage.focus();
                fetch('/express-notes', {

                method: "post",
                body: JSON.stringify(datos),
                headers: {"content-type" : "application/json"}

                })
                .then(response =>response.json() )
                .then( jsonx =>{ 
                    console.log("esto es recibido desde /express-notes : ");
                    socket.emit('creacion:Note', { 'obje' : jsonx });
                    console.log(jsonx);
                
                })
                .catch( err => console.log(err)); 

            }

        });
    }    


    //esta sección captura las notas de una subasta al cargar la pagina

        window.addEventListener('load', ()=>{
            //console.log("Proceso al cargar pagina");

            //si existe este objeto entonces el script se ejecuta.
            if (departHidden){

                const departHidd = departHidden.value;
                const idHidd = idHidden.value;
        
                const datos = {
                    id : idHidd,
                    depart : departHidd,
                };

                console.log("Esto es datos:", datos);

                fetch('/express-notes-extraer', {

                method: "post",
                body: JSON.stringify(datos),
                headers: {"content-type" : "application/json"}

                })
                .then(response =>response.json() )
                .then( jsonx =>{ 
                    console.log('************** O J O *****************');
                    console.log("esto es recibido desde /express-notes-extraer : ");
                    console.log(jsonx);
                    const allNotes = jsonx.reverse()
                    const longNotes = allNotes.length; //esto es la cantidad de elementos que posee el array allNotes.
                    

                    if (showNotes){
                        //esta es la muestra de notas del anfitrion
                    
                        function generarNotes(){
                
                            return new Promise ( function (resolve, reject ){ 

                                allNotes.forEach((ele, i)=>{

                                    if (ele.color === "dark"){
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-dark" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `
                                    } else if (ele.color === "primary"){
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-primary" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `

                                    } else if (ele.color === "success"){
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-success" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `

                                    }  else if (ele.color === "info"){
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-info" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `

                                    } else if (ele.color === "warning"){
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-warning" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `

                                    } else if (ele.color === "danger"){
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-danger" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `

                                    } else {
                                        showNotes.innerHTML +=`
                                                                <div class="card note mb-1">
                                                                                    <div class="card-body alert-light" style="position: relative;">
                                                                                        <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                        <p class="m-0">${ele.nota}</p>
                                                                                    </div>
                                                                </div>
                                                                `

                                    }
                                    
                                    if (i === longNotes - 1){
                                        console.log("i : ", i);
                                        console.log("longNotes : ", longNotes);
                                        resolve();
                                    }

                                });

                            });

                        }    
                    
                        function generarTagDeleteNotes(){
                            console.log("*********** funcion eliminar Nota**********");
                            const deleteNote = document.querySelectorAll('.deleteNote');
                            console.log("deleteNote :", deleteNote);
                            deleteNote.forEach((ele, i)=>{
                                ele.addEventListener('click', ()=>{
                                    //ahora vamos a crear un dato para enviar al servidor y eliminar la nota deseada.
                                    //alert(`hola me quieres eliminar ?`);
                                    console.log("Hijos idNota a eliminar :", ele.childNodes);
                                    const idHidd = idHidden.value;
                                    const idNota = parseInt(ele.childNodes[2].value);
                                    const depart = ele.childNodes[3].value;
                                    
                                    const datos = {
                                        id : idHidd,
                                        idNota : idNota,
                                        depart : depart
                                    };

                                    console.log("Estos son los datos que envio al backend para ser eliminado")

                                    fetch('/express-notes-deleting', {

                                    method: "post",
                                    body: JSON.stringify(datos),
                                    headers: {"content-type" : "application/json"}

                                    })
                                    .then(response =>response.json() )
                                    .then( jsonx => {
                                        console.log("Esto es lo que viene de haber eliminado una nota");
                                        socket.emit('delete:Note', { 'obje' : jsonx });
                                        console.log(jsonx)
                                        //location.reload();
                                    })
                                    .catch( err => console.log(err));

                                })
                                
                            })
                        }
                        
                        generarNotes().then(generarTagDeleteNotes());

                    }
                    
                    if (showNotesSpectadores) {
                        //Notas para los espectadores con o sin user
                        allNotes.forEach((ele, i)=>{

                            if (ele.color === "dark"){
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-dark" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `
                            } else if (ele.color === "primary"){
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-primary" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `
                            } else if (ele.color === "success"){
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-success" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `
                            }  else if (ele.color === "info"){
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-info" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `
                            } else if (ele.color ==="warning"){
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-warning" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `
                            } else if (ele.color === "danger"){
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-danger" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `
                            } else {
                                showNotesSpectadores.innerHTML +=`
                                                        <div class="card note mb-1">
                                                                            <div class="card-body alert-light" style="position: relative;">
                                                                                <p class="m-0">${ele.nota}</p>
                                                                            </div>
                                                        </div>
                                                        `

                            }       

                        });

                    }   
                })
                .catch( err => console.log(err)); 
                }
                        

        });
        
</script>
<script>
    //escucha para actualizar las pujas de las subastas desde el Socket
    const tableBids = document.querySelector('.tableBids');
    const tableBidsOwn = document.querySelector('.tableBidsOwn');
    const tableBidsNoLogin = document.querySelector('.tableBidsNoLogin');

    const contMSJ = document.querySelector('.contMSJ') //contenedor de alertas de participantes
    const contMSJOwn = document.querySelector('.contMSJOwn') //contenedor de alertas del anfitrion
    const efectSoundNewBid = document.getElementById('efectSoundNewBid');

    socket.on('refresh:bid', (data)=>{
        console.log(":::::::::::::Socket Escuchando *refresh:bid* ::::::::::");
        console.log("Esto es data objeto enviado desde el Servidor Socket ---->", data);
        console.log("LLegando del Socket XXXXXX---->", data);
        console.log("Si llega este objeto es una buena noticia porque llegara a todos los que esten conectados")
        const objetBid = data.objetBid
        console.log("VERRRRRRRRRRR ---->", objetBid);

        const type = objetBid.type; //este datos se usara para saber cuando hay o no participantsBid que actualizar
        const bidObject = objetBid.participantsBid;
        const msj = objetBid.msj;

        console.log("Esto es type---->", type);
        if (type === 2){ //type 2 es que tiene participantsBid y msj;            

            console.log("bidObject >>>>>>>>>", typeof bidObject);
            console.log("*****msj***** >>>". msj);
        
            const bids = bidObject;
            console.log("Que es bids >>>", typeof bids);
            const bidsSort = bids.reverse(); //lo ordeno en el orden que debe ser mostrado
            //console.log("Estamos trabajando aqui en este script 13 de Diciembre")
            console.log("Estamos trabajando aqui en este script 24 de Diciembre")
        
            //existe bidObject y msj

            console.log("Esto son todos los bids ordenados --->", bidsSort);
            console.log("Esto es el mensaje que viene del backend --->", msj);
            //ahora es momento de renderizar la tabla donde se ve las pujas

            if (tableBids){
                tableBids.innerHTML = ""; //aqui limpiamos todo para que no se concatene.
            }
            
            if (tableBidsOwn){
                tableBidsOwn.innerHTML = ""; //aqui limpiamos todo para que no se concatene.
            }
            
            if (tableBidsNoLogin){
                tableBidsNoLogin.innerHTML = ""; //aqui limpiamos todo para que no se concatene.
            }
            

            efectSoundNewBid.currentTime = 0; //Reiniciamos el sonido
            efectSoundNewBid.play().catch(error => {
                console.error("Error al reproducir el sonido:", error);
            });

            if (contMSJ){
                contMSJ.innerHTML  = `<div class="p-2 alert alert-success">  <i class="bi bi-check-circle-fill me-2"></i>  ${msj}
                                            <button type="button" class="btn-close invisible" data-bs-dismiss="alert" aria-label="Close"></button>
                                     </div>`
            }

            if (contMSJOwn){
                contMSJOwn.innerHTML  = `<div class="p-2 alert alert-success">  <i class="bi bi-check-circle-fill me-2"></i>  ${msj}
                                            <button type="button" class="btn-close invisible" data-bs-dismiss="alert" aria-label="Close"></button>
                                       </div>` 
            }
                    

            console.log("*****msj***** >>>", msj);
            const close = document.querySelector('.btn-close');

            setTimeout(() => {
                close.click() 
            }, 4000);

            bidsSort.forEach((ele, i)=>{
                const bidUser = ele.bidUser;
                const acortado = bidUser.substring(0, 6) + "***";
                const bidAmountF = ele.bidAmountF;
                const time = ele.Time;

                
                if (i === 0){ //este es el primero o mejor oferta de la puja aparece remarcado en ver

                    if (bidUser.length >3){
                            
                        if (tableBids){
                            tableBids.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                            <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                            <tr>`
                        }  
                        
                        if (tableBidsOwn){
                            tableBidsOwn.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                            <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                            <tr>`
                        }        
                        
                        if (tableBidsNoLogin){
                            tableBidsNoLogin.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                            <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                            <tr>`
                        }               

                    } else {

                        if (tableBids){
                            tableBids.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                            <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                            <tr>`
                        }        
                            
                        if (tableBidsOwn){
                            tableBidsOwn.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                            <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                            <tr>`
                        }   

                        if (tableBidsNoLogin){
                            tableBidsNoLogin.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                            <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                            <tr>`
                        }            

                    }
                        
                } else {

                    if (bidUser.length >3){
                        
                        if (tableBids){
                            tableBids.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                            <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                            <tr>`
                        }        

                        if (tableBidsOwn){
                            tableBidsOwn.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                            <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                            <tr>` 
                        }
                        
                        if (tableBidsNoLogin){
                            tableBidsNoLogin.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                            <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                            <tr>`
                        }             

                    } else {
                        
                        if(tableBids){
                            tableBids.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                            <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                            <tr>`
                        }
                        
                        if(tableBidsOwn){
                            tableBidsOwn.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                            <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                            <tr>`
                        }        

                        if(tableBidsNoLogin){
                            tableBidsNoLogin.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                            <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                            <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                            <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                            <tr>`
                        }            
                                
                    }

                }
            })

        } else {
            //solo existe msj
            //type : 0 y 1 solo hay mensaje

            efectSoundNewBid.currentTime = 0; //Reiniciamos el sonido
            efectSoundNewBid.play().catch(error => {
                console.error("Error al reproducir el sonido:", error);
            });   
            
            if (contMSJ){
                contMSJ.innerHTML  = `<div class="p-2 alert alert-danger"> <i class="bi bi-x-circle-fill me-2"></i>  ${msj}
                                        <button type="button" class="btn-close invisible" data-bs-dismiss="alert" aria-label="Close"></button>
                                  </div>`
            }

            if (contMSJOwn){
                contMSJOwn.innerHTML  = `<div class="p-2 alert alert-danger"> <i class="bi bi-x-circle-fill me-2"></i>  ${msj}
                                        <button type="button" class="btn-close invisible" data-bs-dismiss="alert" aria-label="Close"></button>
                                  </div>`
            }


            console.log("*****msj***** >>>", msj);
            const close = document.querySelector('.btn-close');

            setTimeout(() => {
                close.click() 
            }, 4000);
        }



    })
    


    //esta sección captura las pujas de una subasta al cargar la pagina

    window.addEventListener('load', ()=>{
            //console.log("Proceso al cargar pagina");

            //si existe este objeto entonces el script se ejecuta.
            if (departHidden){

                const departHidd = departHidden.value;
                const idHidd = idHidden.value;
        
                const dato = {
                    id : idHidd //este input oculto guarda el id de la subasta y que necesito como dato
                };

                console.log("Esto es datos:", dato);

                fetch('/express-bid-extraer', {

                method: "post",
                body: JSON.stringify(dato),
                headers: {"content-type" : "application/json"}

                })
                .then(response =>response.json() )
                .then( jsonx =>{ 
                    console.log('************** O J O *****************');
                    console.log("esto es recibido desde /express-bid-extraer : ");
                    const bidObject = jsonx.searchBids;
                    const bidsSort = bidObject.reverse(); //lo ordeno en el orden que debe ser mostrado
                    console.log("Esto es bidsSort >>>>>>>>>>><<", bidsSort);

                    if (tableBids){
                        console.log('tableBids tag-->', tableBids);
                        tableBids.innerHTML = ""; //aqui limpiamos todo para que no se concatene.
                    }
                    
                    if (tableBidsOwn){
                        console.log('tableBidsOwn tag-->', tableBidsOwn);
                        tableBidsOwn.innerHTML = ""; //aqui limpiamos todo para que no se concatene.
                    }
                                       
                    if (tableBidsNoLogin){
                        console.log('tableBidsNoLogin tag-->', tableBidsNoLogin);
                        tableBidsNoLogin.innerHTML = ""; //aqui limpiamos todo para que no se concatene.
                    }

                    bidsSort.forEach((ele, i)=>{
                        const bidUser = ele.bidUser;
                        const acortado = bidUser.substring(0, 6) + "***";
                        const bidAmountF = ele.bidAmountF;
                        const time = ele.Time;
                        
                        if (i === 0){

                            if (bidUser.length >3){

                                if (tableBids){
                                    tableBids.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                                    <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                                    <tr>`
                                }   

                                if (tableBidsOwn){

                                    tableBidsOwn.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                                    <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                                    <tr>`
                                }            

                                if (tableBidsNoLogin){
                                
                                    tableBidsNoLogin.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                                    <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td> 
                                    <tr>`
                                }        


                            } else {

                    
                                if (tableBids){
                                    tableBids.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                                    <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>                                
                                    <tr>`
                                }        

                                if (tableBidsOwn){
                                    tableBidsOwn.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                                    <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>                                
                                    <tr>`
                                }        

                                if (tableBidsNoLogin){
                                    tableBidsNoLogin.innerHTML += ` <tr class= "alert alert-success rounded-1 px-0 pb-1 border mb-1" style="width: 100%;"> 
                                    <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>                                
                                    <tr>`
                                }            
    
                            }
                                
                        } else {

                            if (bidUser.length >3){

                                if (tableBids){
                                    tableBids.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                                    <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>  
                                    <tr>`
                                }         

                                if (tableBidsOwn){
                                    tableBidsOwn.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                                    <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>  
                                    <tr>`
                                }        

                                if (tableBidsNoLogin){
                                    tableBidsNoLogin.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                                    <td style="border: none; padding: 0; margin: 0; width: 20px"> ${acortado}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>  
                                    <tr>`
                                }            

                            } else {
                                    
                                if (tableBids){
                                    tableBids.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                                    <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                                    <tr>`
                                }        

                                if (tableBidsOwn){
                                    tableBidsOwn.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                                    <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                                    <tr>`
                                }
                                
                                if (tableBidsNoLogin){
                                    tableBidsNoLogin.innerHTML += `<tr style="border-top: 2px solid white; width: 100%;">
                                    <td style="border: none; padding: 0; margin: 0; width: 20px">  ${bidUser}  </td>
                                    <td style="border: none; padding: 0; margin: 0;">  <span class="my-0 ps-4 py-0"> ${bidAmountF}</span> </td>
                                    <td class="d-flex justify-content-end" style="border: none; padding: 0; margin: 0;">  <span class="my-0 bg-dark rounded-pill text-light px-1" style="font-size: 13px;"> ${time} </span> </td>
                                    <tr>`    
                                }        

                            }

                        }
                    })



                    })
                .catch((error)=>{
                    consooe.log("Ha habido un error", error)
                })
            }    

        });        
</script>


<script>
    //escucha para actualizar el evento de emision de creacion de nota de subasta
    socket.emit('messaje:prueba', "Esto es un mensaje de prueba GREGORIOM");
    const efectSoundNewNote = document.getElementById('efectSoundNewNote');
    
    socket.on('refresh:note', (data)=>{
        console.log(":::::::::::::xxxxxxxxx::::::::::");
        console.log(":::::::::::::Socket Escuchando *refresh:note* ::::::::::");
        const departHidd = departHidden.value;
        const idHidd = idHidden.value;
        console.log("depart :", departHidd );
        console.log("id :", idHidd );

        console.log("Esto es data objeto enviado desde el Servidor Socket ---->", data);
        const notes = data.obje;
        const allNotes = notes.reverse();
        const longNotes = allNotes.length; //esto es la cantidad de elementos que posee el array allNotes.

        //******************************************************
        console.log("Ver estas notas allNotes ordenadas ya");
        console.log("Esto es allNotes", allNotes);

        if (showNotes) {
            //esta es la muestra de notas del anfitrion
            showNotes.innerHTML = ""; //limpiamos las antiguas para que no se concatene
            //aqui hacer sonar el sonido de llegada de notas.
            efectSoundNewNote.currentTime = 0; // Reiniciamos el sonido
            efectSoundNewNote.play().catch(error => {
                console.error("Error al reproducir el sonido:", error);
            });
            function generarNewNotes() {

                return new Promise(function (resolve, reject) {

                    allNotes.forEach((ele, i) => {

                        if (ele.color === "dark") {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-dark" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `
                        } else if (ele.color === "primary") {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-primary" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `

                        } else if (ele.color === "success") {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-success" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `

                        } else if (ele.color === "info") {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-info" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `

                        } else if (ele.color === "warning") {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-warning" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `

                        } else if (ele.color === "danger") {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-danger" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `

                        } else {
                            showNotes.innerHTML += `
                                                            <div class="card note mb-1">
                                                                                <div class="card-body alert-light" style="position: relative;">
                                                                                    <span class="deleteNote" style="position: absolute; right: 0px; top: 11px;"><i class="bi bi-x"></i> <input type="hidden" value="${ele.idNota}"><input type="hidden" value="${ele.depart}"> </span>
                                                                                    <p class="m-0">${ele.nota}</p>
                                                                                </div>
                                                            </div>
                                                            `

                        }

                        if (i === longNotes - 1) {
                            console.log("i : ", i);
                            console.log("longNotes : ", longNotes);
                            resolve();
                        }

                    });

                });

            }

            function generarTagNewDeleteNotes() {
                console.log("*********** llegue aqui **********");
                const deleteNote = document.querySelectorAll('.deleteNote');
                console.log("deleteNote :", deleteNote);
                deleteNote.forEach((ele, i) => {
                    ele.addEventListener('click', () => {
                        //ahora vamos a crear un dato para enviar al servidor y eliminar la nota deseada.
                        //alert(`hola me quieres eliminar ?`);
                        //console.log("Hijo idNota :", ele.childNodes[2].value);
                        const idHidd = idHidden.value;
                        const idNota = parseInt(ele.childNodes[2].value);
                        const depart = ele.childNodes[3].value;

                        const datos = {
                            id: idHidd,
                            idNota: idNota,
                            depart: depart
                        };

                        fetch('/express-notes-deleting', {

                            method: "post",
                            body: JSON.stringify(datos),
                            headers: { "content-type": "application/json" }

                        })
                            .then(response => response.json())
                            .then(jsonx => {
                                console.log("Esto es lo que viene de haber eliminado una nota")
                                socket.emit('delete:Note', { 'obje' : jsonx });
                                console.log(jsonx);
                                //location.reload();
                            })
                            .catch(err => console.log(err));

                    })

                })
            }

            generarNewNotes().then(generarTagNewDeleteNotes());

        }

        if (showNotesSpectadores) {
            //esta es la muestra de notas de los espectadores
            showNotesSpectadores.innerHTML = ""; //limpiamos las antiguas para que no se concatene
            efectSoundNewNote.currentTime = 0; //Reiniciamos el sonido
            efectSoundNewNote.play().catch(error => {
                console.error("Error al reproducir el sonido:", error);
            });

            allNotes.forEach((ele, i) => {

                if (ele.color === "dark") {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-dark" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `
                } else if (ele.color === "primary") {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-primary" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `
                } else if (ele.color === "success") {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-success" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `
                } else if (ele.color === "info") {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-info" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `
                } else if (ele.color === "warning") {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-warning" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `
                } else if (ele.color === "danger") {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-danger" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `
                } else {
                    showNotesSpectadores.innerHTML += `
                                                    <div class="card note mb-1">
                                                                        <div class="card-body alert-light" style="position: relative;">
                                                                            <p class="m-0">${ele.nota}</p>
                                                                        </div>
                                                    </div>
                                                    `

                }

            });

        }   

                
        //******************************************************
    });
   
    
               
/*     socket.on('nueva-nota-creada', (datos)=>{
        console.log(":::::::::: SOCKET.IO :::::::::");
        console.log('se ha creado una nueva nota de subasta');
        //location.reload();
    });  */

</script>

<script>
    const btnReportar = document.querySelector('.btnReportar');
    const formReportar = document.getElementById('formReportar'); 
    
    if (btnReportar){
    
        btnReportar.addEventListener('click', ()=>{
            formReportar.classList.toggle('close');
        });
    
    }
    
    </script>

<script>//con este script logro proteger y dar el spinnier en el boton de carga.

    const btnCreate = document.getElementById('btnCreate');
    const btnCreateLoading = document.getElementById('btnCreateLoading');
    const buyDirect = document.querySelector('.buyDirect');

    const btnContact = document.getElementById('btnContact');
    const btnContactLoading = document.getElementById('btnContactLoading');
    const contactDirect = document.querySelector('.contactDirect');

    if (buyDirect){
        buyDirect.addEventListener('click', ()=>{
            btnCreate.classList.add('invisibleBtn');
            btnCreateLoading.classList.remove('invisibleBtn');
        })
    }

    if (contactDirect){
        contactDirect.addEventListener('click', ()=>{
            btnContact.classList.add('invisibleBtn');
            btnContactLoading.classList.remove('invisibleBtn');
        })
    }
           

</script>

<script>

<!-- script para controlar todo el modulo de compartir -->

  const shareToggle = document.querySelector('.shareToggle');
  const containerShare = document.querySelector('.containerShare');
  const btnClicBoard = document.getElementById('btnClicBoard');
  const btnClicBoardCheck = document.getElementById('btnClicBoardCheck');
  const linkToShare = document.getElementById('linkToShare'); //374 linea
  const btnQR = document.getElementById('btnQR');
  const canvas = document.getElementById('qr-canvas');
  

  shareToggle.addEventListener('click', ()=>{
    containerShare.classList.toggle('invisible')
  })

  //copiar link de tienda en el portapapeles
  btnClicBoard.addEventListener('click', ()=>{
    const storeToShare = linkToShare.value;
    navigator.clipboard.writeText(storeToShare)
      .then(function(){
       
        btnClicBoard.classList.add('invisible');
        btnClicBoardCheck.classList.remove('invisible');
        setTimeout(clipboardDone, 1000)
        
        function clipboardDone(){
          btnClicBoardCheck.classList.add('invisible');
          btnClicBoard.classList.remove('invisible');
        }

      })
      .catch(function(error){
        alert("error al copiar" + e);
      })
    
  })

  //fabricar Codigo QR
  btnQR.addEventListener('click', ()=>{

    const store = linkToShare.value;
    const url = `${store}`;
    console.log("url", url);

    const qr = new QRious({
        element: canvas, //en el contenedor donde ira.
        value: url, // informacion que codificara.
        size: 200, // calidad del codigo
        foreground: '#9200ff' // Establece el color violeta
    });

  })

</script>

<% if ( user !== undefined ) { %>
    <script>

        const favoriteProduct = document.querySelector('.favoriteProduct');
        const linkHeart = document.querySelector('.linkHeart')
        favoriteProduct.addEventListener('click', ()=>{
          
          efecto()
          setInterval( normalHeart, 2000)
          console.log("favoriteProduct --->", favoriteProduct.childNodes)
          //console.log("depart --->",favoriteProduct.childNodes[3].value)
          //console.log("id --->",favoriteProduct.childNodes[4].value)
          const depart = favoriteProduct.childNodes[3].value;
          const id = favoriteProduct.childNodes[4].value;

          const datos = {
            depart : depart,
            id : id
          }
          console.log("Esto es datos ---->", datos);

          fetch('/myfavorites', {

            method: "post",
            body: JSON.stringify(datos),
            headers: {"content-type" : "application/json"}

          })
            .then(response =>response.json() )
            .then( jsonx => console.log(jsonx))
            .catch( err => console.log(err));

        })
      

        function efecto(){
            linkHeart.classList.remove('bi-heart');
            linkHeart.classList.add('bi-heart-fill')
        }

        function normalHeart(){
            linkHeart.classList.remove('bi-heart-fill');
            linkHeart.classList.add('bi-heart')
        }



    </script>

<script>

    const favoriteStore = document.querySelector('.favoriteStore');
    const starData = document.querySelector('.starData');
 
    favoriteStore.addEventListener('click', ()=>{
        console.log("favoriteStore.chilnodes---> ", favoriteStore.childNodes )

        const user = favoriteStore.childNodes[4].value; //usuario que esta logeado
        const userTienda = favoriteStore.childNodes[7].value; //usuario dueño de la tienda
      
        const datos = {
            user : user,
            userOfStore : userTienda
        };

        console.log("datos favoriteStore--->", datos);
         
        efecto()
        setInterval( normalBookmark, 2000)

        fetch('/account/myfavorite-stores', {

          method: "post",
          body: JSON.stringify(datos),
          headers: {"content-type" : "application/json"}

          })
          .then(response =>response.json() )
          .then( jsonx => jsonx)
          .catch( err => console.log(err));


        function efecto(){            
            starData.classList.remove('bi-bookmark-check');
            starData.classList.add('bi-bookmark-check-fill')
        }

        function normalBookmark(){ 
            starData.classList.remove('bi-bookmark-check-fill');
            starData.classList.add('bi-bookmark-check')
        }

    })         

</script>
    <% } %>