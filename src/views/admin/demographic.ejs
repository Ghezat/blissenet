<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head.ejs') %>
    <title>Blissenet - Demographic Data</title>
</head>
<style>
    body {
        background-color: white;
    }

    .open{
        display: block;
    }

    .closed{
        display: none !important;
    }

    .leyend{
        width: 18px;
        height: 18px;
        display: inline-block;
    }
  
</style>
<body>
    <main>
        <%- include('../partials/navi-admin.ejs') %>
                   
      
       <div class="containerWindow">
            <div class="container-fluid d-flex justify-content-end p-1" style="background-color:  rgb(243, 238, 238); box-shadow: 1px 1px 5px 1px rgb(99, 98, 98);  border-top: 2px ridge  rgb(243, 238, 238);">
                <span class=" me-5 p-0" style="color:gray; font-weight: 500;"> Demographic Data</span>
            </div>
            <div class="containerNewDay">
                <div class="row m-0 p-0">
                
                    <div class="col-lg-12 p-0">
                        <div class="containerGeneralNewDay p-0">
                            <div class="card px-0" style="border-top-left-radius: 0; border-top-right-radius: 0;">
                                <div class="card-header">
                                    <ul class="nav nav-tabs">
    
                                        <li class="nav-item">
                                          <a class="nav-link Users active" style="cursor: pointer;">Users</a>
                                        </li>
                                        <li class="nav-item">
                                          <a class="nav-link Age" style="cursor: pointer;">Age & Gender</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link Place" style="cursor: pointer;">Place</a>
                                        </li> 
                                   
                                    </ul>
                                </div>
                                <div class="card-body">
    
                                    <div class="containerMain" style="height: auto;">
    
                                        <div class="contentUsers" id="contentUsers">
    
                                            <div class="row border d-flex justify-content-between align-items-start my-2 p-2">
                                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                    
                                                    <p style="font-size: 18px;">Ususarios Registrados : <span class="ms-2" id="userId" style="font-size: 20px; "></span></p>
                                                    <p style="font-size: 18px;">Perfiles Creados : <span class="ms-2" id="profileId" style="font-size: 20px;"></span></p>
                                                    <div class="contentRate d-flex flex-column justify-content-start align-items-start">
                                                        <span style="font-size: 18px;" class="mb-2">Tasa de creación de Perfil :</span>
                                                        <span class="progress" id="profileRateId" style="width: 100%; height: 24px;"></span>
                                                    </div>    
                                                        
                                                </div>
                                            </div>
                                                
                                        </div>
                                    
                                        <div class="contentAge closed" id="contentAge">
                                            
                                            <div class="row border d-flex justify-content-between align-items-start my-2 p-2">
                                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">

                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-primary me-2"></div>  Adolescentes <span style="font-size: 16px;">(Menos de 18 años)</span>: <span id="adoCount"></span> <span class="ms-2" id="adolescente" style="font-size: 20px; "></span> %</p>
                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-secondary me-2"></div> Jovenes <span style="font-size: 16px;">(de 18 a 25 años)</span>:  <span id="jovCount"></span> <span class="ms-2" id="joven" style="font-size: 20px; "></span> %</p>
                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-success me-2"></div> Adultos <span style="font-size: 16px;">(de 26 a 45 años)</span>: <span id="aduCount"></span> <span class="ms-2" id="adulto" style="font-size: 20px; "></span> %</p>
                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-warning me-2"></div> Maduros <span style="font-size: 16px;">(de 46 a 65 años)</span>: <span id="madCount"></span> <span class="ms-2" id="maduro" style="font-size: 20px; "></span> %</p>
                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-danger me-2"></div> Ancianos <span style="font-size: 16px;">(Mas de 65 años)</span>: <span id="ancCount"></span> <span class="ms-2" id="anciano" style="font-size: 20px; "></span> %</p>
                                                    <div class="progress" id="ageRate" style="width: 100%; height: 24px;">
                                                        <!-- aqui la barra de progreso de generos -->
                                                    </div>
                                                    <hr>
                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-primary me-2"></div> Masculinos : <span id="Man" style="font-size: 20px; "></span></span> %</p>
                                                    <p style="font-size: 18px;"> <div class="leyend rounded-2 bg-danger me-2"></div> Femeninos : <span id="Wom" style="font-size: 20px; "></span></span> %</p>
                                                    <div class="progress" id="genderRate" style="width: 100%; height: 24px;">
                                                        <!-- aqui la barra de progreso de generos -->
                                                    </div>

                                                </div>
                                            </div>
                                            
                                            
                                        </div>


                                        <div class="contentPlace closed" id="contentPlace">
                                            
                                            <div class="row border d-flex justify-content-between align-items-start my-2 p-2">

                                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">

                                                    <div class="contentPlaces">
                                                        <span class="bg-secondary text-light p-2 rounded-1">Pais: Venezuela <img src="/img/flagWolrd_ven.png" class="ms-2" style="width: 30px;"></span>
                                                        <hr>

                                                    </div>

                                                </div>
                                               
                                            </div>    
                                            
                                        </div>
                                        
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>

            
       </div>
                       
       

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script>
        //este script manipula las pestañas
        
        const Users = document.querySelector('.Users');
        const Age = document.querySelector('.Age');
        const Place = document.querySelector('.Place');
        
        const contentUsers = document.getElementById('contentUsers');
        const contentAge = document.getElementById('contentAge');
        const contentPlace = document.getElementById('contentPlace');



        Users.addEventListener('click', ()=>{

            Users.classList.add('active');
            Age.classList.remove('active');
            Place.classList.remove('active');

            contentUsers.classList.remove('closed');
            contentAge.classList.add('closed');
            contentPlace.classList.add('closed');

        });

        Age.addEventListener('click', ()=>{

            Age.classList.add('active');
            Users.classList.remove('active');
            Place.classList.remove('active');

            contentAge.classList.remove('closed');
            contentUsers.classList.add('closed');
            contentPlace.classList.add('closed');
        });


        Place.addEventListener('click', ()=>{

            Place.classList.add('active');
            Age.classList.remove('active');
            Users.classList.remove('active');

            contentPlace.classList.remove('closed');
            contentUsers.classList.add('closed');
            contentAge.classList.add('closed');
            
            
        });

    </script> 
    
    <script>
        const userId = document.getElementById('userId');
        const profileId = document.getElementById('profileId');
        const profileRateId = document.getElementById('profileRateId');

        const adolescente = document.getElementById('adolescente');
        const joven = document.getElementById('joven');
        const adulto = document.getElementById('adulto');
        const maduro = document.getElementById('maduro');
        const anciano = document.getElementById('anciano');
        const ageRate = document.getElementById('ageRate');

        const Man = document.getElementById('Man');
        const Wom = document.getElementById('Wom');
        const genderRate = document.getElementById('genderRate');

        const adoCount = document.getElementById('adoCount');
        const jovCount = document.getElementById('jovCount');
        const aduCount = document.getElementById('aduCount');
        const madCount = document.getElementById('madCount');
        const ancCount = document.getElementById('ancCount');

        const contentPlaces = document.querySelector('.contentPlaces');
        
        let adolescenteCount = 0;
        let jovenCount = 0;
        let adultoCount = 0;
        let maduroCount = 0;
        let ancianoCount = 0;

        let men = 0;
        let wom = 0;

        const placeGroup = []; //aqui guardo los estados o provincias del pais en cuestion.
        const objetPlace = [];
        const boxPlace = [];

        //este script solicita una data al backen a traves de un fetch
        fetch('/admin/demographic-data', {

            method: "GET",
            headers: {"content-type" : "application/json"}

        })
            .then(response =>response.json())
            .then(jsonx => {console.log("Aqui la informacion sumisnitrada por el backend", jsonx)
                const usersData = jsonx.users;
                const profileData = jsonx.profiles;
                userId.innerText = usersData;
                profileId.innerText = profileData;
                const rate = (profileData * 100)/ usersData
                const Rate = rate.toFixed(2);
                profileRateId.innerHTML = `<div class="progress-bar" role="progressbar" style="width: ${Rate}%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">${Rate}%</div>`

                //edades
                const age = jsonx.ages;
                console.log("Esto es age", age)

                age.forEach(element => {
                    if (element < 18){
                        adolescenteCount = adolescenteCount + 1
                    } else if (element >= 18 && element <= 25){
                        jovenCount = jovenCount + 1
                    } else if (element >= 26 && element <= 45){
                        adultoCount = adultoCount + 1
                    } else if (element >= 46 && element <= 65){
                        maduroCount = maduroCount + 1
                    } else {
                        ancianoCount = ancianoCount + 1
                    }
                });

              /*   console.log("Esto es adolecenteCount", adolescenteCount);
                console.log("Esto es jovenCount", jovenCount);
                console.log("Esto es adultoCount", adultoCount);
                console.log("Esto es maduroCount", maduroCount);
                console.log("Esto es ancianoCount", ancianoCount); */

                const agesAll = age.length;
                //console.log("Esto es todos los element de edades", agesAll);
                const adolescentePorc = (adolescenteCount * 100 / agesAll).toFixed(1);
                const jovenPorc = (jovenCount * 100 / agesAll).toFixed(1);
                const adultoPorc = (adultoCount * 100 / agesAll).toFixed(1);
                const maduroPorc = (maduroCount * 100 / agesAll).toFixed(1);
                const ancianoPorc = (ancianoCount * 100 / agesAll).toFixed(1);

                //aqui la cantidad agrupado por edades
                adoCount.innerText = adolescenteCount;
                jovCount.innerText = jovenCount;
                aduCount.innerText = adultoCount;
                madCount.innerText = maduroCount;
                ancCount.innerText = ancianoCount;

                adolescente.innerText = adolescentePorc;
                joven.innerText = jovenPorc;
                adulto.innerText = adultoPorc;
                maduro.innerText = maduroPorc;
                anciano.innerText = ancianoPorc;
                ageRate.innerHTML = `<div class="progress-bar bg-primary" role="progressbar" style="width: ${adolescentePorc}%"  aria-valuemax="100">${adolescentePorc}%</div>
                                     <div class="progress-bar bg-secondary" role="progressbar" style="width: ${jovenPorc}%; background-color : red"  aria-valuemax="100">${jovenPorc}%</div>
                                     <div class="progress-bar bg-success" role="progressbar" style="width: ${adultoPorc}%; background-color : red"  aria-valuemax="100">${adultoPorc}%</div>
                                     <div class="progress-bar bg-warning" role="progressbar" style="width: ${maduroPorc}%; background-color : red"  aria-valuemax="100">${maduroPorc}%</div>
                                     <div class="progress-bar bg-danger" role="progressbar" style="width: ${ancianoPorc}%; background-color : red"  aria-valuemax="100">${ancianoPorc}%</div>
                                    `


                //generos
                const gender = jsonx.gender;
                const genderCount = jsonx.gender.length;

                gender.forEach( ele =>{
                    const Gender = ele;

                    if (Gender === "men"){
                        men = men + 1;
                    } else {
                        wom = wom + 1;
                    }
                });

                console.log("Cantidad de generos existentes", genderCount);
                console.log("Cantidad de Hombres", men);
                console.log("Cantidad de Mujeres", wom);
                const menPorc = ((men * 100) / genderCount).toFixed(1);
                const womPorc = ((wom * 100) / genderCount).toFixed(1);
                Man.innerText = menPorc;
                Wom.innerText = womPorc;
                genderRate.innerHTML = `<div class="progress-bar bg-primary" role="progressbar" style="width: ${menPorc}%" aria-valuemax="100">${menPorc}%</div>
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: ${womPorc}%" aria-valuemax="100">${womPorc}%</div>`



                const places = jsonx.place;
                console.log("Esto es places --->", places)
                console.log("Esto es la cantidad poblacional de perfiles", profileData)

                places.forEach( (ele)=>{
                    const state = ele._id
                    const repetido = ele.repetido
                    const calculoPorcent = ((repetido * 100)/ profileData).toFixed(1);
                    console.log("Esto es state", state, repetido)
                    contentPlaces.innerHTML += `<p style="font-size: 18px;"> <i>•</i> ${state} : <span id="state" style="font-size: 16px;">${repetido}</span><span class="ms-2" id="state" style="font-size: 18px;">${calculoPorcent}</span> <span style="font-size: 16px">%</span> </p>`

                })
                 
              

            })
            .catch( err => console.log(err)); 

        


    </script>


</body>
</html>

