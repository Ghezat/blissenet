<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head.ejs') %>
        <title>Blissenet - Mercantil Data</title>
</head>
<style>
    body {
        background-color: white;
    }

    .open {
        display: block;
    }

    .closed {
        display: none !important;
    }

    .leyend {
        width: 18px;
        height: 18px;
        display: inline-block;
    }
</style>

<body>
    <main>
        <%- include('../partials/navi-admin.ejs') %>


            <div class="containerWindow">
                <div class="container-fluid d-flex justify-content-end p-1"
                    style="background-color:  rgb(243, 238, 238); box-shadow: 1px 1px 5px 1px rgb(99, 98, 98);  border-top: 2px ridge  rgb(243, 238, 238);">
                    <span class=" me-5 p-0" style="color:gray; font-weight: 500;"> Mercantil Data</span>
                </div>
                <div class="containerNewDay">


                    <div class="row m-0 p-0">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 p-0 m-0">
                            <div class="card p-0 m-0">

                                <div class="card-header">
                                    <ul class="nav nav-tabs">

                                        <li class="nav-item">
                                            <a class="nav-link recibos active" style="cursor: pointer;">Recibos</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link ingresos" style="cursor: pointer;">Ingresos</a>
                                        </li>

                                    </ul> 
                                </div>
                                <div class="card-body">
                                    <div class="contentSearch">
                                        <p style="font-size: 18px;">Informaci√≥n de recibos e ingresos generados.</p>
                                            <div class="form-group d-flex">


                                                <span class="form-control" style="width: 550px; border-top-right-radius: 0; border-bottom-right-radius: 0;"> Crea su rango de fecha :</span>
                                                <input type="date" class="form-control" id="dateFirst" value="date" style="width: 350px; border-top-left-radius: 0; border-bottom-left-radius: 0; border-top-right-radius: 0; border-bottom-right-radius: 0;">
                                                <input type="date" class="form-control" id="dateLast" value="date" style="width: 350px; border-top-left-radius: 0; border-bottom-left-radius: 0;">
                                                <input type="button" class="btn btn-success ms-2" value="Submit" id="submitDate" style="width: 500px;">


                                            </div>
                                    </div>
                                    <div class="containerMain" style="height: auto;">

                                        <div class="containerRecibos">

                                            <div class="contentInfo d-flex justify-content-between my-2 border">
                                                <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">

                                                    <p class="mb-1 ms-2" style="font-size: 18px;"> BuySell :
                                                        <span class="buySells ms-2 font-size: 13px"> </span>
                                                        <span class="buySellsPor ms-3"> </span> 
                                                    </p>
                                                    <p class="mb-1 ms-2" style="font-size: 18px;"> Invoices : 
                                                        <span class="invoices ms-2"> </span>
                                                        <span class="invoicesPor ms-3"> </span>
                                                    </p>


                                                </div>
                                                <div class="p-2 d-flex flex-column justify-content-center align-items-center"
                                                    style="width: 60%;">
                                                    <p class="mb-1" style="font-size: 20px; color: rgb(90, 90, 90);">
                                                        Total Recivos Generados: <span class="total ms-2"> </span>
                                                    </p>
                                                    
                                                </div>
                                            </div>

                                            <div class="contentInfo d-flex justify-content-between my-2 border">
                                                <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">

                                                    <p class="mb-1 ms-2" style="font-size: 18px;"> BuySell :
                                                        <span class="buySellsPaid ms-2 font-size: 13px"> </span>
                                                        <span class="buySellsPaidPor ms-3"> </span> 
                                                    </p>
                                                    <p class="mb-1 ms-2" style="font-size: 18px;"> Invoices : 
                                                        <span class="invoicesPaid ms-2"> </span>
                                                        <span class="invoicesPaidPor ms-3"> </span>
                                                    </p>


                                                </div>
                                                <div class="p-2 d-flex flex-column justify-content-center align-items-center"
                                                    style="width: 60%;">
                                                    <p class="mb-1" style="font-size: 20px; color: rgb(90, 90, 90);">
                                                        Total Recivos Pagados : <span class="totalPaid ms-2"> </span>
                                                    </p>
                                                   
                                                </div>
                                            </div>

                                            <div class="contentInfo d-flex justify-content-between my-2 border">
                                                <div class="p-2" style="color: rgb(70, 70, 70);">

                                                    <p class="mb-1 ms-2 border pe-2" style="font-size: 18px;">
                                                        BuySell <i class="bi bi-arrow-right mx-2"></i>
                                                        <img src="/img/arte.png" alt="" style="width: 25px;" title="Artes">
                                                        <img src="/img/articulos.png" alt="" style="width: 25px;" title="Articulos">
                                                        <img src="/img/subasta.png" alt="" style="width: 25px;" title="Subastas">
                                                       
                                                    </p>
                                                    <p class="mb-1 ms-2 border pe-2" style="font-size: 18px;">
                                                        Invoices <i class="bi bi-arrow-right mx-2"></i>
                                                        <img src="/img/automotriz.png" alt="" style="width: 25px;" title="Automotriz">
                                                        <img src="/img/nautico.png" alt="" style="width: 25px;" title="Nauticos">
                                                        <img src="/img/aeronautico.png" alt="" style="width: 25px;" title="Aeronauticos">
                                                        <img src="/img/bienesRaices.png" alt="" style="width: 25px;" title="Bienes Raices"> 
                                                        <img src="/img/servicio.png" alt="" style="width: 25px;" title="Servicios">
                                                    </p>


                                                </div>
                                            
                                            </div>

                                        </div>
                                        <div class="containerIngresos closed">

                                            <div class="contentMainInfo rounded-1 my-2" style="border-left: 12px solid rgb(26, 26, 235); border-top: 1px solid; border-bottom: 1px solid grey; border-top: 1px solid grey; border-right: 1px solid grey"">
                                                
                                                <div class="contentInfo d-flex justify-content-between">
                                                    
                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Valor en Recibos BuySell:          
                                                        </p>
                                                    </div>
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="recibosBuySellAll ms-2"> </span>                                                  
                                                    </div>

                                                </div>
                                                <div class="contentInfo d-flex justify-content-between">

                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Valor en Recibos Invoice:          
                                                        </p>
                                                    </div> 
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="recibosInvoiceAll ms-2"> </span>                                                  
                                                    </div>
                                                 
                                                </div>
                                                <div class="contentInfo d-flex justify-content-between p-0" style="background-color: #d1e7dd;">

                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Total Valor en Recibos Generados:          
                                                        </p>
                                                    </div>
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="totalRecibosAll ms-2"> </span>                                                  
                                                    </div>

                                                </div>
                                                 
                                            </div>
                                            <div class="contentMainInfo rounded-1 my-2" style="border-left: 12px solid green; border-top: 1px solid; border-bottom: 1px solid grey; border-top: 1px solid grey; border-right: 1px solid grey" >
                                               
                                                <div class="contentInfo d-flex justify-content-between">
                                                    
                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Ingresos BuySell:          
                                                        </p>
                                                    </div>
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="incomeBuySell ms-2"> </span>                                                  
                                                    </div>

                                                </div>
                                                <div class="contentInfo d-flex justify-content-between">

                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Ingresos Invoice:          
                                                        </p>
                                                    </div> 
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="incomeInvoice ms-2"> </span>                                                  
                                                    </div>
                                                 
                                                </div>
                                                <div class="contentInfo d-flex justify-content-between p-0 m-0" style="background-color: #d1e7dd;">

                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Total Ingresos:          
                                                        </p>
                                                    </div>
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="totalIncomeUSD ms-2"> </span>                                                  
                                                    </div>

                                                </div>
                                            
                                                <div class="contentInfo d-flex justify-content-between p-0 m-0" style="background-color: #d1e7dd;">

                                                    <div class="p-2" style="width: 40%; color: rgb(70, 70, 70);">
                                                        <p class="mb-0 ms-2" style="font-size: 18px;">
                                                            Total Ingresos:          
                                                        </p>
                                                    </div>
                                                    <div class="p-2 d-flex flex-column justify-content-center align-items-center" style="width: 60%;">
                                                        <span class="totalIncomeVES m-2"> </span>                                                  
                                                    </div> 

                                                </div>

                                            </div>        

                                        </div>

                                    </div>

                                </div>

                            </div>




                        </div>
                    </div>



                </div>


            </div>



    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <script>
        //Este script maneja las pestallas.
        const recibos = document.querySelector('.recibos');
        const ingresos = document.querySelector('.ingresos'); 
        const containerRecibos = document.querySelector('.containerRecibos'); 
        const containerIngresos = document.querySelector('.containerIngresos'); 


        recibos.addEventListener('click', ()=>{

            recibos.classList.add('active');
            ingresos.classList.remove('active');

            containerRecibos.classList.remove('closed');
            containerIngresos.classList.add('closed');
            

        });


        ingresos.addEventListener('click', ()=>{

            recibos.classList.remove('active');
            ingresos.classList.add('active');

            containerRecibos.classList.add('closed');
            containerIngresos.classList.remove('closed');
        

        });

    </script>    

    <script>
        //este script solicita data para presentar cada vez que se abre esta pagina.

        const buySells = document.querySelector('.buySells');
        const invoices = document.querySelector('.invoices');
        const buySellsPaid = document.querySelector('.buySellsPaid');
        const invoicesPaid = document.querySelector('.invoicesPaid');

        const total = document.querySelector('.total');
        const totalPaid = document.querySelector('.totalPaid');

        //seccion span donde marca el porcentaje que representa
        const buySellsPor = document.querySelector('.buySellsPor');
        const invoicesPor = document.querySelector('.invoicesPor');
        const buySellsPaidPor = document.querySelector('.buySellsPaidPor');
        const invoicesPaidPor = document.querySelector('.invoicesPaidPor');

        //seccion de income
        const recibosBuySellAll = document.querySelector('.recibosBuySellAll');
        const recibosInvoiceAll = document.querySelector('.recibosInvoiceAll');
        const totalRecibosAll = document.querySelector('.totalRecibosAll');
         
        const incomeBuySell = document.querySelector('.incomeBuySell');
        const incomeInvoice = document.querySelector('.incomeInvoice');
        const totalIncomeUSD = document.querySelector('.totalIncomeUSD');
        const totalIncomeVES = document.querySelector('.totalIncomeVES');


        fetch("/admin/mercantil-data", {
            method: "GET",
            headers: { "Content-Type": "applications/json" }
        })
            .then(response => response.json())
            .then(jsonData => {
                console.log("Esto es jsonData :", jsonData)
                const boxAds = jsonData.boxAds;
                const boxAdsPaid = jsonData.boxAdsPaid;
                const sumBoxAds = jsonData.sumBoxAds;
                const sumBoxAdsPaid = jsonData.sumBoxAdsPaid;

                //console.log(boxAds);
                console.log("sumBoxAds :", sumBoxAds);
                console.log("sumBoxAdsPaid :", sumBoxAdsPaid);

                let BuySells = boxAds[0].buySells;
                let Invoices = boxAds[1].invoices;

                let BuySellsPaid = boxAdsPaid[0].buySells;
                let InvoicesPaid = boxAdsPaid[1].invoices;


                //---------------------------------------------
                buySells.innerText = BuySells;
                invoices.innerText = Invoices;

                buySellsPor.innerText = ((BuySells * 100) / sumBoxAds).toFixed(1) + "%";
                invoicesPor.innerText = ((Invoices * 100) / sumBoxAds).toFixed(1) + "%";

                total.innerText = sumBoxAds + " (100%)"; //este es el total de recivos
                //---------------------------------------------
                buySellsPaid.innerText = BuySellsPaid;
                invoicesPaid.innerText = InvoicesPaid;

                buySellsPaidPor.innerText = ((BuySellsPaid * 100) / sumBoxAdsPaid).toFixed(1) + "%";
                invoicesPaidPor.innerText = ((InvoicesPaid * 100) / sumBoxAdsPaid).toFixed(1) + "%";

                totalPaid.innerText = sumBoxAdsPaid + " (100%)"; //este es el total de recivos pagos
                //---------------------------------------------


                //income---------------------------------------
                const jsonIncome = jsonData.boxIncome
                console.log(":::jsonIncome :",jsonIncome)
                let totalBuySellAllUSD, totalInvoiceAllUSD;
                let sumTotalAllUSD;

                let BuySellUSD, InvoiceUSD;
                let sumTotalIncomeUSD;

                let BuySellVES, InvoiceVES;
                let sumTotalIncomeVES;


            jsonIncome.forEach( (ele)=>{
                if (ele.totalBuySellAllUSD){
                    totalBuySellAllUSD = ele.totalBuySellAllUSD;
                    console.log(totalBuySellAllUSD)
                } else if (ele.totalInvoiceAllUSD){
                    totalInvoiceAllUSD = ele.totalInvoiceAllUSD;
                    console.log(totalInvoiceAllUSD)
                } else if (ele.buySellUSD && ele._id == true){
                    buySellUSD = ele.buySellUSD;
                    console.log( buySellUSD );
                } else if (ele.invoiceUSD && ele._id == true){
                    invoiceUSD = ele.invoiceUSD;
                    console.log(invoiceUSD);
                } else if (ele.buySellVES && ele._id == true){
                    buySellVES = ele.buySellVES;
                    console.log("::::buySellVES :", buySellVES)
                } else if (ele.invoiceVES && ele._id == true){
                    invoiceVES = ele.invoiceVES;
                    console.log("::::invoiceVES :", invoiceVES)
                }
            });

         
            sumTotalAllUSD = (totalBuySellAllUSD + totalInvoiceAllUSD);
            sumTotalIncomeUSD = (buySellUSD + invoiceUSD);
            sumTotalIncomeVES = (buySellVES + invoiceVES);
           

            recibosBuySellAll.innerText = totalBuySellAllUSD + " (USD)"
            recibosInvoiceAll.innerText = totalInvoiceAllUSD + " (USD)"            
            totalRecibosAll.innerText = sumTotalAllUSD + " (USD)"

            incomeBuySell.innerText = buySellUSD + " (USD)"
            incomeInvoice.innerText = invoiceUSD + " (USD)";
            totalIncomeUSD.innerHTML = sumTotalIncomeUSD.toFixed(2) + " (USD)"
            totalIncomeVES.innerHTML = sumTotalIncomeVES.toFixed(2) + " (VES)"
            })
            .catch(err => console.log(err));
    </script>

    <script>
        //este script envia los datos del rango de fecha para gestionar la consulta.
        const dateFirst = document.getElementById('dateFirst');
        const dateLast = document.getElementById('dateLast');
        const submitDate = document.getElementById('submitDate');


        submitDate.addEventListener('click', () => {

            const datos = {
                dateFirst: dateFirst.value,
                dateLast: dateLast.value
            };

            console.log(datos);

            if (datos.dateFirst.length !== 0 && datos.dateLast.length !== 0) {

                fetch('/admin/mercantil-data', {

                    method: "post",
                    body: JSON.stringify(datos),
                    headers: { "content-type": "application/json" }

                })
                    .then(response => response.json())
                    .then(jsonx => {
                        console.log("Esto es jsonx :", jsonx)
                        const boxAds = jsonx.boxAds;
                        const boxAdsPaid = jsonx.boxAdsPaid;
                        const sumBoxAds = jsonx.sumBoxAds;
                        const sumBoxAdsPaid = jsonx.sumBoxAdsPaid;

                        //console.log(boxAds);
                        console.log("sumBoxAds :", sumBoxAds);
                        console.log("sumBoxAdsPaid :", sumBoxAdsPaid);
                      
                        let BuySells = boxAds[0].buySells;
                        let Invoices = boxAds[1].invoices;

                        let BuySellsPaid = boxAdsPaid[0].buySells;
                        let InvoicesPaid = boxAdsPaid[1].invoices;


                        //---------------------------------------------
                        buySells.innerText = BuySells;
                        invoices.innerText = Invoices;

                        if (BuySells !==0){
                            buySellsPor.innerText = ((BuySells * 100) / sumBoxAds).toFixed(1) + "%";
                        } else {
                            buySellsPor.innerText = 0 + "%";
                        }

                        if (Invoices !==0){
                            invoicesPor.innerText = ((Invoices * 100) / sumBoxAds).toFixed(1) + "%";
                        } else {
                            invoicesPor.innerText = 0 + "%";
                        }
                        
                        total.innerText = sumBoxAds + " (100%)"; //este es el total de recivos
                        //---------------------------------------------
                        
                        buySellsPaid.innerText = BuySellsPaid;
                        invoicesPaid.innerText = InvoicesPaid;

                        if (BuySellsPaid !== 0){
                            buySellsPaidPor.innerText = ((BuySellsPaid * 100) / sumBoxAdsPaid).toFixed(1) + "%";
                        } else {
                            buySellsPaidPor.innerText = 0 + "%";
                        }

                        if (InvoicesPaid !== 0 ){
                            invoicesPaidPor.innerText = ((InvoicesPaid * 100) / sumBoxAdsPaid).toFixed(1) + "%";
                        } else {
                            invoicesPaidPor.innerText = 0 + "%";
                        }

                        
                        totalPaid.innerText = sumBoxAdsPaid + " (100%)"; //este es el total de recivos pagos
                        //---------------------------------------------
                        //seccion de income

                        //income---------------------------------------
                        const jsonIncome = jsonx.boxIncome;
                        console.log(":::jsonIncome de rango de fecha:",jsonIncome)
                        let totalBuySellAllUSD, totalInvoiceAllUSD;
                        let sumTotalAllUSD;

                        let BuySellUSD, InvoiceUSD;
                        let sumTotalIncomeUSD;

                        let BuySellVES, InvoiceVES;
                        let sumTotalIncomeVES;


                        jsonIncome.forEach( (ele)=>{
                            if (ele.totalBuySellAllUSD){
                                totalBuySellAllUSD = ele.totalBuySellAllUSD;
                                console.log(totalBuySellAllUSD)
                            } else if (ele.totalInvoiceAllUSD){
                                totalInvoiceAllUSD = ele.totalInvoiceAllUSD;
                                console.log(totalInvoiceAllUSD)
                            } else if (ele.buySellUSD && ele._id == true){
                                buySellUSD = ele.buySellUSD;
                                console.log( buySellUSD );
                            } else if (ele.invoiceUSD && ele._id == true){
                                invoiceUSD = ele.invoiceUSD;
                                console.log(invoiceUSD);
                            } else if (ele.buySellVES && ele._id == true){
                             buySellVES = ele.buySellVES;
                                console.log(buySellVES)
                            } else if (ele.invoiceVES && ele._id == true){
                                invoiceVES = ele.invoiceVES;
                                console.log(invoiceVES)
                            }
                        });

         
                        if (jsonIncome.length !==0){
                       
                        
                        console.log("totalInvoiceAllUSD mirar aqui -->", totalInvoiceAllUSD)
                        if ( totalInvoiceAllUSD === undefined ){
                            totalInvoiceAllUSD = 0;
                        } else if ( totalBuySellAllUSD === undefined ){
                            totalBuySellAllUSD = 0;
                        } else if ( buySellUSD === undefined ){ 
                            buySellUSD = 0;
                        } else if ( invoiceUSD === undefined ){
                            invoiceUSD = 0;
                        } else if ( buySellVES === undefined ){
                            buySellVES = 0;
                        } else if ( invoiceVES === undefined ){
                            invoiceVES = 0;
                        }    

                        console.log("totalInvoiceAllUSD mirar aqui -->", totalInvoiceAllUSD)
                         
                        sumTotalAllUSD = (totalBuySellAllUSD + totalInvoiceAllUSD);
                        sumTotalIncomeUSD = (buySellUSD + invoiceUSD);
                        sumTotalIncomeVES = (buySellVES + invoiceVES);

                        recibosBuySellAll.innerText = totalBuySellAllUSD + " (USD)"
                        recibosInvoiceAll.innerText = totalInvoiceAllUSD + " (USD)"            
                        totalRecibosAll.innerText = sumTotalAllUSD + " (USD)"

                        incomeBuySell.innerText = buySellUSD + " (USD)"
                        incomeInvoice.innerText = invoiceUSD + " (USD)";
                        totalIncomeUSD.innerHTML = sumTotalIncomeUSD.toFixed(2) + " (USD)"
                        totalIncomeVES.innerHTML = sumTotalIncomeVES.toFixed(2) + " (VES)"

                        } else {

                        recibosBuySellAll.innerText = 0 + " (USD)"
                        recibosInvoiceAll.innerText = 0 + " (USD)"            
                        totalRecibosAll.innerText = 0 + " (USD)"

                        incomeBuySell.innerText = 0 + " (USD)"
                        incomeInvoice.innerText = 0 + " (USD)";
                        totalIncomeUSD.innerHTML = 0 + " (USD)"
                        totalIncomeVES.innerHTML = 0 + " (VES)"
                        }


                    })
                    .catch(err => console.log(err));

            }

        });

    </script>

   
</body>

</html>